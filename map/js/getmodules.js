_jsload&&_jsload('map', 'BMap.register(function(cM){if(cM.config&&cM.config.isOverviewMap){return}if(cM.isLoaded()){bl(cM)}else{cM.addEventListener("load",function(){bl(this)})}cM.cityName="\u4e2d\u56fd";var T={};T.enableRequest=true;T.request=function(){if(T.enableRequest){T.enableRequest=false;setTimeout(function(){T._request()},500)}};T._request=function(){var cO=cM.getBounds(),cQ=cM.getZoom(),cN=bb.convertLL2MC(cO.getSouthWest()),cP=bb.convertLL2MC(cO.getNorthEast());bc.request(function(cR){T.enableRequest=true;if(cR&&cR.current_city&&cR.current_city["name"]){cM.cityName=cR.current_city["name"];a0(cM)}},{qt:"cen",b:cN.lng+","+cN.lat+";"+cP.lng+","+cP.lat,l:cQ},"","",true)};cM.addEventListener("load",function(cN){T.request()});cM.addEventListener("moveend",function(cN){T.request()});cM.addEventListener("zoomend",function(cN){T.request()})});function bl(cM){if(cM.temp.copyadded){return}cM.temp.copyadded=true;var cO=new aI(81,2);if(aB()){if(cM.highResolutionEnabled()){cO.width=148;fontSize="21px"}else{cO.width=72;cO.height=0}}var cN=new an({offset:cO,printable:true});cM.cpyCtrl=cN;a0(cM);cM.addEventListener("maptypechange",function(){a0(cM)});cM.addControl(cN);var T=new b2();T._opts={printable:true};cM.addControl(T);cM.addEventListener("resize",function(){if(this.getSize().width>=220&&cM.getSize().height>=100){T.show();cN.setOffset(cO)}else{T.hide();cN.setOffset(new aI(4,2))}});if(cM.getSize().width>=220&&cM.getSize().height>=100){T.show()}else{T.hide();cN.setOffset(new aI(4,2))}if(cM.highResolutionEnabled()){T.setOffset(new aI(3,2))}}function a0(T){var cT="11px",cS=T.cityName||"\u4e2d\u56fd",cO=T.getMapType(),cQ=["\u5e38\u5dde\u5e02","\u4e4c\u9c81\u6728\u9f50\u5e02","\u5357\u660c\u5e02","\u65e0\u9521\u5e02","\u798f\u5dde\u5e02","\u6cc9\u5dde\u5e02","\u73e0\u6d77\u5e02","\u8d35\u9633\u5e02"],cN=[],cR,cP="color:#fff;font-size:"+cT+";text-shadow:0 1px 3px black";switch(cO){case BMAP_SATELLITE_MAP:case BMAP_HYBRID_MAP:cN=[\'<span style="\'+cP+\'">&copy; 2017 Baidu - Data &copy; \'];cN.push(\'<a target="_blank" href="http://www.navinfo.com/" style="\'+cP+\'">NavInfo</a> &amp; \');for(var cM in cQ){if(cQ[cM]==cS){cR=true;break}}if(cR){cN.push(\'<a target="_blank" href="http://www.palmcity.cn/" style="\'+cP+\'">PalmCity</a>\')}else{cN.push(\'<a target="_blank" href="http://www.cennavi.com.cn/" style="\'+cP+\'">CenNavi</a>\')}cN.push(\' &amp; <a target="_blank" href="http://www.365ditu.com/" style="\'+cP+\'">\u9053\u9053\u901a</a>\');cN.push(" , Image &copy; DigitalGlobe & </span>");cN.push(\'<a href="http://www.chinasiwei.com" target="_blank" style="\'+cP+\'">chinasiwei</a>\');break;case BMAP_PERSPECTIVE_MAP:cN=[\'<span style="\'+cP+\'">&copy; 2017 Baidu - Data &copy; </span>\',\'<a href="http://o.cn" target="_blank" style="color:#fff;font-size:\'+cT+\';text-shadow:0 1px 3px black">\u90fd\u5e02\u5708</a>\'];break;default:cN=[\'<span style="font-size:\'+cT+\'">&copy; 2017 Baidu&nbsp;- Data &copy; \'];cN.push(\'<a target="_blank" href="http://www.navinfo.com/">NavInfo</a> &amp; \');for(var cM in cQ){if(cQ[cM]==cS){cR=true;break}}if(cR){cN.push(\'<a target="_blank" href="http://www.palmcity.cn/">PalmCity</a>\')}else{cN.push(\'<a target="_blank" href="http://www.cennavi.com.cn/">CenNavi</a>\')}cN.push(\' &amp; <a target="_blank" href="http://www.365ditu.com/">\u9053\u9053\u901a</a>\');cN.push("</span>");break}cN=cN.join("");T.cpyCtrl.addCopyright({id:1,content:cN})}function b2(T){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new aI(1,0);this.IMG_URL=cd.imgPath+(aB()?"copyright_logo_s.png":"copyright_logo.png")}b2.prototype=new cq();b2.prototype.initialize=function(cM){this._map=cM;var cN=ab("div");cN.style.height="32px";var T=ab("a",{title:"\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b\u6b64\u533a\u57df",target:"_blank",href:"http://map.baidu.com/?sr=1"});T.style.outline="none";if(a9.browser.ie==6){T.innerHTML="<div style=\'cursor:pointer;width:77px;height:32px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+this.IMG_URL+")\'></div>"}else{T.innerHTML="<img style=\'border:none;width:77px;height:32px\' src=\'"+this.IMG_URL+"\' />"}if(aB()){if(this._map.highResolutionEnabled()){cN.style.height="50px";T.href="#";this.IMG_URL=cd.imgPath+"copyright_logo_hd.png";T.innerHTML="<img style=\'border:none;width:136px;height:50px\' src=\'"+this.IMG_URL+"\' />"}else{cN.style.height="25px";T.href="#";T.innerHTML="<img style=\'border:none;width:68px;height:25px\' src=\'"+this.IMG_URL+"\' />"}}cN.appendChild(T);cM.getContainer().appendChild(cN);return cN};a9.extend(bA.prototype,{_draw:function(){this._bind()},_bind:function(){var T=this;T._watchSize=function(){var cN=T.getSize();if(T.width!=cN.width||T.height!=cN.height){var cP=new aI(T.width,T.height);var cR=new bh("onbeforeresize");cR.size=cP;T.dispatchEvent(cR);T._updateCenterPoint((cN.width-T.width)/2,(cN.height-T.height)/2);T.maskLayer.style.width=(T.width=cN.width)+"px";T.maskLayer.style.height=(T.height=cN.height)+"px";var cO=new bh("onresize");cO.size=cN;T.dispatchEvent(cO);var cM=parseInt(T.platform.style.left)||0;var cQ=parseInt(T.platform.style.top)||0;if(T.currentOperation!=0&&(T.offsetX!=cM||T.offsetY!=cQ)){T._setPlatformPosition(cM,cQ)}}};a9.on(T.maskLayer,"mouseover",function(cM){T.dispatchEvent(new bh("onmouseover"))});a9.on(T.maskLayer,"mouseout",function(cM){T.dispatchEvent(new bh("onmouseout"))})},_setPlatformPosition:function(T,cO,cM,cN){if(isNaN(T)||isNaN(cO)){return}if(this.offsetX==T&&this.offsetY==cO){return}this._updateCenterPoint(this.offsetX-T,this.offsetY-cO,cM);T=Math.round(T);cO=Math.round(cO);this.offsetX=T;this.offsetY=cO;this.platform.style.left=T+"px";this.platform.style.top=cO+"px";this.maskLayer.style.left=-T+"px";this.maskLayer.style.top=-cO+"px";if(cN!=false){this.dispatchEvent(new bh("onmoving"))}},panTo:function(cM,cO){if(!(cM instanceof ce)){return}var cN=this.pointToPixel(cM);var T=Math.round(this.width/2);var cP=Math.round(this.height/2);cO=cO||{};if(Math.abs(T-cN.x)>this.width||Math.abs(cP-cN.y)>this.height||cO.noAnimation){this._panTo(T-cN.x,cP-cN.y,cM)}else{this._panBy(T-cN.x,cP-cN.y,{duration:cO.duration})}},_panTo:function(cM,T,cO){var cN=this.temp;if(cN.operating==true){return}if(cN.dragAni){cN.dragAni.stop()}this.dispatchEvent(new bh("onmovestart"));this._setPlatformPosition(this.offsetX+cM,this.offsetY+T,cO);this.dispatchEvent(new bh("onmoveend"))},panBy:function(cM,T,cN){cM=Math.round(cM)||0;T=Math.round(T)||0;cN=cN||{};if(Math.abs(cM)<=this.width&&Math.abs(T)<=this.height&&(!cN.noAnimation)){this._panBy(cM,T)}else{this._panTo(cM,T)}},_panBy:function(cM,T,cP){if(this.temp.operating==true){return}cP=cP||{};this.dispatchEvent(new bh("onmovestart"));var cO=this,cN=cO.temp;cN.pl=cO.offsetX;cN.pt=cO.offsetY;if(cN.tlPan){cN.tlPan.cancel()}if(cN.dragAni){cN.dragAni.stop()}cN.tlPan=new g({fps:cP.fps||cO.config.fps,duration:cP.duration||cO.config.actionDuration,transition:cP.transition||ax.easeInOutQuad,render:function(cQ){this.terminative=cO.temp.operating;if(cO.temp.operating){return}cO._setPlatformPosition(cN.pl+Math.ceil(cM*cQ),cN.pt+Math.ceil(T*cQ))},finish:function(cQ){cO.dispatchEvent(new bh("onmoveend"));cO.temp.tlPan=false;if(cO.temp.stopArrow==true){cO.temp.stopArrow=false;if(cO.temp.arrow!=0){cO._arrow()}}}})}});');
﻿_jsload&&_jsload('oppc', 'function cI(){this._container=null}BMap.register(function(cM){if(cM.config.isOverviewMap){return}var T=new cI();au(cM.container,T.render(cM.config.defaultCursor));T._container=cM.container.lastChild;cM.temp.zoomer=T});cI.prototype.render=function(cM){var T=[\'<div id=zoomer style="position:absolute;z-index:0;top:0px;left:0px;overflow:hidden;visibility:hidden;cursor:\'+cM+\'">\'];T.push(\'<div class="BMap_zoomer" style="top:0;left:0;"></div>\');T.push(\'<div class="BMap_zoomer" style="top:0;right:0;"></div>\');T.push(\'<div class="BMap_zoomer" style="bottom:0;left:0;"></div>\');T.push(\'<div class="BMap_zoomer" style="bottom:0;right:0;"></div>\');T.push("</div>");return T.join("")};cI.prototype.action=function(cT,cU){if(cI._timeline){return}var cS=this._container;if(!cS){return}var c1=cU;var cN=60;var c0=120;var cV=4/3,cP=Math.ceil((c1?cN:c0)/2),cQ=Math.max(15,cP/cV),cR=cS.style;cR.width=cP*2+"px";cR.height=cQ*2+"px";cR.visibility="visible";var cX=cS.children;if(c1){cX[0].style.backgroundPosition="0 0";cX[1].style.backgroundPosition="-7px 0";cX[2].style.backgroundPosition="0 -7px";cX[3].style.backgroundPosition="-7px -7px"}else{cX[0].style.backgroundPosition="-7px -7px";cX[1].style.backgroundPosition="0 -7px";cX[2].style.backgroundPosition="-7px 0";cX[3].style.backgroundPosition="0 0"}cX=null;var cZ=cT.x-cP;var cY=cT.y-cQ;if(isNaN(cZ)||isNaN(cY)){return}cR.left=cZ+"px";cR.top=cY+"px";var cM=Math.ceil((c1?c0:cN)/2);var cO=Math.max(15,cM/cV);cM=cM-cP;cO=Math.ceil(cO-cQ);var cW=this;var T=cW._container.style;if(cI._timeline){cI._timeline.end()}cI._timeline=new g({fps:20,duration:240,transition:ax.easeInQuad,delay:100,render:function(c3){if(c3<0.1){return}var c4=Math.ceil(cM*c3);var c2=Math.ceil(cO*c3);T.width=(cP+c4)*2+"px";T.height=(cQ+c2)*2+"px";T.left=cZ-c4+"px";T.top=cY-c2+"px"},finish:function(){cI._timeline=false;setTimeout(function(){cR.visibility="hidden"},300)}})};BMap.register(function(cQ){var cP=cQ;var cO=cQ.platform;function cR(c1,cX){var cT=c1.srcElement||c1.target,c0=c1.offsetX||c1.layerX||0,cZ=c1.offsetY||c1.layerY||0,cW=null,cV=null;if(cT.nodeType!=1){cT=cT.parentNode}while(cT&&cT!=cP.container){if(cT.guid){if(a9.lang.instance(cT.guid) instanceof Z){cW=a9.lang.instance(cT.guid)}if(a9.lang.instance(cT.guid) instanceof bQ){cV=a9.lang.instance(cT.guid)}}if(!(cT.clientWidth==0&&cT.clientHeight==0&&cT.offsetParent&&cT.offsetParent.nodeName=="TD")&&cT.namespaceURI!="http://www.w3.org/2000/svg"){c0+=cT.offsetLeft||0;cZ+=cT.offsetTop||0}else{if(cT.namespaceURI=="http://www.w3.org/2000/svg"&&BMap.DrawerSelector){var cU=BMap.DrawerSelector.getDrawer(cP);var cS=cU.getPalette();if(navigator.userAgent.indexOf("Opera")>-1&&cT.tagName!="svg"){var c2=a9.lang.instance(cT.guid);if(c2){var cY=c2.getBounds();c0=c0+cP.pointToPixel(cY.getSouthWest()).x;cZ=cZ+cP.pointToPixel(cY.getNorthEast()).y}break}if(cS&&(!a9.browser.ie||(a9.browser.ie==9&&cT.nodeName.toLowerCase()=="svg"))){c0+=parseFloat(cS.style.left)+cP.offsetX;cZ+=parseFloat(cS.style.top)+cP.offsetY}if(a9.browser.ie==9&&cT.nodeName.toLowerCase()!="svg"){c0+=cP.offsetX;cZ+=cP.offsetY;break}if(!a9.browser.ie){break}}}cT=cT.offsetParent}cX.offsetX=c0;cX.offsetY=cZ;cX.pixel=new bv(c0,cZ);cX.point=cP.pixelToPoint(cX.pixel);cX.overlay=cW;cX.infoWindow=cV;return cX}cQ.container.onselectstart=function(){return false};a9.on(cP.platform,"mousemove",function(cS){if(cP.currentOperation==0){cP.dispatchEvent(cR(cS,new bh("onmousemove").inherit(cS)))}});a9.on(cP.platform,"mousedown",function(cW){if(!cP.config.enableMouseDown){return}var cW=window.event||cW;if(!a9.browser.ie){cD(cW)}var cU=cP.temp;cU.operating=true;var cT=cW.srcElement||cW.target;if(cU.dragAni){cU.dragAni.stop()}cU.tpx=cW.clientX||cW.pageX||0;cU.tpy=cW.clientY||cW.pageY||0;var cS=cT;while(cS){if(cS==cP.container){break}if(a9.dom.hasClass(cS,"BMap_Marker")){cU.operating=false;var cV=a9.lang.instance(cS.guid);if(cV instanceof ae&&cV._config.clickable==true||cV._config.enableDragging==true){return}}cS=cS.parentNode}if(cT.nodeType!=1){cT=cT.parentNode}if(a9.browser.ie&&cP.maskLayer.setCapture){cP.maskLayer.setCapture()}cP.dispatchEvent(cR(cW,new bh("onmousedown").inherit(cW)));if(cP.config.enableDragging&&!(cP.currentOperation&bo.drag)&&cW.button!=2){cU.mx=cU.tpx;cU.my=cU.tpy;cU.pl=cP.offsetX;cU.pt=cP.offsetY;cP.currentOperation|=bo.drag;if(cP.temp.curSpots.length==0){cP.platform.style.cursor=cP.config.draggingCursor}else{cP.platform.style.cursor="pointer"}}});a9.on(cP.platform,"mousemove",function(cV){var cV=window.event||cV;if(!a9.browser.ie){cD(cV)}var cU=cP.temp;var cS=cV.clientX||cV.pageX||0;var cY=cV.clientY||cV.pageY||0;if(cU.tpx||cU.tpy){cU.mox=cS-cU.tpx;cU.moy=cY-cU.tpy}var cW=aF(),cX=(cW-cU.lastLoadTileTime)>40;if(cW-cU.lastDomMoveTime<18){return}if(cX){cU.lastLoadTileTime=cW}cU.lastDomMoveTime=cW;if(cP.currentOperation&bo.drag&&cP.config.enableDragging){var cT=cP.platform.style;if(cT.cursor.replace(/"|\s/g,"")!=cP.config.draggingCursor){cT.cursor=cP.config.draggingCursor}if(!cU._moved){cP.dispatchEvent(cR(cV,new bh("ondragstart").inherit(cV)));cP.dispatchEvent(new bh("onmovestart"));cU.dragStartPos=new bv(cS,cY);cU.dragStartTime=cW}if(cU.mx==0&&cU.my==0&&cP.temp.keyboardDrag){cU.mx=cS;cU.my=cY;cU.pl=cP.offsetX;cU.pt=cP.offsetY}if(cS-cU.mx!=0||cY-cU.my!=0){cP.temp._moved=true;cP.dispatchEvent(cR(cV,new bh("ondragging").inherit(cV)));cP._setPlatformPosition(cU.pl+cS-cU.mx,cU.pt+cY-cU.my,null,cX)}}});a9.on(cP.platform,"mouseup",function(cV){if(a9.browser.ie&&cP.maskLayer.releaseCapture){cP.maskLayer.releaseCapture()}var cT=cP.temp;if(cT.preEnableClickPan){cP.enableClickPan(true)}var cV=window.event||cV,cS=cV.clientX||cV.pageX,cW=cV.clientY||cV.pageY;if(cP.currentOperation&bo.drag&&cP.config.enableDragging){cP.currentOperation^=bo.drag;if(cT.curSpots.length==0){cP.platform.style.cursor=cP.config.defaultCursor}else{cP.platform.style.cursor="pointer"}if(cP.temp._moved){var cU=cR(cV,new bh("ondragend").inherit(cV));cP.dispatchEvent(cU);cP._processInertialDragging(new bv(cS,cW))}cT._moved=false}cT.operating=false;if(cV.button==2){cT.tpx=null;cT.tpy=null;cT.mox=0;cT.moy=0}});function cN(cV){var cU=cP.temp,cT=!cU.mox&&!cU.moy;if(cU.rightDblclickTimer){clearTimeout(cU.rightDblclickTimer);cU.rightDblclickTimer=null;if(cT){cP.dispatchEvent(cR(cV,new bh("onrightclick").inherit(cV)));cP.currentOperation|=bo.dblclick;cP.dispatchEvent(cR(cV,new bh("onrightdblclick").inherit(cV)));cP.currentOperation^=bo.dblclick}}else{if(cT){cP.dispatchEvent(cR(cV,new bh("onrightclick").inherit(cV)))}var cS=cR(cV,new bh("onrightclickex").inherit(cV));cU.rightDblclickTimer=setTimeout(function(){cU.rightDblclickTimer=null;if(cT){cP.dispatchEvent(cS)}},cP.config.clickInterval)}}if(a9.browser.firefox>=4){a9.on(cP.container,"mouseup",function(cS){if(cS.button==2){cN(cS)}});a9.on(cP.container,"contextmenu",function(cS){cp(cS)})}else{a9.on(cP.container,"contextmenu",function(cS){cN(cS);cp(cS)})}var T=new Date();function cM(cV){if(cP.config.enableWheelZoom){var cU=cP.temp;if(cU.dragAni){cU.dragAni.stop()}cP.currentOperation|=bo.mousewheel;var cV=window.event||cV;cP.lastLevel=cP.zoomLevel;var cT=new bh("onmousewheel");cT.trend=cV.wheelDelta>=0||cV.detail<0;var cS=new Date();if(cT.trend==true&&cP.zoomLevel==cP.getMapType().getMaxZoom()||cT.trend==false&&cP.zoomLevel==cP.getMapType().getMinZoom()||cS-T<220){cP.currentOperation^=bo.mousewheel;cD(cV);return}T=cS;cR(cV,cT.inherit(cV));cP.dispatchEvent(cT);cP.currentOperation^=bo.mousewheel;cD(cV)}}a9.on(cP.container,"mousewheel",cM);if(window.addEventListener){cP.container.addEventListener("DOMMouseScroll",cM,false)}a9.on(cP.platform,"click",function(cW){var cU=new bh("onclick"),cV=new bh("onclickex"),cT=cP.temp;cR(cW,cU.inherit(cW));cR(cW,cV.inherit(cW));if(!cP.currentOperation){var cS=!cT.mox&&!cT.moy;if(cS){cP.dispatchEvent(cU)}if(!cT._clickTimer){cT._clickTimer=setTimeout(function(){cT._clickTimer=null;if(cS){cP.dispatchEvent(cV)}},cP.config.clickInterval)}}cT.tpx=null;cT.tpy=null;cT.mox=0;cT.moy=0});a9.on(cP.platform,"dblclick",function(cT){if(!cP.currentOperation){cP.currentOperation|=bo.dblclick;if(a9.browser.ie){cP.dispatchEvent(cR(cT,new bh("onclick").inherit(cT)))}var cS=cP.temp;if(cS._clickTimer){clearTimeout(cS._clickTimer);cS._clickTimer=null}cP.dispatchEvent(cR(cT,new bh("ondblclick").inherit(cT)));cP.currentOperation^=bo.dblclick}});a9.on(cP.platform,"mousedown",function(cU){var cU=window.event||cU;var cT=cU.srcElement||cU.target;var cS=cP.temp;if(cS.canKeyboard){cS.canKeyboard=a9.dom.contains(cQ.container,cT)}else{cS.canKeyboard=a9.dom.contains(cQ.platform,cT)}})});bA.prototype._processInertialDragging=function(c3){var c6=this;if(!c6.config.enableInertialDragging){c6.dispatchEvent(new bh("onmoveend"));return}var cU=c6.temp;var cM=aF();if(cM-cU.lastDomMoveTime>100){c6.dispatchEvent(new bh("onmoveend"));cU._moved=false;return}else{var c4=cU.dragStartPos,cX=c3,T=cu(c4,cX),c1=[cX.x-c4.x>0?1:-1,cX.y-c4.y>0?1:-1],cO=(cM-cU.dragStartTime)/1000,cS=T/cO/2,cT=0.5,c2=cS/(2*cT),c0=0.4*c2*cS/1000,cR=Math.abs(c4.x-cX.x),cQ=Math.abs(c4.y-cX.y),cY=0,cV=0;if(cQ==0){cY=cR}else{var cP=Math.abs(c4.x-cX.x)/Math.abs(c4.y-cX.y);cV=Math.round(Math.sqrt(c0*c0/(1+cP*cP)));cY=Math.round(cP*cV)}if(c1[0]==-1){cY=-cY}if(c1[1]==-1){cV=-cV}if(cU.dragAni){cU.dragAni.stop()}var cN=cS/1000,cZ=c6.offsetX,cW=c6.offsetY,c5=false;cU.dragAni=new g({duration:c2,fps:30,transition:function(c7){var c7=c7*cN/(2*cT);return cN*c7-cT*c7*c7},render:function(c7){c7=c7*(4*cT)/(cN*cN);c5=!c5;c6._setPlatformPosition(cZ+Math.round(c7*cY),cW+Math.round(c7*cV),null,c5)},finish:function(){cU.dragAni=null;c6._setPlatformPosition(cZ+Math.round(cY),cW+Math.round(cV));c6.dispatchEvent(new bh("onmoveend"))},onStop:function(c7){cU.dragAni=null;c7=c7*(4*cT)/(cN*cN);c6._setPlatformPosition(cZ+Math.round(c7*cY),cW+Math.round(c7*cV));setTimeout(function(){c6.dispatchEvent(new bh("onmoveend"))},1)}})}};BMap.register(function(cM){var T=cM;a9.on(document,"keydown",function(cN){if(T.temp.stopArrow==true){T.temp.stopArrow=false}if(T.config.enableKeyboard&&T.temp.canKeyboard){var cN=window.event||cN;switch(cN.keyCode||cN.which){case 43:case 189:case 109:T.temp.operating=true;T.dispatchEvent(new bh("onminuspress"));break;case 43:case 61:case 187:case 107:T.temp.operating=true;T.dispatchEvent(new bh("onpluspress"));break;case 33:T.temp.operating=false;T.temp.stopArrow=true;T.panBy(0,Math.round(T.height*0.8));cp(cN);break;case 34:T.temp.operating=false;T.temp.stopArrow=true;T.panBy(0,-Math.round(T.height*0.8));cp(cN);break;case 35:T.temp.operating=false;T.temp.stopArrow=true;T.panBy(-Math.round(T.width*0.8),0);cp(cN);break;case 36:T.temp.operating=false;T.temp.stopArrow=true;T.panBy(Math.round(T.width*0.8),0);cp(cN);break;case 37:T.temp.operating=true;T.temp.arrow|=1;T._arrow();cp(cN);break;case 38:T.temp.operating=true;T.temp.arrow|=2;T._arrow();cp(cN);break;case 39:T.temp.operating=true;T.temp.arrow|=4;T._arrow();cp(cN);break;case 40:T.temp.operating=true;T.temp.arrow|=8;T._arrow();cp(cN);break}}});a9.on(document,"keyup",function(cN){if(T.config.enableKeyboard){var cN=window.event||cN;switch(cN.keyCode||cN.which){case 37:T.temp.arrow=T.temp.arrow&~1;if(T.temp.arrow!=0){T._arrow()}break;case 38:T.temp.arrow=T.temp.arrow&~2;if(T.temp.arrow!=0){T._arrow()}break;case 39:T.temp.arrow=T.temp.arrow&~4;if(T.temp.arrow!=0){T._arrow()}break;case 40:T.temp.arrow=T.temp.arrow&~8;if(T.temp.arrow!=0){T._arrow()}break}}T.temp.operating=false});bA.prototype._arrow=function(){if(this._arrow.occurrent&&this._arrow._lastArrow==this.temp.arrow&&this.temp.stopArrow==true){return}var cN=this;var cP=cN.temp.arrow;cN._arrow._lastArrow=cP;cN._arrow.interval=30;cN._arrow.duration=999;cN._arrow.dx=cN._arrow.dy=0;if(cP&1){cN._arrow.dx=1}if(cP&2){cN._arrow.dy=1}if(cP&4){cN._arrow.dx=-1}if(cP&8){cN._arrow.dy=-1}if(cP&1&&cP&4){cN._arrow.dx=0}if(cP&2&&cP&8){cN._arrow.dy=0}if(!cN._arrow.occurrent){cN._arrow.occurrent=true;cN._arrow.time=aF();cN._arrow.beginTime=cN._arrow.time;cN.dispatchEvent(new bh("onmovestart"));var cO=new g({fps:cN._arrow.interval,duration:cN._arrow.duration,transition:ax.linear,render:function(cW){var cR=cN._arrow;var cU=cN.temp.arrow;if(cN._arrow._lastArrow!=cU){cN._arrow._lastArrow=cU;if(cU&1){cR.dx=1}if(cU&2){cR.dy=1}if(cU&4){cR.dx=-1}if(cU&8){cR.dy=-1}if(cU&1&&cU&4){cR.dx=0}if(cU&2&&cU&8){cR.dy=0}}if(cN.temp.stopArrow==true){cR.dx=0;cR.dy=0}var cV=aF();var cT=Math.pow((cV-cR.beginTime)/cR.duration,2);if(!cN.temp.arrow){cR.occurrent=false;cO.terminative=true;cN._arrow.time=aF();setTimeout(function(){cN.dispatchEvent(new bh("onmoveend"))},40)}var cX=(cV-cR.time);var cS=cR.dx*cX*cT>=0?Math.ceil(cR.dx*cX*cT):Math.floor(cR.dx*cX*cT);var cQ=cR.dy*cX*cT>=0?Math.ceil(cR.dy*cX*cT):Math.floor(cR.dy*cX*cT);if(cS!=0&&cQ!=0){cS=Math.round(cS*0.7);cQ=Math.round(cQ*0.7)}cR.time=cV;cN._setPlatformPosition(cN.offsetX+cS,cN.offsetY+cQ)},finish:function(){cN._arrow.time=aF();setTimeout(function(){cN._arrowPan()},cN._arrow.interval)}})}};bA.prototype._arrowPan=function(){var cQ=this;var cO=cQ._arrow;if(cQ.temp.stopArrow){cO.dx=0;cO.dy=0}if(!cQ.temp.arrow){cO.occurrent=false;cQ.dispatchEvent(new bh("onmoveend"));return}var cR=aF();var cS=(cR-cO.time);var cP=Math.ceil(cO.dx*cS);var cN=Math.ceil(cO.dy*cS);cO.time=cR;cQ._setPlatformPosition(cQ.offsetX+cP,cQ.offsetY+cN);setTimeout(function(){cQ._arrowPan()},cO.interval)}});');
﻿_jsload&&_jsload('tile', 'a9.extend(bS.prototype,{initialize:function(){var T=this,cM=T.map;cM.addEventListener("loadcode",function(){T.loadTiles()});cM.addEventListener("addtilelayer",function(cN){T.addTileLayer(cN)});cM.addEventListener("removetilelayer",function(cN){T.removeTileLayer(cN)});cM.addEventListener("setmaptype",function(cN){T.setMapType(cN)});cM.addEventListener("zoomstartcode",function(cN){T._zoom(cN)});T._addOtherEvt(cM)},loadTiles:function(){var T=this;if(a9.browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(cM){}}if(T.zoomsDiv){a9.dom.hide(T.zoomsDiv)}if(!this.loaded){T.initMapTypeTiles();this.loaded=true}T.moveGridTiles()},_asyncLoadTiles:function(){var T=this,cM=T.map;T._addOtherEvt(cM);T.loadTiles()},_addOtherEvt:function(cM){var T=this;cM.addEventListener("mousewheel",function(cN){T.mouseWheel(cN)});cM.addEventListener("dblclick",function(cN){T.dblClick(cN)});cM.addEventListener("rightdblclick",function(cN){T.dblClick(cN)});cM.addEventListener("minuspress",function(cN){T.keypress(cN)});cM.addEventListener("pluspress",function(cN){T.keypress(cN)});cM.addEventListener("moving",function(cN){T.moveGridTiles()});cM.addEventListener("resize",function(cN){T.moveGridTiles()})},addTileLayer:function(cO){var cN=this;var T=cO.target;for(var cM=0;cM<cN.tileLayers.length;cM++){if(cN.tileLayers[cM]==T){return}}cN.tileLayers.push(T);T.initialize(this.map,this._normalLayerContainer);if(cN.map.loaded){cN.moveGridTiles()}},removeTileLayer:function(cR){var cS=this;var cP=cR.target;var cN=cP.mapType;var cM=cS.mapTiles;var cU=cS.bufferTiles;for(var T in cU){var cT=T.split("-")[1];if(cT==cP.guid){delete cU[T]}}for(var T in cM){var cT=T.split("-")[1];if(cT==cP.guid){delete cM[T]}}for(var cQ=0,cO=cS.tileLayers.length;cQ<cO;cQ++){if(cP==cS.tileLayers[cQ]){cS.tileLayers.splice(cQ,1)}}cP.remove();cS.moveGridTiles()},mouseWheel:function(cP){var cO=this.map;if(!cO.config.enableWheelZoom){return}var cQ=cO.zoomLevel+(cP.trend==true?1:-1);var cN=cO._getProperZoom(cQ);if(cN.exceeded){return}cO.dispatchEvent(new bh("onzoomstart"));cO.lastLevel=cO.zoomLevel;cO.zoomLevel=cN.zoom;var T=cP.pixel;var cM=this._getMercatorCenter(T);zoomUnits=cO.getMapType().getZoomUnits(cO.getZoom());cO.mercatorCenter=new ce(cM.lng+(cO.width/2-T.x)*zoomUnits,cM.lat-(cO.height/2-T.y)*zoomUnits);cO.centerPoint=cO.projection.mercatorToLngLat(cO.mercatorCenter,cO.currentCity);this.zoom(T)},dblClick:function(cS){var cO=this.map;if(!cO.config.enableDblclickZoom){return}var cT=cS.pixel;var cP=1;var cM=cT;var cQ=new aI(0,0);if(cS.type=="onrightdblclick"){cP=-1;cM=new bv(cO.width/2,cO.height/2)}var cN=cO.zoomLevel+cP;var cR=cO._getProperZoom(cN);if(!cR.exceeded){cO.dispatchEvent(new bh("onzoomstart"));cO.lastLevel=cO.zoomLevel;cO.zoomLevel=cR.zoom;if(cP==1){cO.mercatorCenter=this._getMercatorCenter(cT);cO.centerPoint=cO.projection.mercatorToLngLat(cO.mercatorCenter,cO.currentCity);var T=cO.getMapType().getZoomUnits(cO.lastLevel)/cO.getMapType().getZoomUnits(cR.zoom)*0.5;cQ.width=cT.x-Math.round(cO.width/2)*T;cQ.height=cT.y-Math.round(cO.height/2)*T}this.zoom(cM,cQ)}else{if(cP==1){var cU=cO.pixelToPoint(cT);cO.panTo(cU)}}},keypress:function(cP){var cO=this.map;if(!cO.config.enableContinuousZoom){cP.type=="onpluspress"?cO.zoomIn():cO.zoomOut();return}if(this._zTimeLine){return}var cQ=cO.zoomLevel+(cP.type=="onpluspress"?1:-1);var cN=cO._getProperZoom(cQ);if(cN.exceeded){return}cO.dispatchEvent(new bh("onzoomstart"));var T=new bv(cO.width/2,cO.height/2);cO.lastLevel=cO.zoomLevel;cO.zoomLevel=cN.zoom;if(cO.getInfoWindow()){T=cO.pointToPixel(cO.getInfoWindow().getPosition(),cO.lastLevel);var cM=cO.pixelToPoint(T,cO.lastLevel);cO._updateCenterPoint(cO.width/2-T.x,cO.height/2-T.y,cM,true)}this.zoom(T)},_getMercatorCenter:function(T){var cQ=this.map;var cO=cQ.mercatorCenter;var cM=cQ.getMapType().getZoomUnits(cQ.lastLevel);var cN=cO.lng+cM*(T.x-cQ.width/2);var cP=cO.lat-cM*(T.y-cQ.height/2);return new ce(cN,cP)},zoom:function(cO,cN){var cQ=cN?cN.width:0;var cP=cN?cN.height:0;var c0=this.map;var c2=c0.config;var c1=this;var cZ={x:cO.x-parseInt(c1.tilesDiv.style.left)-c0.offsetX,y:cO.y-parseInt(c1.tilesDiv.style.top)-c0.offsetY};if(c0.overlayDiv){a9.dom.hide(c0.overlayDiv)}var T;c1._normalLayerContainer.style.visibility="hidden";this._showAvatarDivs();c1._mapTypeLayerContainer.style.visibility="hidden";var cY=[];var cR=c0.zoomLevel-c0.lastLevel;if(!c1._diff){c1._diff=cR}else{if(c0.zoomLevel-c0.lastLevel>0){c1._diff++}else{c1._diff--}}if(this._zTimeLine&&this._zTimeLine.schedule==0){this._zTimeLine.stop();this._zTimeLine=null;cR=c1._diff}if((!cN||cN.width==0&&cN.height==0)&&c2.enableContinuousZoom){c0.temp.zoomer.action(cO,cR>0?true:false)}var cS=Math.pow(2,cR);var cM=this.zoomsDiv;var cT=cM.style;cT.visibility="";var cX=cM.children.length;for(var cW=cX-1;cW>-1;cW--){var cU={};var cV=cM.children[cW].style;cU.top=parseInt(cV.top)||0;cU.left=parseInt(cV.left)||0;cU.width=parseInt(cV.width);cU.height=parseInt(cV.height);cU.dw=cU.width*cS-cU.width;cU.dh=cU.height*cS-cU.height;cU.dx=(cU.left-cZ.x)*cS-(cU.left-cZ.x);cU.dy=(cU.top-cZ.y)*cS-(cU.top-cZ.y);cY[cW]=cU}cM._ol=parseInt(cM.style.left);cM._ot=parseInt(cM.style.top);if(this._zTimeLine){this._zTimeLine.stop();this._zTimeLine=null}this._zTimeLine=new g({fps:20,duration:c2.enableContinuousZoom?c2.zoomerDuration:1,transition:ax.easeInQuad,render:function(c5){if(c5<0.1){return}for(var c4=cY.length-1;c4>-1;c4--){var c6=cY[c4];if(cM.children[c4]){var c3=cM.children[c4].style;c3.top=Math.round(c6.top+c6.dy*c5)+"px";c3.left=Math.round(c6.left+c6.dx*c5)+"px";c3.width=Math.ceil(c6.width+c6.dw*c5)+"px";c3.height=Math.ceil(c6.height+c6.dh*c5)+"px"}}if(cQ||cP){cT.left=cM._ol-(cQ*c5)+"px";cT.top=cM._ot-(cP*c5)+"px"}},finish:function(){c1.moveGridTiles();if(c0.overlayDiv){if(a9.browser.ie&&a9.browser.ie<8||document.compatMode=="BackCompat"){a9.dom.show(c0.overlayDiv)}else{setTimeout(function(){a9.dom.show(c0.overlayDiv)},100)}}c1._normalLayerContainer.style.visibility="";c1._mapTypeLayerContainer.style.visibility="";delete c1._diff;c0.dispatchEvent(new bh("onzoomend"));cM=null;c1._zTimeLine=null}})},setMapType:function(cR){var cO=this;var cQ=cO.map;this._showAvatarDivs(true);cQ.addEventListener("tilesloaded",function(){setTimeout(function(){cO._removeAvatarDivs()},200);cQ.removeEventListener("tilesloaded",arguments.callee)});for(var cN in this.mapTiles){this.hideTile(this.mapTiles[cN])}for(var cN in this.bufferTiles){this.hideTile(this.bufferTiles[cN])}var cP=this.mapTypeLayers;for(var cM=0,T=cP.length;cM<T;cM++){cP[cM].remove()}delete this.tilesDiv;this.mapTypeLayers=[];this.bufferTiles=this.mapTiles={};this.initMapTypeTiles();this.moveGridTiles()},_showAvatarDivs:function(cN){var cM=this.map;cN=cN||false;if(!this.zoomsDiv){if(!cN){this.zoomsDiv=this.tilesDiv.cloneNode(true)}else{this.zoomsDiv=this._mapTypeLayerContainer.cloneNode(true)}}else{if(this.zoomsDiv.parentNode&&!this._zTimeLine){this.zoomsDiv.parentNode.removeChild(this.zoomsDiv);this.zoomsDiv=null;if(!cN){this.zoomsDiv=this.tilesDiv.cloneNode(true)}else{this.zoomsDiv=this._mapTypeLayerContainer.cloneNode(true)}}}var T=this.zoomsDiv,cO=T.style;cO.display="";cO.zIndex=cO.zIndex-100;cM.platform.insertBefore(T,cM.platform.firstChild)},_removeAvatarDivs:function(){var T=this;if(T.zoomsDiv){J(T.zoomsDiv);if(T.zoomsDiv.parentNode){T.zoomsDiv.parentNode.removeChild(T.zoomsDiv);T.zoomsDiv.innerHTML="";T.zoomsDiv=null}}}});');
﻿_jsload&&_jsload('control', 'a9.extend(L.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){cq.prototype.initialize.call(this,T);this._initParam();this._setParam();this._render();this._bind();this._setSliderZoomLv(T.getZoom());this._bindMapEvent(T);return this._container},_initParam:function(){if(this._init){return}this._init=true;this._maxTotalZoomLv=19;this._minZoomLevel=-1;this._maxZoomLevel=-1;this._totalZoomLv=-1;this._sliderInterval=6;this._minBarY=1;this._maxBarY=-1;this._curBarY=-1;this._zoomDom=null;this._zoomBtnDom=null;this._sliderDom=null;this._sliderBaseDom=null;this._cZIndex="1100"},_bindMapEvent:function(cM){var T=this;cM.addEventListener("zoomend",function(cN){if(!T._map){return}T._setSliderZoomLv(T._map.getZoom());if(T._msover){return}if(T._isShowLevelHint){T._hideTimerId=setTimeout(function(){T._hideLevelHint()},1000)}});cM.addEventListener("mousewheel",function(){if(!T._map){return}if(T._map.config.enableWheelZoom&&T._isShowLevelHint){if(T._hideTimerId){clearTimeout(T._hideTimerId);T._hideTimerId=null}T._showLevelHint()}});cM.addEventListener("load",function(cN){if(!T._map){return}T._setSliderZoomLv(T._map.getZoom())});cM.addEventListener("maptypechange",function(cN){if(!T._map){return}T.redraw()});cM.addEventListener("zoomspanchange",function(cN){if(!T._map){return}T.redraw()})},redraw:function(){this._setParam();this.setType(this._opts.type);if(this._map){this._setSliderZoomLv(this._map.getZoom())}},_setParam:function(){var T=this._map.getMapType();this._minZoom=this._map.config.minZoom;this._maxZoom=this._map.config.maxZoom;if(T==BMAP_PERSPECTIVE_MAP||this._minZoom!=T.getMinZoom()||this._maxZoom!=T.getMaxZoom()){this._isShowLevelHint=false}else{this._isShowLevelHint=true}if(this._container){this._container.style.width=this._getControlHeight(0).width+"px"}if(!this._opts.showZoomInfo){this._isShowLevelHint=false}this._totalZoomLv=this._maxZoom-this._minZoom+1;this._maxBarY=this._minBarY+(this._totalZoomLv-1)*this._sliderInterval},_render:function(){cq.prototype._render.call(this);var cN=a9.browser.ie==6?" BMap_ie6":"";var cM=" BMap_stdMpType"+this._opts.type;var cO=this._container;a9.dom.addClass(cO,"BMap_stdMpCtrl");a9.dom.addClass(cO,cN);a9.dom.addClass(cO,cM);cO.innerHTML=this._generateHtml(this._opts.type);this._setSliderBarCursor(a9.browser.opera?"pointer":cd.defaultCursor);this._panBtnContainer=a9.g(cO.children[0]);this._zoomDom=a9.g(cO.children[1]);var T=this._zoomDom;this._btnZoomIn=a9.g(T.children[0]);this._btnZoomOut=a9.g(T.children[1]);this._sliderDom=a9.g(T.children[2]);this._sliderBaseDom=a9.g(T.children[2].children[0]);this._sliderBotDom=a9.g(T.children[2].children[1]);this.setType(this._opts.type)},_setSliderHeight:function(){var cT=this._opts.type;var T=this._getControlHeight(cT);var cR=T.width;var cM=T.height;var cP=T.zoomHeight;var cS=T.zoomWidth;var cN=T.sliderHeight;var cQ=T.sliderCHeight;var cO=(this._maxTotalZoomLv-this._totalZoomLv)*this._sliderInterval;if(this._opts.type==BMAP_NAVIGATION_CONTROL_LARGE){cM=cM-cO>=0?cM-cO:0;cP=cP-cO>=0?cP-cO:0;cN=cN-cO>=0?cN-cO:0}this._container.style.width=cR+"px";this._container.style.height=cM+"px";this._zoomDom.style.height=cP+"px";this._zoomDom.style.width=cR+"px";this._btnZoomOut.style.top=cP-21+"px";this._sliderDom.style.height=cN+"px";this._sliderBaseDom.style.height=cN+"px";if(this._opts.type==BMAP_NAVIGATION_CONTROL_ZOOM){this._zoomDom.children[0].style.left=this._zoomDom.children[1].style.left="0"}else{this._zoomDom.children[0].style.left=this._zoomDom.children[1].style.left=""}},_getControlHeight:function(cM){var T=62;if(!this._opts.showZoomInfo||this._map.getMapType()==BMAP_PERSPECTIVE_MAP){T=37}var cN=[{width:T,height:204,zoomHeight:159,zoomWidth:37,sliderHeight:120,sliderCHeight:120},{width:37,height:97,zoomHeight:42,zoomWidth:37,sliderHeight:0,sliderCHeight:0},{width:37,height:57,zoomHeight:0,zoomWidth:0,sliderHeight:0,sliderCHeight:0},{width:22,height:42,zoomHeight:42,zoomWidth:18,sliderHeight:0,sliderCHeight:0}];return cN[cM]},_generateHtml:function(){var T=[];T.push(this._generatePanHtml());T.push(this._generateZoomContainerHtml());return T.join("")},_generatePanHtml:function(){var T=\'<div class="BMap_stdMpPan"><div class="BMap_button BMap_panN" title="\u5411\u4e0a\u5e73\u79fb"></div><div class="BMap_button BMap_panW" title="\u5411\u5de6\u5e73\u79fb"></div><div class="BMap_button BMap_panE" title="\u5411\u53f3\u5e73\u79fb"></div><div class="BMap_button BMap_panS" title="\u5411\u4e0b\u5e73\u79fb"></div><div class="BMap_stdMpPanBg BMap_smcbg"></div></div>\';return T},_generateZoomContainerHtml:function(){var T=\'<div class="BMap_stdMpZoom">\'+this._generateZoomHtml()+this._generateSliderHtml()+this._generateZoomBalloonHtml()+"</div>";return T},_generateZoomHtml:function(){var T=\'<div class="BMap_button BMap_stdMpZoomIn" title="\u653e\u5927\u4e00\u7ea7"><div class="BMap_smcbg"></div></div><div class="BMap_button BMap_stdMpZoomOut" title="\u7f29\u5c0f\u4e00\u7ea7"><div class="BMap_smcbg"></div></div>\';return T},_generateSliderHtml:function(){var T=\'<div class="BMap_stdMpSlider"><div class="BMap_stdMpSliderBgTop"><div class="BMap_smcbg"></div></div><div class="BMap_stdMpSliderBgBot"></div><div class="BMap_stdMpSliderMask" title="\u653e\u7f6e\u5230\u6b64\u7ea7\u522b"></div><div class="BMap_stdMpSliderBar" title="\u62d6\u52a8\u7f29\u653e"><div class="BMap_smcbg"></div></div></div>\';return T},_generateZoomBalloonHtml:function(){var T=\'<div class="BMap_zlHolder"><div class="BMap_zlSt"><div class="BMap_smcbg"></div></div><div class="BMap_zlCity"><div class="BMap_smcbg"></div></div><div class="BMap_zlProv"><div class="BMap_smcbg"></div></div><div class="BMap_zlCountry"><div class="BMap_smcbg"></div></div></div>\';return T},_getElementByClassNamePattern:function(cP){var cO=this._getElementByClassNamePattern;if(typeof(cO.cache)==="undefined"){cO.cache=me._container.getElementsByTagName("*")}var cM=cO.cache,cN=null,T=cM.length,cQ=null;for(cN=0;cN<T;++cN){cQ=cM[cN];if(cQ.className.toString().match(cP)){return cQ}}throw Error(String(cP)+" Not found!")},setType:function(T){if(aL(T)&&T>=BMAP_NAVIGATION_CONTROL_LARGE&&T<=BMAP_NAVIGATION_CONTROL_ZOOM){this._opts.type=T}else{this._opts.type=BMAP_NAVIGATION_CONTROL_LARGE}if(!this._map||!this._container){return}var cM=this._container;cM.className=cM.className.replace(/BMap_stdMpType[0-3]*/,"BMap_stdMpType"+this._opts.type);this._setSliderHeight();if(T!=BMAP_NAVIGATION_CONTROL_LARGE){a9.dom.removeClass(cM.children[1].children[2],"hvr")}this.setAnchor(this._opts.anchor)},getType:function(){return this._opts.type},_bind:function(){var cS=this;var cR=cS._container;a9.on(this._zoomDom,"mouseover",function(){if(!cS._isShowLevelHint){return}cS._msover=true;if(cS._hideTimerId){clearTimeout(cS._hideTimerId);cS._hideTimerId=null}cS._showLevelHint()});a9.on(this._zoomDom,"mouseout",function(){if(!cS._isShowLevelHint){return}if(cS._hideTimerId){clearTimeout(cS._hideTimerId)}cS._msover=false;cS._hideTimerId=setTimeout(function(){cS._hideLevelHint();cS._hideTimerId=null},1000)});a9.on(cR.children[0],"mouseover",function(){cS._hideLevelHint(true)});a9.on(cR.children[0].children[0],"click",function(){cS._panBy(0,Math.round(cS._map.height/3))});a9.on(cR.children[0].children[1],"click",function(){cS._panBy(Math.round(cS._map.width/3),0)});a9.on(cR.children[0].children[2],"click",function(){cS._panBy(-Math.round(cS._map.width/3),0)});a9.on(cR.children[0].children[3],"click",function(){cS._panBy(0,-Math.round(cS._map.height/3))});a9.on(cR.children[0].children[0],"mouseover",function(){cS._panBtnContainer.style.backgroundPosition="0 -44px"});a9.on(cR.children[0].children[1],"mouseover",function(){cS._panBtnContainer.style.backgroundPosition="0 -176px"});a9.on(cR.children[0].children[2],"mouseover",function(){cS._panBtnContainer.style.backgroundPosition="0 -88px"});a9.on(cR.children[0].children[3],"mouseover",function(){cS._panBtnContainer.style.backgroundPosition="0 -132px"});a9.on(cS._panBtnContainer,"mouseout",function(){cS._panBtnContainer.style.backgroundPosition="0 0"});var cP=cR.children[1].children;a9.on(cP[0],"click",function(){cS._zoomIn()});a9.on(cP[1],"click",function(){cS._zoomOut()});for(var cN=0;cN<5;cN++){a9.on(cR.children[0].children[cN],"mouseup",function(cU){if((cS._map.currentOperation&bo.stdMapCtrlDrag)==0&&(cS._map.currentOperation&bo.drag)==0){aQ(cU)}});a9.on(cR.children[0].children[cN],"contextmenu",function(cU){cD(cU)});a9.on(cR.children[0].children[cN],"click",function(cU){cD(cU)})}a9.on(cP[0],"mouseup",function(cU){if((cS._map.currentOperation&bo.stdMapCtrlDrag)==0&&(cS._map.currentOperation&bo.drag)==0){aQ(cU)}});a9.on(cP[1],"mouseup",function(cU){if((cS._map.currentOperation&bo.stdMapCtrlDrag)==0&&(cS._map.currentOperation&bo.drag)==0){aQ(cU)}});a9.on(cP[0],"contextmenu",function(cU){cD(cU)});a9.on(cP[1],"contextmenu",function(cU){cD(cU)});var cT=cR.children[1].children[2].children[2];a9.on(cT,"mouseup",function(cU){if((cS._map.currentOperation&bo.stdMapCtrlDrag)==0&&(cS._map.currentOperation&bo.drag)==0){aQ(cU)}});a9.on(cP[0],"click",function(cU){aQ(cU)});a9.on(cP[1],"click",function(cU){aQ(cU)});a9.on(cP[0],"mouseover",function(){cP[0].style.backgroundPosition="0 -243px"});a9.on(cP[0],"mouseout",function(){if((cS._map.currentOperation&bo.stdMapCtrlDrag)==0){cP[0].style.backgroundPosition="0 -221px"}});a9.on(cP[1],"mouseover",function(){cP[1].style.backgroundPosition="0 -287px"});a9.on(cP[1],"mouseout",function(){if((cS._map.currentOperation&bo.stdMapCtrlDrag)==0){cP[1].style.backgroundPosition="0 -265px"}});a9.on(cT,"click",function(cU){aQ(cU)});var cQ=cR.children[1].children[2].children[3];a9.on(cQ,"mouseup",function(cU){if(cU.button==2){aQ(cU)}});a9.on(cQ,"contextmenu",function(cU){cD(cU)});a9.on(this._zoomDom.children[3].children[0],"click",function(cU){cS._map.zoomTo(18)});a9.on(this._zoomDom.children[3].children[1],"click",function(cU){cS._map.zoomTo(12)});a9.on(this._zoomDom.children[3].children[2],"click",function(cU){cS._map.zoomTo(8)});a9.on(this._zoomDom.children[3].children[3],"click",function(cU){cS._map.zoomTo(4)});a9.on(cT,"mousedown",function(cV){cV=window.event||cV;var cU=cV.layerY||cV.offsetY||0;var cW=0;cW=(cS._maxZoom+1)-Math.round(cS._totalZoomLv*parseFloat(cU/(cS._totalZoomLv*cS._sliderInterval)));cS._map.zoomTo(cW)});a9.on(cQ,"mouseover",function(){a9.dom.addClass(cQ,"h")});a9.on(cQ,"mouseout",function(){if((cS._map.currentOperation&bo.stdMapCtrlDrag)==0){a9.dom.removeClass(cQ,"h")}});var cO=function(cU){var cU=window.event||cU;if(cU.button==2){return}if((a9.browser.ie&&cU.button!=1)){return}if(cQ.setCapture){cQ.setCapture()}cS._map.currentOperation|=bo.stdMapCtrlDrag;cS._bind.my=cU.pageY||cU.clientY||0;if(!a9.browser.opera){cS._setSliderBarCursor(cd.draggingCursor)}a9.on(document,"mousemove",T);a9.on(document,"mouseup",cM);aQ(cU);return cD(cU)};var T=function(cV){if((cS._map.currentOperation&bo.stdMapCtrlDrag)!=0){var cV=window.event||cV;var cW=cV.pageY||cV.clientY;var cU=cS._curBarY+cW-cS._bind.my;if(cU<cS._minBarY){cU=cS._minBarY}else{if(cU>cS._maxBarY){cU=cS._maxBarY}}cQ.style.top=cU+"px";cS._sliderBotDom.style.top=cU+"px";cS._sliderBotDom.style.height=parseInt(cS._sliderBaseDom.style.height)-cU+4+"px"}};var cM=function(cV){if((cS._map.currentOperation&bo.stdMapCtrlDrag)!=0){var cU=a9.g(cQ);cS._curBarY=parseInt(cU.style.top);a9.dom.removeClass(cQ,"h");cS._map.currentOperation&=~bo.stdMapCtrlDrag;if(cR&&cQ&&cQ.releaseCapture){cQ.releaseCapture()}if(!a9.browser.opera){cS._setSliderBarCursor(cd.defaultCursor)}var cW=(cS._maxZoom+1)-Math.round(parseFloat(cS._curBarY-cS._minBarY)/parseFloat(cS._maxBarY-cS._minBarY)*(cS._totalZoomLv-1)+1);cS._map.zoomTo(cW);a9.un(document,"mousemove",T);a9.un(document,"mouseup",cM)}};a9.on(cQ,"mousedown",cO)},_setSliderBarCursor:function(T){this._container.children[1].children[2].children[3].style.cursor=T},_panBy:function(cM,T){this._map.panBy(cM,T)},_zoomIn:function(){this._map.zoomIn()},_zoomOut:function(){this._map.zoomOut()},_setSliderZoomLv:function(cM){if(!this._container||this.getType()!=BMAP_NAVIGATION_CONTROL_LARGE){return}var T=(this._maxZoom-cM)*this._sliderInterval+this._minBarY;this._curBarY=T>this._maxBarY?this._maxBarY:T<this._minBarY?this._minBarY:T;this._container.children[1].children[2].children[3].style.top=this._curBarY+"px";this._sliderBotDom.style.top=this._curBarY+"px";this._sliderBotDom.style.height=parseInt(this._sliderBaseDom.style.height)-this._curBarY+4+"px"},_hideLevelHint:function(T){if(this._opts.type==0){a9.dom.removeClass(this._container.children[1].children[3],"hvr")}if(T&&this._hideTimerId){clearTimeout(this._hideTimerId);this._hideTimerId=null}},_showLevelHint:function(){if(this._opts.type==0&&this._opts.showZoomInfo){a9.dom.addClass(this._container.children[1].children[3],"hvr")}},show:function(){cq.prototype.show.call(this);if(a9.browser.ie<8){var T=this;setTimeout(function(){T.setType(T._opts.type)},1)}}});a9.extend(an.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){cq.prototype.initialize.call(this,T);this._render();this._updateState();this._bind(T);return this._container},_bind:function(cM){var T=this;cM.addEventListener("load",function(cN){T._updateState()});cM.addEventListener("moveend",function(cN){T._updateState()});cM.addEventListener("zoomend",function(cN){T._updateState()});cM.addEventListener("maptypechange",function(){if(T._container){T._container.style.color=T._map.getMapType().getTextColor()}})},_render:function(){cq.prototype._render.call(this);a9.dom.addClass(this._container,"BMap_cpyCtrl");var T=this._container.style;T.cursor="default";T.whiteSpace="nowrap";T.MozUserSelect="none";T.color=this._map.getMapType().getTextColor();T.background="none";T.font="11px/15px "+cd.fontFamily;cq.prototype._setPosition.call(this)},_updateState:function(){if(!this._map||!this._container||this._copyrightCollection.length==0){return}for(var cP=0,cN=this._copyrightCollection.length;cP<cN;cP++){var cM;var T=this._map.getZoom();var cT=this._map.pixelToPoint({x:0,y:0});var cS=this._map.pixelToPoint({x:this._map.width,y:this._map.height});var cR=new bO(cT,cS);if(this._copyrightCollection[cP].bounds&&cR.intersects(this._copyrightCollection[cP].bounds)==null){cM=false}else{cM=true}if(cM){if(this._container){var cU=false;for(var cO=0,cQ=this._container.children.length;cO<cQ;cO++){if(this._container.children[cO].getAttribute("_cid")==this._copyrightCollection[cP].id){cU=true;this._container.children[cO].style.display="inline";if(this._container.children[cO].innerHTML!=this._copyrightCollection[cP].content){this._container.children[cO].innerHTML=this._copyrightCollection[cP].content}break}}if(!cU){this._generateHTML(this._copyrightCollection[cP])}}}else{if(this._container){for(var cO=0;cO<this._container.children.length;cO++){if(this._container.children[cO].getAttribute("_cid")==this._copyrightCollection[cP].id&&this._container.children[cO].style.display!="none"){this._container.children[cO].style.display="none";return}}}}}},addCopyright:function(cN){if(!cN||!aL(cN.id)||isNaN(cN.id)){return}var T={bounds:null,content:""};for(var cM in cN){T[cM]=cN[cM]}var cO=this.getCopyright(cN.id);if(cO){for(var cP in T){cO[cP]=T[cP]}}else{this._copyrightCollection.push(T)}this._updateState()},getCopyright:function(cN){for(var cM=0,T=this._copyrightCollection.length;cM<T;cM++){if(this._copyrightCollection[cM].id==cN){return this._copyrightCollection[cM]}}},getCopyrightCollection:function(){return this._copyrightCollection},removeCopyright:function(cP){var cN;for(var cM=0,T=this._copyrightCollection.length;cM<T;cM++){if(this._copyrightCollection[cM].id==cP){cN=this._copyrightCollection.splice(cM,1);cM--;T=this._copyrightCollection.length}}var cO=this.getDom(cP);if(cO&&cO.parentNode){cO.parentNode.removeChild(cO);cO=null}this._updateState();return cN},_generateHTML:function(T){if(!this._container){return}this._container.innerHTML+="<span _cid=\'"+T.id+"\'>"+T.content+"</span>"},getDom:function(cO){var cN=cq.prototype.getDom.call(this);if(!ci(cO)){return cN}else{if(cN){for(var cM=0,T=cN.children.length;cM<T;cM++){if(cN.children[cM].getAttribute("_cid")==cO){return cN.children[cM]}}}}}});a9.object.extend(cL.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){cq.prototype.initialize.call(this,T);this._initParam();this._render();this._bind();this._initOverviewMap();a9.on(this._container,"click",aQ);a9.on(this._container,"dblclick",aQ);a9.on(this._container,"mousewheel",aQ);a9.on(this._container,"mouseup",function(cM){cM=window.event||cM;if(cM.button==2){aQ(cM)}});if(window.addEventListener){this._container.addEventListener("DOMMouseScroll",function(cM){aQ(cM)},true)}return this._container},_initParam:function(){if(this._init){return}this._init=true;this._omCanvas;this._omMapContainer;this._omView;this._omViewMv;this._omBtn;this._borderWidth=1;this._quad=4;this._overviewMap=null;this._minZoom=-1;this._maxZoom=-1;this._curOMZoomLevel=-1;this._wRatio=1;this._hRatio=1;this._temp={};this._currentOp="";this._overviewInitialized=false},_getCurOMZoomLevel:function(){if(!this._map){return}var T=this._map.zoomLevel;var cM=T-this._opts.zoomInterval;if(cM<this._minZoom){return this._minZoom}else{if(cM>this._maxZoom){return this._maxZoom}else{return cM}}return -1},_render:function(){cq.prototype._render.call(this);var T=a9.browser.ie!=false?" BMap_ie"+a9.browser.ie:"";var cM=this._container;cM.innerHTML=this._generateHTML();a9.dom.addClass(cM,"BMap_omCtrl"+T);this._omCanvas=cM.children[0].children[0];this._omMapContainer=this._omCanvas.children[0];this._omViewMv=this._omCanvas.children[1];this._omViewMvInn=this._omViewMv.children[0];this._omBtn=cM.children[1];this.setSize(this._opts.size);this._omViewMv.style.cursor=cd.defaultCursor},_generateHTML:function(){var T=[\'<div class="BMap_omOutFrame"><div class="BMap_omInnFrame">\',\'<div class="BMap_omMapContainer"></div>\',\'<div class="BMap_omViewMv"><div class="BMap_omViewInnFrame"><div></div></div></div>\',\'</div></div><div class="BMap_omBtn"></div>\'];return T.join("")},_bind:function(){var T=this;a9.on(this._omBtn,"click",function(){T.changeView()});if(a9.browser.ie){a9.on(this._omBtn,"dblclick",function(){T.changeView()})}if(!a9.browser.ie||a9.browser.ie>6){this._omBtn.onmouseover=function(cM){a9.dom.addClass(T._omBtn,"hover")};this._omBtn.onmouseout=function(cM){a9.dom.removeClass(T._omBtn,"hover")}}a9.on(this._omViewMv,"mousedown",function(cM){if(T._omViewMv&&ci(T._omViewMv._drag)&&T._omViewMv._drag=="true"){return}cM=window.event||cM;if(cM.button==2){return}T._omViewMv._drag="true";var cM=window.event||cM;if(T._omViewMv.setCapture){T._omViewMv.setCapture()}T._bind.iniX=parseInt(aK(T._omViewMv).left);T._bind.iniY=parseInt(aK(T._omViewMv).top);T._bind.mx=cM.pageX||cM.clientX;T._bind.my=cM.pageY||cM.clientY;T._bind.i=0;T._bind.j=0;T._setViewMvCursor(cd.draggingCursor);aQ(cM);return cD(cM)});a9.on(document,"mousemove",function(cS){if(T._omViewMv&&T._omViewMv._drag=="true"){var cS=window.event||cS;var cM=cS.pageX||cS.clientX;var cT=cS.pageY||cS.clientY;T._bind.curX=T._bind.iniX+cM-T._bind.mx;T._bind.curY=T._bind.iniY+cT-T._bind.my;var cR=3;T._bind._moveX=0;T._bind._moveY=0;if(T._bind.curX<=0){T._bind._moveX=cR}if(T._bind.curY<=0){T._bind._moveY=cR}if(T._bind.curX+T._omViewMv.offsetWidth>=T._overviewMap.width){T._bind._moveX=-cR}if(T._bind.curY+T._omViewMv.offsetHeight>=T._overviewMap.height){T._bind._moveY=-cR}T._omViewMv.style.left=T._bind.curX+"px";T._omViewMv.style.top=T._bind.curY+"px";if((T._bind._moveX!=0||T._bind._moveY!=0)&&!T._bind.intervalId){T._bind._mapMoving=true;var cQ=T._overviewMap.offsetX;var cO=T._overviewMap.offsetY;var cP=cQ+T._bind._moveX;var cN=cO+T._bind._moveY;T._overviewMap._setPlatformPosition(cP,cN);T._bind.intervalId=setInterval(function(){var cV=T._bind._moveX!=0?(T._bind._moveX>0?T._bind.i+=cR:T._bind.i-=cR):T._bind.i;var cU=T._bind._moveY!=0?(T._bind._moveY>0?T._bind.j+=cR:T._bind.j-=cR):T._bind.j;T._overviewMap._setPlatformPosition(cP+cV,cN+cU)},30)}if(T._bind._moveX==0&&T._bind._moveY==0){clearInterval(T._bind.intervalId);delete T._bind.intervalId;T._bind.i=0;T._bind.j=0}aQ(cS);return cD(cS)}});a9.on(document,"mouseup",function(cP){if(T._omViewMv&&T._omViewMv._drag=="true"){T._omViewMv._drag="";T._setViewMvCursor(cd.defaultCursor);if(T._omViewMv.releaseCapture){T._omViewMv.releaseCapture()}if(T._bind.initX==T._bind.curX&&T._bind.initY==T._bind.curY){aQ(cP);return cD(cP)}T._currentOp="dragView";T._overviewMap.config.enableMouseDown=false;T._map.temp.operating=true;if(!ci(T._bind.curX)||!ci(T._bind.curY)){return}var cO=T._bind.curX+parseInt(T._omViewMv.style.width)/2+1;var cN=T._bind.curY+parseInt(T._omViewMv.style.height)/2+1;delete T._bind.curX;delete T._bind.curY;var cM=T._overviewMap.pixelToPoint({x:cO,y:cN},T._overviewMap.zoomLevel);T._map.temp.operating=false;if(T._bind._mapMoving==true){clearInterval(T._bind.intervalId);delete T._bind.intervalId;T._bind._mapMoving=false}T._map.temp.operating=true;setTimeout(function(){T._map.temp.operating=false;T._map.panTo(cM)},50);aQ(cP);return cD(cP)}})},_initOverviewMap:function(){if(this._overviewInitialized==true){return}var cN=this;var cO=cN._map;cO.addEventListener("resize",function(){if(cN._overviewMap!=null){cN._overviewMap.setCenter(cO.getCenter())}if(cN._omView!=null){cN._omView.setPosition(cO.getCenter());cN._setRatio()}cN.setAnchor(cN._opts.anchor)});if(this._opts.isOpen==false){return}if(!this._binded){cO.addEventListener("loadcode",function(){cN._onMainZoomEnd()});cO.addEventListener("moving",function(){cN._moveView()});cO.addEventListener("moveend",function(cP){cN._onMainMoveEnd(cP)});cO.addEventListener("zoomend",function(cP){cN._onMainZoomEnd(cP)});cO.addEventListener("maptypechange",function(cP){cN._setRatio()});this._binded=true}var T=cO.getCenter();this._minZoom=BMAP_NORMAL_MAP.getMinZoom();this._maxZoom=BMAP_NORMAL_MAP.getMaxZoom();this._curOMZoomLevel=this._getCurOMZoomLevel();this._overviewMap=new bA(this._omMapContainer,{isOverviewMap:true});this._overviewMap.disableDoubleClickZoom();this._overviewMap.centerAndZoom(T,this._curOMZoomLevel);this._omView=new n({point:cO.getCenter(),lineStroke:1,lineColor:"#6688cc"});this._overviewMap.addOverlay(this._omView);this._omView.getContainer().innerHTML=\'<div class="BMap_omViewInnFrame"><div class="BMap_omViewMask"></div></div>\';this._omViewInn=this._omView.getContainer().children[0];var cM=this._omView.getContainer().style;cM.borderLeftColor="#84b0df";cM.borderTopColor="#adcff4";cM.borderRightColor="#274b8b";cM.borderBottomColor="#274b8b";this._setRatio();this._overviewMap.addEventListener("dragend",function(){cN._currentOp="dragMap";cO.panTo(cN._overviewMap.getCenter())});this._overviewMap.addEventListener("moveend",function(){cN._onViewMapMoveEnd()});this._overviewMap.addEventListener("mousedown",function(cP){cN._temp._downX=cP.offsetX;cN._temp._downY=cP.offsetY});this._overviewMap.addEventListener("resize",function(cP){if(cN._map&&cN._overviewMap){cN._overviewMap.setCenter(cN._map.getCenter())}cN._setRatio()});this._overviewInitialized=true},_setViewMvCursor:function(T){this._omViewMv.style.cursor=T},setAnchor:function(cP){cq.prototype.setAnchor.call(this,cP);if(!this._map){return}if(a9.browser.ie){var cS=this._map.width;var cO=this._map.height;var cM=this._opts.size.width;var cQ=this._opts.size.height;var cN=this._opts.offset.width;var T=this._opts.offset.height;if(this._opts.isOpen==false){cM=this._btnWidth;cQ=this._btnHeight}var cR=this._container;switch(cP){case BMAP_ANCHOR_TOP_RIGHT:cR.style.right="auto";cR.style.left=cS-cM-cN+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:cR.style.bottom="auto";cR.style.top=cO-cQ-T+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:cR.style.bottom="auto";cR.style.right="auto";cR.style.top=cO-cQ-T+"px";cR.style.left=cS-cM-cN+"px";break;default:break}}this._setQuad();this._redraw()},changeView:function(){this.changeView._running=true;this._opts.isOpen=!this._opts.isOpen;if(!this._container){this.changeView._running=false;return}var cQ=this._container;var T=this._opts.size.width;var cN=this._opts.size.height;var cP=this._btnWidth;var cM=this._btnHeight;var cO=this;if(!this._opts.isOpen){this.changeView._preBtnTop=this._omBtn.style.top;this.changeView._preBtnLeft=this._omBtn.style.left;new g({fps:25,duration:120,transition:ax.easeInCubic,render:function(cR){cQ.style.width=(T-Math.ceil((T-cP)*cR))+"px";cQ.style.height=(cN-Math.ceil((cN-cM)*cR))+"px";if(a9.browser.ie){cO._omBtn.style.top=(cO._quad==3||cO._quad==4)?parseInt(cQ.style.height)-cM+"px":"0";cO._omBtn.style.left=(cO._quad==1||cO._quad==4)?parseInt(cQ.style.width)-cP+"px":"0";if(cO._opts.anchor>=0&&cO._opts.anchor<=BMAP_ANCHOR_BOTTOM_RIGHT){if(cO._quad==3||cO._quad==4){cQ.style.top=cO._map.height-parseInt(cQ.style.height)-cO._opts.offset.height+"px"}if(cO._quad==1||cO._quad==4){cQ.style.left=cO._map.width-parseInt(cQ.style.width)-cO._opts.offset.width+"px"}}}cO.dispatchEvent(new bh("onviewchanging"))},finish:function(){if(a9.browser.ie){cO._omBtn.style.left="0";cO._omBtn.style.top="0";if(cO._opts.anchor>=0&&cO._opts.anchor<=BMAP_ANCHOR_BOTTOM_RIGHT){if(cO._quad==3||cO._quad==4){cQ.style.top=cO._map.height-cO._btnHeight-cO._opts.offset.height+"px"}if(cO._quad==1||cO._quad==4){cQ.style.left=cO._map.width-cO._btnWidth-cO._opts.offset.width+"px"}}}cO._redraw();a9.dom.addClass(cO._omBtn,"BMap_omBtnClosed");var cR=new bh("onviewchanged");cR.isOpen=cO._opts.isOpen;cO.dispatchEvent(cR);cO.changeView._running=false}})}else{if(this._overviewInitialized==false){this._initOverviewMap()}new g({fps:40,duration:120,transition:ax.easeOutCubic,render:function(cR){cQ.style.width=(Math.ceil(T*cR))+"px";cQ.style.height=(Math.ceil(cN*cR))+"px";if(a9.browser.ie){cO._omBtn.style.top=(cO._quad==3||cO._quad==4)?parseInt(cQ.style.height)-cM+"px":"0";cO._omBtn.style.left=(cO._quad==1||cO._quad==4)?parseInt(cQ.style.width)-cP+"px":"0";if(cO._opts.anchor>=0&&cO._opts.anchor<=BMAP_ANCHOR_BOTTOM_RIGHT){if(cO._quad==3||cO._quad==4){cQ.style.top=cO._map.height-parseInt(cQ.style.height)-cO._opts.offset.height+"px"}if(cO._quad==1||cO._quad==4){cQ.style.left=cO._map.width-parseInt(cQ.style.width)-cO._opts.offset.width+"px"}}}cO.dispatchEvent(new bh("onviewchanging"))},finish:function(){if(cO._opts.anchor>=0&&cO._opts.anchor<=BMAP_ANCHOR_BOTTOM_RIGHT){if(a9.browser.ie){if(cO._quad==3||cO._quad==4){cQ.style.top=cO._map.height-cN-cO._opts.offset.height+"px"}if(cO._quad==1||cO._quad==4){cQ.style.left=cO._map.width-T-cO._opts.offset.width+"px"}}}cO._redraw();cO._setBtnPosition();a9.dom.removeClass(cO._omBtn,"BMap_omBtnClosed");var cR=new bh("onviewchanged");cR.isOpen=cO._opts.isOpen;cO.dispatchEvent(cR);cO.changeView._running=false}})}},_setRatio:function(){if(!this._map){return}var cR=this._map.zoomLevel;var cT=this._map.pixelToPoint({x:0,y:0},cR);var cO=this._map.pixelToPoint({x:this._map.width,y:this._map.height},cR);var cM=this._overviewMap.pixelToPoint({x:0,y:0},this._curOMZoomLevel);var cN=this._overviewMap.pixelToPoint({x:this._overviewMap.width,y:this._overviewMap.height},this._curOMZoomLevel);this._wRatio=(cO.lng-cT.lng)/(cN.lng-cM.lng);this._hRatio=(cO.lat-cT.lat)/(cN.lat-cM.lat);if(this._wRatio>=1||this._hRatio>=1){this._omViewMv.style.display="none";this._omView.hide()}else{var cP=parseInt(this._overviewMap.width);var T=parseInt(this._overviewMap.height);var cS=Math.round(cP*this._wRatio);var cQ=Math.round(T*this._hRatio);if(this._map.getMapType()==BMAP_PERSPECTIVE_MAP){cQ=T*0.35}this._omView.show();this._omView.setDimension(cS,cQ);this._omViewMv.style.display=""}this._setOMViewMvPos()},_setOMViewMvPos:function(){if(!this._omView||!this._omView.getContainer()){return}if(this._wRatio>=1||this._hRatio>=1){this._omViewMv.style.display="none";return}var cM=this._omView.getContainer().style;this._omViewMv.style.display="";this._omViewMv.style.width=cM.width;this._omViewMv.style.height=cM.height;var T=parseInt(cM.width)-2;var cN=parseInt(cM.height)-2;T=T<0?0:T;cN=cN<0?0:cN;this._omViewMvInn.style.width=T+"px";this._omViewMvInn.style.height=cN+"px";this._omViewInn.style.width=this._omViewMvInn.style.width;this._omViewInn.style.height=this._omViewMvInn.style.height;this._omViewMv.style.left=parseInt(cM.left)+this._overviewMap.offsetX+"px";this._omViewMv.style.top=parseInt(cM.top)+this._overviewMap.offsetY+"px"},setSize:function(cN){if(!(cN instanceof aI)){cN=new aI(150,150)}var cM=cN.width;var cO=cN.height;cM=cM>0?cM:150;cO=cO>0?cO:150;cN.width=cM;cN.height=cO;this._opts.size=cN;if(!this._container){return}if(this.changeView._running==true){var T=arguments;var cP=this;setTimeout(function(){T.callee.call(cP,cN)},120);return}N(this._container,[cM,cO]);var cP=this;setTimeout(function(){if(cP._overviewMap&&cP._map){cP._overviewMap.setCenter(cP._map.getCenter())}},100);this.setAnchor(this._opts.anchor);this.dispatchEvent(new bh("resize"))},setOffset:function(T){if(!(T instanceof aI)){return}cq.prototype.setOffset.call(this,T);if(!this._container){return}if(T.width!=0||T.height!=0){a9.dom.addClass(this._container,"withOffset")}else{a9.dom.removeClass(this._container,"withOffset")}},_redraw:function(){if(!this._omCanvas){return}var cN=this._opts.size.width;var cQ=this._opts.size.height;var cS=this._opts.padding;var T=this._borderWidth;var cO=0;var cR=0;var cM=0;var cP=0;this._omCanvas.style.left=this._omCanvas.style.top=this._omCanvas.style.right=this._omCanvas.style.bottom="auto";this._omBtn.style.left=this._omBtn.style.top=this._omBtn.style.right=this._omBtn.style.bottom="auto";if(this._opts.offset.width==0&&this._opts.offset.height==0){switch(this._opts.anchor){case BMAP_ANCHOR_TOP_LEFT:this._omCanvas.style.left="0px";this._omCanvas.style.top="0px";break;case BMAP_ANCHOR_TOP_RIGHT:this._omCanvas.style.left=cS+"px";this._omCanvas.style.top="0px";break;case BMAP_ANCHOR_BOTTOM_LEFT:this._omCanvas.style.top=cS+"px";this._omCanvas.style.left="0px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:this._omCanvas.style.top=cS+"px";this._omCanvas.style.left=cS+"px";break;default:break}cO=cN-T;cR=cQ-T;cM=cO-cS-2*T;cP=cR-cS-2*T;if(a9.browser.ie&&document.compatMode=="BackCompat"){cO=cO+1;cR=cR+1;cM=cM+2;cP=cP+2}}else{this._omCanvas.style.left=this._omCanvas.style.top=this._omCanvas.style.right=this._omCanvas.style.bottom=cS+"px";cO=cN-2*T;cR=cQ-2*T;cM=cO-2*cS-2*T;cP=cR-2*cS-2*T;if(this._opts.offset.width!=0||this._opts.offset.height!=0){a9.dom.addClass(this._container,"withOffset")}if(a9.browser.ie&&document.compatMode=="BackCompat"){cO=cO+2;cR=cR+2;cM=cM+2;cP=cP+2}}if(cO>0&&cR>0){N(this._container.children[0],[cO,cR])}if(cM>0&&cP>0){N(this._omCanvas,[cM,cP])}this._setBtnPosition();a9.dom.removeClass(this._omBtn,"BMap_omBtnClosed");if(!this._opts.isOpen){this._container.style.width=this._btnWidth+"px";this._container.style.height=this._btnHeight+"px";if(a9.browser.ie){this.changeView._preBtnTop=this._omBtn.style.top;this.changeView._preBtnLeft=this._omBtn.style.left;this._omBtn.style.left="0";this._omBtn.style.top="0"}a9.dom.addClass(this._omBtn,"BMap_omBtnClosed")}},_setQuad:function(){var cM=this._container;if(!cM){return}var T=this._quad;switch(this._opts.anchor){case BMAP_ANCHOR_TOP_LEFT:this._quad=2;break;case BMAP_ANCHOR_TOP_RIGHT:this._quad=1;break;case BMAP_ANCHOR_BOTTOM_LEFT:this._quad=3;break;case BMAP_ANCHOR_BOTTOM_RIGHT:this._quad=4;break;default:break}a9.dom.removeClass(cM,"quad"+T);a9.dom.addClass(cM,"quad"+this._quad)},_setBtnPosition:function(){if(!a9.browser.ie){switch(this._quad){case 2:this._omBtn.style.top="0";this._omBtn.style.left="0";break;case 1:this._omBtn.style.top="0";this._omBtn.style.right="0";break;case 4:this._omBtn.style.bottom="0";this._omBtn.style.right="0";break;case 3:this._omBtn.style.bottom="0";this._omBtn.style.left="0";break;default:break}}else{var cO=this._btnWidth;var cM=this._btnHeight;var T=this._opts.size.width;var cN=this._opts.size.height;this._omBtn.style.left="auto";this._omBtn.style.top="auto";this._omBtn.style.right="auto";this._omBtn.style.bottom="auto";switch(this._quad){case 2:this._omBtn.style.left="0px";this._omBtn.style.top="0px";break;case 1:this._omBtn.style.left=T-cO+"px";this._omBtn.style.top="0px";break;case 4:this._omBtn.style.top=cN-cM+"px";this._omBtn.style.left=T-cO+"px";break;case 3:this._omBtn.style.left="0px";this._omBtn.style.top=cN-cM+"px";break;default:break}}},_moveView:function(){if(this._omView){this._omView.setPosition(this._map.getCenter())}},_onMainMoveEnd:function(T){switch(this._currentOp){case"dragMap":this._setOMViewMvPos();this._currentOp="";break;case"dragView":this._omViewMv.style.display="none";this._overviewMap.panTo(this._map.getCenter(),{duration:90});this._currentOp="";break;default:if(this._overviewMap){this._overviewMap.panTo(this._map.getCenter(),{duration:90})}break}},_onMainZoomEnd:function(){if(!this._overviewMap){return}var T=this;T._curOMZoomLevel=T._getCurOMZoomLevel();setTimeout(function(){T._overviewMap.centerAndZoom(T._map.getCenter(),T._curOMZoomLevel);T._omView.setPosition(T._map.getCenter());T._setRatio()},100)},_onViewMapMoveEnd:function(){if(this._currentOp!="dragMap"){this._setOMViewMvPos();this._overviewMap.config.enableMouseDown=true}},remove:function(){cq.prototype.remove.call(this);this._omCanvas=null;this._omMapContainer=null;this._omView=null;this._omViewInn=null;this._omViewMv=null;this._omViewMvInn=null;this._omBtn=null;this._overviewInitialized=false;this._overviewMap=null},isOpen:function(){if(!this._container){return false}return this._opts.isOpen}});function N(cN,T){var cM=cN.style;cM.width=T[0]+"px";cM.height=T[1]+"px"}a9.object.extend(bL.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){cq.prototype.initialize.call(this,T);this._render();this._setParam();this._updateScale();this._bind(T);return this._container},_setParam:function(){this._numberArray={us:[5280*5000,5280*2500,5280*2000,5280*1000,5280*500,5280*200,5280*100,5280*50,5280*25,5280*20,5280*10,5280*5,5280*2,5280,2000,1000,500,200,100,50,20,10,5],metric:[10000000,5000000,2000000,1000000,500000,200000,100000,50000,25000,20000,10000,5000,2000,1000,500,200,100,50,20,10,5,2,1]}},_bind:function(cM){var T=this;cM.addEventListener("zoomend",function(){T._updateScale()});cM.addEventListener("moveend",function(){T._updateScale()});cM.addEventListener("maptypechange",function(){T.setColor(T._map.getMapType().getTextColor())})},_render:function(){cq.prototype._render.call(this);a9.dom.addClass(this._container,"BMap_scaleCtrl");this._container.innerHTML=this._generateHTML();this.setColor(this._map.getMapType().getTextColor());this._scaleText=this._container.children[0];cq.prototype._setPosition.call(this)},_generateHTML:function(){var cM=cd.imgPath+"mapctrls.png";var T=\'<div class="BMap_scaleTxt" unselectable="on"></div><div class="BMap_scaleBar BMap_scaleHBar"><img style="border:none" src="\'+cM+\'"/></div><div class="BMap_scaleBar BMap_scaleLBar"><img style="border:none" src="\'+cM+\'"/></div><div class="BMap_scaleBar BMap_scaleRBar"><img style="border:none" src="\'+cM+\'"/></div>\';return T},setColor:function(T){this._opts.color=T+"";if(!this._container){return}this._container.children[0].style.backgroundColor="transparent";this._container.children[0].style.color=T;for(var cN=1,cM=this._container.children.length;cN<cM;cN++){this._container.children[cN].style.backgroundColor=T}},setUnit:function(T){this._opts.unit=this._units[T]&&this._units[T].name||this._opts.unit;if(!this._map){return}this._updateScale()},_setScaleText:function(cM,T){this._scaleText.innerHTML=cM+"&nbsp;"+T},_updateScale:function(){if(!this._map||!this._container){return}var cM=10;var cP=new ce(this._map.getCenter().lng,this._map.getCenter().lat+cM);var cQ=Math.abs(this._map.pointToPixel(this._map.getCenter()).y-this._map.pointToPixel(cP).y);var cU=bb.getDistanceByLL(this._map.getCenter(),cP)/cQ;if(cU==0||isNaN(cU)){return}var cS=this._convertUnit(cU,this._opts.unit);var T=0;var cN=this._units[this._opts.unit].incon;var cR=this._map.getZoom();var cO=this._numberArray[this._opts.unit][this._map.getZoom()-1];T=cO/cS;var cT=cO>=cN?this._units[this._opts.unit].u2:this._units[this._opts.unit].u1;if(cO>=cN){cO=Math.round(cO/cN)}this._setScaleText(cO,cT);if(Math.round(T)%2!=0&&a9.browser.ie==6){T=T+1}this._container.style.width=Math.round(T)+"px";if(this._map.mapType==BMAP_PERSPECTIVE_MAP){this._container.style.width=Math.round(T)*3+"px";this._setScaleText(cO*3,cT)}},_convertUnit:function(T,cM){cM=cM||"metric";if(this._units[cM]){return T*this._units[cM].conv}return T}});a9.extend(aM.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){this._initParams();cq.prototype.initialize.call(this,T);cq.prototype._render.call(this);cq.prototype._setPosition.call(this);switch(this._opts.type){case BMAP_MAPTYPE_CONTROL_DROPDOWN:this._createBtnsDropDown();break;default:this._createBtnsDefault()}this._bind();this._draw();return this._container},_initParams:function(){this._mapTypeRel=[[BMAP_HYBRID_MAP,BMAP_SATELLITE_MAP,true]];this._btnDoms=[];this._lblDoms=[]},_createBtnsDefault:function(){var cM=this._opts.mapTypes;for(var cO=0;cO<cM.length;cO++){if(!this._isMapTypeExist(this._getParentMapType(cM[cO]))){this._createNormalBtn(cM[cO],cO)}}for(var cO=0;cO<cM.length;cO++){if(this._isMapTypeExist(this._getParentMapType(cM[cO]))){this._createLabelBtn(cM[cO],cO)}}var cN=this._btnDoms[0];cN.firstChild.style.borderRadius="3px 0 0 3px";var T=this._btnDoms[this._btnDoms.length-1];T.firstChild.style.borderRight="1px solid #8ba4dc";if(cN==T){T.firstChild.style.borderRadius="3px"}else{T.firstChild.style.borderRadius="0 3px 3px 0"}this._container.style.whiteSpace="nowrap";this._container.style.cursor="pointer"},_isMapTypeExist:function(cM){for(var T=0;T<this._opts.mapTypes.length;T++){if(this._opts.mapTypes[T]==cM){return true}}return false},_getParentMapType:function(cM){for(var T=0;T<this._mapTypeRel.length;T++){if(this._mapTypeRel[T][0]==cM){return this._mapTypeRel[T][1]}}return null},_getInputCheckedInfo:function(cM){for(var T=0;T<this._mapTypeRel.length;T++){if(this._mapTypeRel[T][0]==cM){return this._mapTypeRel[T][2]}}return false},_createNormalBtn:function(cR,cN){var cQ=this;var cO=ab("div");cx(cO);var cP=cO.style;cP.boxShadow="2px 2px 3px rgba(0, 0, 0, 0.35)";cP.borderLeft="1px solid #8ba4dc";cP.borderTop="1px solid #8ba4dc";cP.borderBottom="1px solid #8ba4dc";cP.background="white";cP.padding="2px 6px";cP.font="12px "+cd.fontFamily;cP.lineHeight="1.3em";cP.textAlign="center";cP.whiteSpace="nowrap";cO.innerHTML=cR.getName();cO.title=cR.getTips();cO.onclick=function(){cQ._map.setMapType(cQ._getProperMapType(cR))};var cM=ab("div");cx(cM);var T=cM.style;if(a9.browser.ie){T.styleFloat="left"}else{T.cssFloat="left"}cM.appendChild(cO);this._btnDoms[cN]=cM;if(!this._btnDoms[cN+1]){this._container.appendChild(cM)}else{this._container.insertBefore(cM,this._btnDoms[cN+1])}},_createLabelBtn:function(cN,cR){var cS=this._getParentMapType(cN);var cP=this._getMapTypeIndex(cS);var cM=this._btnDoms[cP];var cT=this;cM.onmouseover=function(){if((cT._map.getMapType()==cS||cT._map.getMapType()==cN)&&this._labelDom){if(this._hideLabelTimer){clearTimeout(this._hideLabelTimer);this._hideLabelTimer=null}if(this._labelDom){a9.dom.show(this._labelDom)}}};cM.onmouseout=function(){var cW=this;if(this._hideLabelTimer){clearTimeout(this._hideLabelTimer);this._hideLabelTimer=null}this._hideLabelTimer=setTimeout(function(){if(cW._labelDom){a9.dom.hide(cW._labelDom)}},1000)};cM.onmousedown=function(){if(this._hideLabelTimer){clearTimeout(this._hideLabelTimer);this._hideLabelTimer=null}if(this._labelDom){a9.dom.show(this._labelDom)}};cM._childMapType=cN;var cV=ab("div");cx(cV);labelContainerStyle=cV.style;labelContainerStyle.position="absolute";labelContainerStyle.top=this._btnDoms[cP].offsetHeight+"px";var cQ=this.getAnchor();if(this._getBtnNum()==1){if(cQ==BMAP_ANCHOR_TOP_LEFT||cQ==BMAP_ANCHOR_BOTTOM_LEFT){labelContainerStyle.left="0"}else{labelContainerStyle.right="0"}}else{if(cP==0||cP!=this._btnDoms.length-1){var T=0,cU=0;while(cU<cP){if(this._btnDoms[cU]){T+=this._btnDoms[cU].offsetWidth}cU++}labelContainerStyle.left=T+"px"}else{labelContainerStyle.right="0"}}labelContainerStyle.zIndex="-1";labelContainerStyle.display="none";var cO=this._getInputCheckedInfo(cN)?\'checked="checked"\':"";cV.innerHTML=\'<div title="\'+cN.getTips()+\'" style="border-right:1px solid #8ba4dc;border-bottom:1px solid #8ba4dc;border-left:1px solid #8ba4dc;background:white;font:12px \'+cd.fontFamily+\';padding:0 8px 0 6px;line-height:1.6em;box-shadow:2px 2px 3px rgba(0, 0, 0, 0.35)"><span \'+cO+\'" class="BMap_checkbox"></span><label style="vertical-align: middle; cursor: pointer;">\'+(cN.getLabelText()||cN.getName())+"</label></div>";cV.onclick=function(){cT._map.setMapType(cT._getProperMapType(cN))};cV.onmouseover=function(cW){if(cM._hideLabelTimer){clearTimeout(cM._hideLabelTimer);cM._hideLabelTimer=null}a9.dom.show(this);aQ(cW)};cV.onmouseout=function(){var cW=this;if(cM._hideLabelTimer){clearTimeout(cM._hideLabelTimer);cM._hideLabelTimer=null}cM._hideLabelTimer=setTimeout(function(){if(cW){a9.dom.hide(cW)}},1000)};cM._lblDom=this._lblDoms[cR]=cV;cM.appendChild(cV);cM._labelDom=cV},_createBtnsDropDown:function(){var cO=ab("div");cx(cO);cO.title="\u66f4\u6539\u5730\u56fe\u7c7b\u578b";var cQ=cO.style;cQ.font="bold 12px/1.5em "+cd.fontFamily;cQ.background="#fff";cQ.boxShadow="2px 2px 3px rgba(0, 0, 0, 0.35)";cQ.padding="0 6px";cQ.border="1px solid #8ba4dc";cO.innerHTML=\'<span style="float:right;font-family:\'+cd.fontFamily+\'">\u25bc</span>\'+this._map.getMapType().getName();this._mainBtn=cO;var cM=ab("div");cx(cM);dropDownStyle=cM.style;dropDownStyle.position="relative";dropDownStyle.zIndex="-1";dropDownStyle.background="#fff";dropDownStyle.display="none";dropDownStyle.borderLeft=dropDownStyle.borderRight=dropDownStyle.borderBottom="1px solid #8ba4dc";var T=this._opts.mapTypes;for(var cN=0;cN<T.length;cN++){if(!this._isMapTypeExist(this._getParentMapType(T[cN]))){this._createNormalBtnDropDown(T[cN],cN,cM)}}var cP=ab("div");cP.style.borderTop="1px solid rgb(220, 220, 220)";cP.style.margin="1px 4px";cM.appendChild(cP);for(var cN=0;cN<T.length;cN++){if(this._isMapTypeExist(this._getParentMapType(T[cN]))){this._createLabelBtnDropDown(T[cN],cN,cM)}}this._container.style.width="85px";this._container.style.whiteSpace="nowrap";this._container.style.cursor="pointer";this._container.appendChild(cO);this._container.appendChild(cM);cO._dropDownContainer=cM;cO.onclick=function(){if(this._hideDropDownTimer){clearTimeout(this._hideDropDownTimer);this._hideDropDownTimer=null}if(this._dropDownContainer){this._dropDownContainer.style.display=this._dropDownContainer.style.display=="none"?"":"none"}};cO.onmouseout=function(){if(this._hideDropDownTimer){clearTimeout(this._hideDropDownTimer);this._hideDropDownTimer=null}var cR=this;this._hideDropDownTimer=setTimeout(function(){if(cR._dropDownContainer){a9.dom.hide(cR._dropDownContainer)}},1000)};cM.onmouseover=function(){if(cO._hideDropDownTimer){clearTimeout(cO._hideDropDownTimer);cO._hideDropDownTimer=null}a9.dom.show(this)};cM.onmouseout=function(){if(cO._hideDropDownTimer){clearTimeout(cO._hideDropDownTimer);cO._hideDropDownTimer=null}cO._hideDropDownTimer=setTimeout(function(){if(cO._dropDownContainer){a9.dom.hide(cO._dropDownContainer)}},1000)}},_createNormalBtnDropDown:function(cQ,cN,T){var cM=ab("div");cx(cM);var cP=cM.style;cP.color="#000";cP.font="12px/1.6em "+cd.fontFamily;cP.background="#fff";cP.padding="1px 6px";if(a9.browser.ie<8){cP.zoom="1"}cM.innerHTML=cQ.getName();cM.title=cQ.getTips();var cO=this;cM.onclick=function(){cO._map.setMapType(cO._getProperMapType(cQ))};T.appendChild(cM);this._btnDoms[cN]=cM},_createLabelBtnDropDown:function(cO,cR,T){var cN=ab("div");cx(cN);var cU=cN.style;cU.font="12px/1.6em "+cd.fontFamily;cU.padding="1px 0 1px 4px";cU.whiteSpace="nowrap";cN.title=cO.getTips();var cP=this._getInputCheckedInfo(cO)?\'checked="checked"\':"";cN.innerHTML="<span "+cP+\' class="BMap_checkbox"></span><label style="vertical-align:middle;cursor:pointer">\'+(cO.getLabelText()||cO.getName())+"</label>";var cT=this;cN.onclick=function(){cT._map.setMapType(cT._getProperMapType(cO))};T.appendChild(cN);this._lblDoms[cR]=cN;var cS=this._getParentMapType(cO);var cQ=this._getMapTypeIndex(cS);var cM=this._btnDoms[cQ];cM._childMapType=cO;cM._lblDom=cN},_getBtnNum:function(){var T=0;for(var cM=0;cM<this._btnDoms.length;cM++){if(this._btnDoms[cM]){T++}}return T},_getMapTypeIndex:function(cM){for(var T=0;T<this._opts.mapTypes.length;T++){if(this._opts.mapTypes[T]==cM){return T}}return -1},_getProperMapType:function(cN){for(var T=0;T<this._mapTypeRel.length;T++){if(this._mapTypeRel[T][0]==cN&&this._map.getMapType()==cN&&this._isMapTypeExist(this._mapTypeRel[T][1])){return this._mapTypeRel[T][1]}if(this._mapTypeRel[T][1]==cN){var cO=this._lblDoms[this._getMapTypeIndex(this._mapTypeRel[T][0])];if(cO){var cM=cO.getElementsByTagName("span")[0];if(cM.checked==""){b3.dom.removeClass(cM,"checked");return cN}else{return this._mapTypeRel[T][0]}}}}return cN},_renderSelBtn:function(cM){var T=cM.style;T.background="#8ea8e0";T.color="#fff";T.fontWeight="bold"},_renderUnSelBtn:function(cM){var T=cM.style;T.background="#fff";T.color="#000";T.fontWeight=""},_bind:function(){var T=this;T._map.addEventListener("onmaptypechange",function(cM){T._draw()})},_draw:function(){switch(this._opts.type){case BMAP_MAPTYPE_CONTROL_DROPDOWN:this._drawDropDown();break;default:this._drawDefault()}},_drawDefault:function(){var cN=this._map.getMapType();for(var T=0;T<this._opts.mapTypes.length;T++){var cM=null;if(!this._btnDoms[T]){continue}if(cN==this._opts.mapTypes[T]){this._renderSelBtn(this._btnDoms[T].children[0]);if(this._btnDoms[T]._childMapType&&this._btnDoms[T]._lblDom){cM=this._btnDoms[T]._lblDom.getElementsByTagName("span")[0];cM.checked="";b3.dom.removeClass(cM,"checked")}}else{if(this._btnDoms[T]._childMapType==cN){this._renderSelBtn(this._btnDoms[T].children[0]);var cO=this._btnDoms[T]._lblDom;cM=cO.getElementsByTagName("span")[0];if(cO){cM.checked="checked";b3.dom.addClass(cM,"checked")}}else{this._renderUnSelBtn(this._btnDoms[T].children[0]);if(this._btnDoms[T]._lblDom){a9.dom.hide(this._btnDoms[T]._lblDom);clearTimeout(this._btnDoms[T]._hideLabelTimer);this._btnDoms[T]._hideLabelTimer=null}}}}},_drawDropDown:function(){var cQ=this._map.getMapType();var cN=false;var cM=false;for(var cO=0;cO<this._opts.mapTypes.length;cO++){var cP=null;if(cQ==this._opts.mapTypes[cO]&&this._btnDoms[cO]){cN=true;this._mainBtn.innerHTML=\'<span style="float:right;font-family:\'+cd.fontFamily+\'">\u25bc</span>\'+this._map.getMapType().getName();var T=this._btnDoms[cO];if(T&&T._childMapType&&T._lblDom){a9.dom.show(T._lblDom);cP=T._lblDom.getElementsByTagName("span")[0];cP.checked="";b3.dom.removeClass(cP,"checked")}}else{if(this._btnDoms[cO]&&this._btnDoms[cO]._childMapType==cQ){cM=true;this._mainBtn.innerHTML=\'<span style="float:right;font-family:\'+cd.fontFamily+\'">\u25bc</span>\'+this._getParentMapType(cQ).getName();var cR=this._btnDoms[cO]._lblDom;if(cR){a9.dom.show(cR);cP=cR.getElementsByTagName("span")[0];cP.checked="checked";b3.dom.addClass(cP,"checked")}}else{if(this._btnDoms[cO]){var cR=this._btnDoms[cO]._lblDom;if(cR){a9.dom.hide(cR)}}}}}if(!cN&&!cM){this._mainBtn.innerHTML=\'<span style="float:right;font-family:\'+cd.fontFamily+\'">\u25bc</span>\'+this._map.getMapType().getName()}},remove:function(){this._btnDoms=this._lblDoms=[];this._mainBtn=null;cq.prototype.remove.call(this)}});');
﻿_jsload&&_jsload('marker', 'a9.extend(Z.prototype,{initialize:function(T){this.map=T;this._addDom();this._bind();if(this._menu){this._menu.initialize(this.map,this)}this.domElement.guid=this.guid;a9.lang.Class.call(this,this.guid);if(!this._visible){a9.dom.hide(this.domElement)}return this.domElement},_bind:function(){if(!this.domElement){return}var T=this;var cN=this.map;function cM(cS,cR){var cQ=cS.srcElement||cS.target;var cP=cS.clientX||cS.pageX;var cU=cS.clientY||cS.pageY;if(cS&&cR&&cP&&cU&&cQ){var cT=a9.dom.getPosition(cN.container);var cO=cH();cR.pixel=new bv(cP-cT.left+cO[1],cU-cT.top+cO[0]);cR.point=cN.pixelToPoint(cR.pixel);return cR}else{return cR}}a9.on(this.domElement,"mouseover",function(cO){if(!T._dragstarted){T.dispatchEvent(cM(cO,new bh("onmouseover").inherit(cO)))}});a9.on(this.domElement,"mouseout",function(cO){if(!T._dragstarted){T.dispatchEvent(cM(cO,new bh("onmouseout").inherit(cO)))}});if(T._config.clickable){a9.on(this.domElement,"touchstart",function(cO){T._bind._touchStartPos=new bv(cO.changedTouches[0].clientX,cO.changedTouches[0].clientY)});a9.on(this.domElement,"touchend",function(cQ){var cP=aF(),cO=new bv(cQ.changedTouches[0].clientX,cQ.changedTouches[0].clientY);if(Math.abs(cO.x-T._bind._touchStartPos.x)>10||Math.abs(cO.y-T._bind._touchStartPos.y)>10){T._bind._touchStartPos=null;return}T.dispatchEvent(cM(cQ,new bh("onclick").inherit(cQ)));if(cP-T._dblclickTime<T.map.config.clickInterval){T.dispatchEvent(cM(cQ,new bh("ondblclick").inherit(cQ)))}T._dblclickTime=cP});a9.on(this.domElement,"click",function(cP){var cO=cP.srcElement||cP.target;while(cO){if(cO==T.domElement){if(!(T instanceof ae)||T instanceof ae&&(!T._lastPt||T._lastPt&&T.getPosition().equals(T._lastPt))){T.dispatchEvent(cM(cP,new bh("onclick").inherit(cP)))}break}else{if(T.map&&T.map.infoWindowDoms&&cO==T.map.infoWindowDoms.popDom){break}}cO=cO.parentNode}});a9.on(this.domElement,"dblclick",function(cO){T.dispatchEvent(cM(cO,new bh("ondblclick").inherit(cO)));cp(cO)});if(!a9.browser.firefox||a9.browser.firefox<4){a9.on(this.domElement,"contextmenu",function(cO){T.dispatchEvent(cM(cO,new bh("onrightclick").inherit(cO)))})}}a9.on(this.domElement,"mousedown",function(cO){if(T instanceof ae){T._lastPt=T.getPosition()}T.dispatchEvent(cM(cO,new bh("onmousedown").inherit(cO)))});a9.on(this.domElement,"mouseup",function(cO){T.dispatchEvent(cM(cO,new bh("onmouseup").inherit(cO)));if(a9.browser.firefox>=4&&cO.button==2&&T._config.clickable){T.dispatchEvent(cM(cO,new bh("onrightclick").inherit(cO)))}})},hide:function(){if(this._visible==false){return}this._visible=false;bH.prototype.hide.call(this);if(this.infoWindow&&this.infoWindow.overlay&&this.infoWindow.overlay==this){this.closeInfoWindow()}},show:function(){if(this._visible==true){return}this._visible=true;bH.prototype.show.call(this)},setConfig:function(cM){if(!cM){return}for(var T in cM){if(typeof(this._config[T])==typeof(cM[T])){this._config[T]=cM[T]}}},setZIndex:function(T){var cM=this;cM.zIndex=T;cM._updateDomZIndex()},_updateDomZIndex:function(){var cM=this,T;if(ci(cM.zIndex)){T=cM.zIndex}else{T=0;if(cM.map&&cM.getPosition()){var cN=cM.getPosition()?cM.getPosition().lat:0;T=bH.getZIndex(cN)+(cM._config.baseZIndex||0)}}if(cM.domElement){cM.domElement.style.zIndex=T}},addContextMenu:function(T){this._menu=T;if(this.map){T.initialize(this.map,this)}},removeContextMenu:function(){this._menu.remove();this._menu=null}});var bk=new M(cd.imgPath+"marker_red_hd.png",new aI(47,50),{anchor:new aI(20,50),infoWindowAnchor:new aI(20,0)});var ai=3;var by=4;ae.TOP_ZINDEX=bH.getZIndex(-90)+1000000;ae.DRAG_ZINDEX=ae.TOP_ZINDEX+1000000;ae._getAnimationName=function(cN){if(ae._cssAniNames[cN]){return ae._cssAniNames[cN]}var cO=ae._cssAniNames[cN]=["BMap_"+Math.round(Math.random()*10000),"BMap_"+Math.round(Math.random()*10000)];var T=b1[cN];var cM=ae._styleElement;if(!cM){cM=ae._styleElement=ab("style",{type:"text/css"});document.getElementsByTagName("head")[0].appendChild(cM)}cM.textContent+=ae._generateAniCSS(T.iconAnis,cO[0])+ae._generateAniCSS(T.shadowAnis,cO[1]);return ae._cssAniNames[cN]};ae._generateAniCSS=function(cN,cM){var T=["@-webkit-keyframes "+cM+" {\\n"];a9.array.each(cN,function(cO){T.push(cO.percent*100,"% { ");T.push("-webkit-transform: translate(",cO.translate[0],"px,",cO.translate[1],"px); ");T.push("-webkit-animation-timing-function: ",cO.timingFunc,"; ");T.push("}\\n")});T.push("}\\n");return T.join("")};ae._addDragCrossImg=function(cM,T){if(!ae._dragCrossImg){ae._dragCrossImg=ab("img",{src:cd.imgPath+"drag_cross.png",width:13,height:9});ae._dragCrossImg.style.position="absolute";if(a9.browser.ie==6){delete ae._dragCrossImg;var cO=ae._dragCrossImg=ab("div");var cN=cO.style;cN.position="absolute";cN.width="13px";cN.height="9px";cN.filter=\'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image,src="\'+cd.imgPath+\'drag_cross.png")\'}}var cN=ae._dragCrossImg.style;cN.left=cM.width-6+"px";cN.top=cM.height-5+"px";T.appendChild(ae._dragCrossImg)};ae._removeDragCrossImg=function(){if(ae._dragCrossImg&&ae._dragCrossImg.parentNode){ae._dragCrossImg.parentNode.removeChild(ae._dragCrossImg)}};ae._cssAniNames=[];ae._aniEndHandler=function(){this.style.WebkitAnimation=""};a9.extend(ae.prototype,{initialize:function(T){this._initParam();Z.prototype.initialize.call(this,T);if(!this._visible){a9.dom.hide(this.siblingElement)}if(T.highResolutionEnabled()&&this._config.icon==av){this._config.icon=bk}this.setPosition(this.point);this.setIcon(this._config.icon);this.setShadow(this._config.shadow);if(this._config.label&&this._cfgLabelEvent){this._config.label.addEventListener("remove",this._cfgLabelEvent)}this.setLabel(this._config.label);this.setTitle(this._config.title);this._initDrag();return this.domElement},_initParam:function(){if(this._init){return}this._init=true;this.domElement=null;this.shadowElement=null;this.siblingElement=null;this.iconDom=null;this._isDragging=false},_addDom:function(){var T=this.map.getPanes();this.domElement=au(T.markerMouseTarget,this._msTargetRender());this.siblingElement=au(T.markerPane,this._markerRender());this.siblingElement.guid=this.guid},_msTargetRender:function(){var T=[\'<span class="BMap_Marker BMap_noprint" unselectable="on" \'];T.push(this._config.title?\'title="\'+this._config.title+\'"\':\'"\');T.push(\' style="position:absolute;padding:0;margin:0;border:0;width:0;height:0;-moz-user-select:none;\');T.push(this._config.clickable?"cursor:pointer;":"");T.push("background:url("+cd.imgPath+"blank.gif);");T.push("width:"+this._config.icon.size.width+"px;");T.push("height:"+this._config.icon.size.height+"px;");T.push(\'"></span>\');return T.join("")},_markerRender:function(){var T=[\'<span class="BMap_Marker" unselectable="on" \'];T.push(\'style="position:absolute;padding:0;margin:0;border:0;\');T.push(\'width:0;height:0;-moz-user-select:none"></span>\');return T.join("")},_shadowRender:function(){var T=[\'<span unselectable="on" \'];T.push(\'style="position:absolute;padding:0;margin:0;border:0;\');T.push(\'width:0;height:0;-moz-user-select:none"></span>\');return T.join("")},draw:function(){if(!this.domElement){return}var T=this._getPixPos();this.domElement.style.left=T[0].x+"px";this.domElement.style.top=T[0].y+"px";if(this.siblingElement){this.siblingElement.style.left=T[0].x+"px";this.siblingElement.style.top=T[0].y+"px"}if(this.shadowElement){this.shadowElement.style.left=T[1].x+"px";this.shadowElement.style.top=T[1].y+"px"}if(this.infoWindow!=null&&this.infoWindow.isOpen()){this.infoWindow.setPosition()}this._updateDomZIndex()},_getPixPos:function(){var cQ=this._config.offset||new aI(0,0);var T=this._config.icon.anchor||new aI(0,0);var cM=this.map.pointToOverlayPixel(this.getPosition());var cP=new bv(cM.x+cQ.width-T.width,cM.y+cQ.height-T.height);var cO=[cP];if(this._config.shadow){var cR=this._config.shadow.anchor||new aI(0,0),cN=new bv(cM.x+cQ.width-cR.width,cM.y+cQ.height-cR.height);cO[1]=cN}return cO},_draw:function(){if(this.map){this.domElement=this.initialize(this.map);if(this._animation){this.setAnimation(this._animation);delete this._animation}}else{delete this._animation}},remove:function(){this.setAnimation(null);if(this.siblingElement&&this.siblingElement.parentNode){this.siblingElement.parentNode.removeChild(this.siblingElement)}if(this.shadowElement&&this.shadowElement.parentNode){this.shadowElement.parentNode.removeChild(this.shadowElement)}if(this.infoWindow&&this.infoWindow.overlay&&this.infoWindow.overlay===this){this.closeInfoWindow();this.infoWindow=null}this.siblingElement=null;this.shadowElement=null;this.iconDom=null;this.shadowDom=null;if(this._config.label){var T=this._config.label;T.removeEventListener("remove",this._cfgLabelEvent);a9.lang.decontrol(T.guid);T.setMarker(null);T.domElement=null;T=this._config.label=null}Z.prototype.remove.call(this)},hide:function(){Z.prototype.hide.call(this);if(this.domElement){a9.dom.hide(this.domElement)}if(this.siblingElement){a9.dom.hide(this.siblingElement)}if(this.shadowElement){a9.dom.hide(this.shadowElement)}},show:function(){Z.prototype.show.call(this);if(this.domElement){a9.dom.show(this.domElement)}if(this.siblingElement){a9.dom.show(this.siblingElement)}if(this.shadowElement){a9.dom.show(this.shadowElement)}},setIcon:function(cN){if(!(cN instanceof M)){return}this._config.icon=cN;if(!this.map||!this.domElement||!this.siblingElement){return}var cP=this.map;try{if(this.iconDom){this.siblingElement.removeChild(this.iconDom);this.iconDom=null}this.domElement.style.width=cN.size.width+"px";this.domElement.style.height=cN.size.height+"px"}catch(cO){}if(this._config.icon){var T=this.iconDom=ab("div");var cM=T.style;cM.position="absolute";cM.padding=cM.margin="0";cM.width=cN.size.width+"px";cM.height=cN.size.height+"px";cM.overflow="hidden";T.innerHTML=cN.getHTML();T.galleryImg=false;this.siblingElement.appendChild(this.iconDom)}this.draw()},setShadow:function(cM){if(!(cM instanceof M)){return}this._config.shadow=cM;if(!this.map||!this.domElement||!this.siblingElement){return}if(!this.shadowElement){this.shadowElement=au(this.map.getPanes().markerShadow,this._shadowRender())}var cO=this.map;try{if(this.shadowDom){this.shadowElement.removeChild(this.shadowDom);this.shadowDom=null}this.shadowElement.style.width=cM.size.width+"px";this.shadowElement.style.height=cM.size.height+"px"}catch(cN){}if(this._config.shadow){var cP=this.shadowDom=ab("div");var T=cP.style;T.position="absolute";T.padding=T.margin="0";T.width=cM.size.width+"px";T.height=cM.size.height+"px";T.overflow="hidden";cP.innerHTML=cM.getHTML();cP.galleryImg=false;this.shadowElement.appendChild(this.shadowDom)}this.draw()},setLabel:function(T){if(!(T instanceof ah)){return}this._config.label=T;var cN=this;if(!this._config.label._binded){this._config.label._binded=true;this._cfgLabelEvent=function(){cN._config.label=null};this._config.label.addEventListener("remove",this._cfgLabelEvent)}if(!this.map){return}T._i(this.map);if(T.domElement){this.siblingElement.appendChild(T.domElement)}else{T.domElement=au(this.domElement,T.render());T.domElement.guid=T.guid}var cM=T.domElement.style;cM.left=(T._config.offset.width)+"px";cM.top=(T._config.offset.height)+"px";T.setMarker(this)},_initDrag:function(){if(!this.domElement||this.domElement._binded){return}this.domElement._binded=true;var cR=this.map,cO=this,T=0,cS=0,cN=0,cQ={x:0,y:0};function cP(cU,cT){cT.pixel=cU.pixel;cT.point=cU.point;return cT}function cM(cV){var cU=cV.clientX,cT=cV.clientY;if(cV.changedTouches){cU=cV.changedTouches[0].clientX;cT=cV.changedTouches[0].clientY}return new bv(cU,cT)}this.dragStart=function(cV){if(!cO._config.enableDragging){return}if(cV.button==2){return}cO._isDragging=true;var cU=cR.pointToPixel(cO.point);var cT=cM(cV);T=cT.x-cU.x;cS=cT.y-cU.y;cN=aF();cO.map.temp._draggingMarker=cO;a9.on(document,"mousemove",cO.dragIng);a9.on(document,"mouseup",cO.dragEnd);a9.on(document,"touchmove",cO.dragIng);a9.on(document,"touchend",cO.dragEnd);if(cO.domElement&&cO.domElement.setCapture){cO.domElement.setCapture()}cO.domElement.style.cursor=cO._config.draggingCursor;if(cV.type=="touchstart"){aQ(cV)}};this.dragIng=function(cX){if(!cO._isDragging){return}var cU=cM(cX);var cV=new bv((cU.x-T),(cU.y-cS));cQ=cV;cO._draggingMovePixel=cV;if((cO._config.restrictDraggingArea&&(cV.x>15&&cV.x<cO.map.width-15)&&(cV.y>30&&cV.y<cO.map.height-15))||!cO._config.restrictDraggingArea){var cT=cO.map.pixelToPoint(cV),cW={pixel:cV,point:cT};cO._panByX=cO._panByY=0;if(cV.x<=20||cV.x>=cO.map.width-20||cV.y<=50||cV.y>=cO.map.height-10){if(cV.x<=20){cO._panByX=8}else{if(cV.x>=cO.map.width-20){cO._panByX=-8}}if(cV.y<=50){cO._panByY=8}else{if(cV.y>=cO.map.height-10){cO._panByY=-8}}if(!cO._draggingMoveTimer){cO._draggingMoveTimer=setInterval(function(){cR.panBy(cO._panByX,cO._panByY,{noAnimation:true});var cY=cR.pixelToPoint(cO._draggingMovePixel);cO.setPosition(cY)},30)}}else{if(cO._draggingMoveTimer){clearInterval(cO._draggingMoveTimer);cO._draggingMoveTimer=null}cO.setPosition(cT)}if(!cO._dragstarted){cO.dispatchEvent(cP(cW,new bh("ondragstart")));cO._dragstarted=true;if(cO._config.raiseOnDrag){cO.setAnimation(ai);ae._addDragCrossImg(cO._config.icon.anchor,cO.siblingElement)}}cO.dispatchEvent(cP(cW,new bh("ondragging")))}};this.dragEnd=function(cT){if(cO.domElement&&cO.domElement.releaseCapture){cO.domElement.releaseCapture()}cO._isDragging=false;cO.map.temp._draggingMarker=null;a9.un(document,"mousemove",cO.dragIng);a9.un(document,"mouseup",cO.dragEnd);a9.un(document,"touchmove",cO.dragIng);a9.un(document,"touchend",cO.dragEnd);T=cS=0;if(cO._draggingMoveTimer){clearInterval(cO._draggingMoveTimer);cO._draggingMoveTimer=null}if(aF()-cN>=100&&(cQ.x>2||cQ.y>2)){cO._dragstarted=false;cO.dispatchEvent(cP({pixel:cO.map.pointToPixel(cO.getPosition()),point:cO.getPosition()},new bh("ondragend")));if(cO._config.raiseOnDrag){cO.setAnimation(by);ae._removeDragCrossImg()}cQ.x=cQ.y=0}cO._updateDomZIndex();if(cO.domElement){cO.domElement.style.cursor=cO._config.clickable?"pointer":""}};a9.on(this.domElement,"mousedown",this.dragStart);a9.on(this.domElement,"touchstart",this.dragStart)},setPosition:function(T){if(T instanceof ce){this.point=this._config.point=new ce(T.lng,T.lat);this.draw()}},_updateDomZIndex:function(){var cM=this,T;if(cM._isDragging==true){T=ae.DRAG_ZINDEX}else{if(cM._config.isTop==true){T=ae.TOP_ZINDEX+(cM._addi||0)}else{if(ci(cM.zIndex)){T=cM.zIndex}else{T=0;if(cM.map&&cM.getPosition()){T=bH.getZIndex(cM.getPosition().lat)+cM._config.baseZIndex}}}}if(cM.domElement){cM.domElement.style.zIndex=T}if(cM.siblingElement){cM.siblingElement.style.zIndex=T}},setTop:function(cM,T){this._config.isTop=!!cM;if(cM){this._addi=T||0}this._updateDomZIndex()},setTitle:function(T){this._config.title=T+"";if(this.domElement){this.domElement.title=this._config.title}},setOffset:function(T){if(!(T instanceof aI)){return}this._config.offset=T;this.setPosition(this.getPosition())},setAnimation:function(cN){if(!this.iconDom){return}this._clearAnimation(cN!=null);var T=b1[cN];if(!T){return}var cM=T?T.options.useJS:false;(!aB()||cM)?this._execJSAnimation(cN):this._execCSSAnimation(cN)},_clearAnimation:function(cM){this._clearCSSAni(this.iconDom);this._clearCSSAni(this.shadowDom);if(cM){if(this._aniObj){this._aniObj.stop();this._aniObj=null}this.iconDom.style.top=this.iconDom.style.left="0px";if(this.shadowDom){this.shadowDom.style.top=this.shadowDom.style.left="0px"}}else{if(this._aniObj){var T=this;this._aniObj.setFinishCallback(function(){T._aniObj=null})}}},_execCSSAnimation:function(cM){var T=b1[cM];var cN=ae._getAnimationName(cM);this._setCSSAniStyle(this.iconDom,cN[0],T);this._setCSSAniStyle(this.shadowDom,cN[1],T)},_clearCSSAni:function(T){if(T){T.style.WebkitAnimation="";a9.un(T,"webkitAnimationEnd",ae._aniEndHandler)}},_setCSSAniStyle:function(cN,cM,T){if(cN){a9.on(cN,"webkitAnimationEnd",ae._aniEndHandler);cN.style.WebkitAnimation=cM+" "+T.options.duration+"ms"+(T.options.loop==g.INFINITE?" infinite":"")}},_execJSAnimation:function(cP){var cR=this.iconDom.style;var T=false;var cO;if(this.shadowDom){T=true;cO=this.shadowDom.style}var cM=b1[cP];var cT=this;var cS=cM.iconAnis.length,cW=cM.options.duration,cV=cT._aniObj=new g({duration:0,delay:g.INFINITE});var cU=cM.iconAnis;var cN=cM.shadowAnis;cR.top=cU[0].translate[1]+"px";if(T){cO.left=cN[0].translate[0]+"px";cO.top=cN[0].translate[1]+"px"}for(var cQ=1;cQ<cS;cQ++){(function(){var c2=[cU[cQ].translate[0]-cU[cQ-1].translate[0],cU[cQ].translate[1]-cU[cQ-1].translate[1]];var c1=[cU[cQ-1].translate[0],cU[cQ-1].translate[1]];if(T){var cZ=[cN[cQ].translate[0]-cN[cQ-1].translate[0],cN[cQ].translate[1]-cN[cQ-1].translate[1]];var cY=[cN[cQ-1].translate[0],cN[cQ-1].translate[1]]}var c0=ax[cU[cQ-1].timingFunc];var cX=function(){};if(cQ==cS-1){if(cM.options.loop!=g.INFINITE){cX=function(){cT._aniObj=null}}else{cX=function(){cT._aniObj.start()}}}cV.add(new g({duration:(cM.iconAnis[cQ].percent-cU[cQ-1].percent)*cW,fps:40,delay:g.INFINITE,transition:c0,render:function(c3){if(cT.iconDom){cT.iconDom.style.top=c1[1]+Math.round(c3*c2[1])+"px"}if(T&&cT.shadowDom){cT.shadowDom.style.left=cY[0]+Math.round(c3*cZ[0])+"px";cT.shadowDom.style.top=cY[1]+Math.round(c3*cZ[1])+"px"}},finish:cX}))})()}cV.start()}});var b1={};b1[1]={options:{duration:400},iconAnis:[{percent:0,translate:[0,-500],timingFunc:"ease-in"},{percent:0.5,translate:[0,0],timingFunc:"ease-out"},{percent:0.75,translate:[0,-20],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}],shadowAnis:[{percent:0,translate:[375,-375],timingFunc:"ease-in"},{percent:0.5,translate:[0,0],timingFunc:"ease-out"},{percent:0.75,translate:[15,-15],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}]};b1[2]={options:{duration:700,loop:g.INFINITE},iconAnis:[{percent:0,translate:[0,0],timingFunc:"ease-out"},{percent:0.5,translate:[0,-20],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}],shadowAnis:[{percent:0,translate:[0,0],timingFunc:"ease-out"},{percent:0.5,translate:[15,-15],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}]};b1[3]={options:{duration:200,useJS:true},iconAnis:[{percent:0,translate:[0,0],timingFunc:"ease-in"},{percent:1,translate:[0,-20],timingFunc:"ease-out"}],shadowAnis:[{percent:0,translate:[0,0],timingFunc:"ease-in"},{percent:1,translate:[15,-15],timingFunc:"ease-out"}]};b1[4]={options:{duration:500,useJS:true},iconAnis:[{percent:0,translate:[0,-20],timingFunc:"ease-in"},{percent:0.5,translate:[0,0],timingFunc:"ease-out"},{percent:0.75,translate:[0,-10],timingFunc:"ease-in"},{percent:1,translate:[0,-0],timingFunc:"ease-out"}],shadowAnis:[{percent:0,translate:[15,-15],timingFunc:"ease-in"},{percent:0.5,translate:[0,0],timingFunc:"ease-out"},{percent:0.75,translate:[8,-8],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}]};M.prototype.getHTML=function(){if(a9.browser.ie==6&&this.imageUrl.toLowerCase().indexOf(".png")>0){var T=["<div"];if(this.printImageUrl){T.push(\' class="BMap_noprint"\')}T.push(\' style="width: 1px; height: 1px;\');T.push("; left:"+this.imageOffset.width+"px");T.push("; top:"+this.imageOffset.height+"px");T.push("; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image,src=\'"+this.imageUrl+"\')");T.push(\'; position:absolute;"></div>\');if(this.printImageUrl){T.push(\'<img class="BMap_noscreen" style="border:none;left:\'+this.imageOffset.width+"px;");T.push("top:"+this.imageOffset.height+\'px;position:absolute" src="\'+this.printImageUrl+\'" />\')}return T.join("")}else{return[\'<img src="\',this.imageUrl,\'" style="border:none;left:\'+this.imageOffset.width+"px","; top:"+this.imageOffset.height+"px",\'; position:absolute;" />\'].join("")}};a9.extend(ah.prototype,{_addDom:function(){var cM=this._config;var cO=this.content;var T=ab("label",{"class":"BMapLabel",unselectable:"on"});if(cM.title){T.title=cM.title}var cN=T.style;cN.position="absolute";cN.MozUserSelect="none";if(cM.width==0||cM.width=="auto"){cN.display="inline"}else{cN.width=cM.width+"px";cN.display="block";cN.overflow="hidden"}if(cM.clickable=="true"){cN.cursor="pointer"}else{if(!a9.browser.ie){cN.cursor="inherit"}}T.innerHTML=cO;this.map.getPanes().labelPane.appendChild(T);this.domElement=T;this.setStyle(cM.styles);return T},setPosition:function(T){if(T instanceof ce&&!this.getMarker()){this.point=this._config.position=new ce(T.lng,T.lat);this.draw()}},draw:function(){if(this.domElement&&this.getPosition()&&!this.getMarker()){var cM=this._config.offset||new aI(0,0);var T=this.map.pointToOverlayPixel(this.getPosition());this.domElement.style.left=(T.x+cM.width)+"px";this.domElement.style.top=(T.y+cM.height)+"px";this._updateDomZIndex()}},_draw:function(){if(this.map&&!this._marker){this.domElement=this.initialize(this.map);this.draw()}},setContent:function(T){this.content=T;if(this.domElement){this.domElement.innerHTML=T}},setOpacity:function(cM){if(cM>=0&&cM<=1){this._config.opacity=cM}if(this.domElement){var T=this.domElement.style;T.opacity=cM;T.filter="alpha(opacity="+(cM*100)+")"}},setOffset:function(T){if(!(T instanceof aI)){return}this._config.offset=new aI(T.width,T.height);if(this.getMarker()&&this.domElement){this.domElement.style.left=T.width+"px";this.domElement.style.top=T.height+"px"}else{this.draw()}},setStyle:function(T){T=T||{};this._config.styles=a9.extend(this._config.styles,T);if(this.domElement){for(var cN in T){try{this.domElement.style[cN]=T[cN]}catch(cM){}}}},setTitle:function(T){this._config.title=T+"";if(this.domElement){this.domElement.title=this._config.title}}});');
﻿_jsload&&_jsload('poly', 'a9.extend(cG.prototype,{initialize:function(T){if(T&&this._graphMouseEvent){T.addEventListener("onmousemove",this._graphMouseEvent)}return Z.prototype.initialize.call(this,T)},_addDom:function(){var T=this._drawer=cs.getDrawer(this.map);this.domElement=T.addLine()},_bind:function(){var T=this.domElement;var cM=this;function cN(cT,cR){var cQ=cT.srcElement||cT.target;var cP=cH();var cO=cT.pageX?cT.pageX:(cT.clientX+cP[1]);var cV=cT.pageY?cT.pageY:(cT.clientY+cP[0]);if(cT&&cR&&cO&&cV&&cQ){var cS=a9.lang.instance(cQ.guid).map;var cU=a9.dom.getPosition(cS.container);cR.pixel=new bv(cO-cU.left,cV-cU.top);cR.point=cS.pixelToPoint(cR.pixel);return cR}else{return cR}}if(cs.getDrawer(this.map).getType()!="canvas"){if(cM._config.clickable){T.style.cursor="pointer";a9.on(T,"click",function(cO){if(cM._msDownMapCenter&&cM._msDownMapCenter.equals(cM.map.getCenter())){cM.dispatchEvent(cN(cO,new bh("onclick").inherit(cO)))}});a9.on(T,"dblclick",function(cO){cM.dispatchEvent(cN(cO,new bh("ondblclick").inherit(cO)))});if(!a9.browser.firefox||a9.browser.firefox<4){a9.on(this.domElement,"contextmenu",function(cO){cM.dispatchEvent(cN(cO,new bh("onrightclick").inherit(cO)))})}}a9.on(T,"mousedown",function(cO){cM.dispatchEvent(cN(cO,new bh("onmousedown").inherit(cO)));cM._msDownMapCenter=cM.map.getCenter()});a9.on(T,"mouseup",function(cO){cM.dispatchEvent(cN(cO,new bh("onmouseup").inherit(cO)))});a9.on(this.domElement,"mouseup",function(cO){cM.dispatchEvent(cN(cO,new bh("onmouseup").inherit(cO)));if(a9.browser.firefox>=4&&cO.button==2&&cM._config.clickable){cM.dispatchEvent(cN(cO,new bh("onrightclick").inherit(cO)))}})}T=null;if(!this._binded){this._binded=true;this._graphMouseEvent=function(cS){if(!cM.map){return}if(cM.map.temp._draggingMarker){return}var cO=cS.point,cR=cM._getProximity(cO),cQ=parseFloat(cR.dist),cP;if(cQ<cM._config.mouseOverTolerance){if(!cM._temp.ismouseover){cP=new bh("onmouseover")}else{cP=new bh("onmousemove")}cM._temp.ismouseout=false;cM._temp.ismouseover=true}else{if(!cM._temp.ismouseout&&cM._temp.ismouseover){cP=new bh("onmouseout");cM._temp.ismouseover=false;cM._temp.ismouseout=true}}if(cP){if(!(cM instanceof f)&&cP.type=="onmousemove"&&cM._temp.ismouseover==true&&(cQ==0||cQ>cM._config.mouseOverTolerance)){cP.pixel=cS.pixel;cP.point=cS.point}else{cP.point=this.overlayPixelToPoint(cR.pixel);cP.pixel=this.pointToPixel(cP.point)}cM.dispatchEvent(cP)}};this.map.addEventListener("onmousemove",this._graphMouseEvent);this.addEventListener("mouseover",function(cO){if(!this.map){return}if(this._config.enableEditing){this.addVertexs()}});this.addEventListener("mouseout",function(cO){if(!this.map){return}if(this._config.enableEditing&&!this._editstate){this.clearVertexs()}})}},draw:function(){if(!this.domElement){return}if(this._drawer){this._drawer.setPath(this.domElement,this._getDisplayPixels(this.points))}},_draw:function(){if(this.map){this.initialize(this.map);this.domElement.style.WebkitUserSelect="none";this.draw()}},_getDisplayPixels:function(cT){var T=this.map,cS=[];if(cT.length==0||!this.domElement||!this.isVisible()){return[cS]}if(!this._config.enableEditing){var cR=this.getParseCacheIndex(T.getZoom());if(this._parseCache[cR]){cT=this._parseCache[cR]}else{var cU=cf(cT,this.getParseTolerance(T.getZoom()));cT=this._parseCache[cR]=cU}}var cP=this._config.use3DCoords;cS.push(T.pointToOverlayPixel(cT[0],null,cP));for(var cO=1,cN=1,cM=cT.length;cO<cM;cO++){var cQ=T.pointToOverlayPixel(cT[cO],null,cP);if(!cQ.equals(cS[cN-1])){cS.push(cQ);cN++}}return[cS]},getParseCacheIndex:function(T){if(this._config.getParseCacheIndex){return this._config.getParseCacheIndex(T)}if(T<6){return 0}if(T<10){return 1}if(T<15){return 2}return 3},getParseTolerance:function(T){if(this._config.getParseTolerance){return this._config.getParseTolerance(T)}return cG.parseTolerance[this.getParseCacheIndex(T)]},setPath:function(T){this._parseCache.length=0;this.points=cG.getGraphPoints(T).slice(0);this._calcBounds();this.draw();this.dispatchEvent(new bh("onlineupdate"))},setPositionAt:function(cM,T){if(!T||!this.points[cM]){return}this._parseCache.length=0;this.points[cM]=new ce(T.lng,T.lat);this._calcBounds();this.draw();this.dispatchEvent(new bh("onlineupdate"))},setStrokeColor:function(T){if(this._config){this._config.strokeColor=T}this._setDomAttribute("strokecolor",T)},setStrokeWeight:function(T){if(T>0){this._config.strokeWeight=T;this._setDomAttribute("strokeweight",T);if(this.getStrokeStyle()=="dashed"&&cs.getDrawer(this.map).getType()=="svg"){this._setDomAttribute("strokestyle","dashed")}}},setStrokeOpacity:function(T){if(!T||T>1||T<0){return}this._config.strokeOpacity=T;if(!this.map){return}this._setDomAttribute("strokeopacity",T)},setFillOpacity:function(T){if(T>1||T<0){return}this._config.fillOpacity=T;this._setDomAttribute("fillopacity",T)},setStrokeStyle:function(T){if(T!="solid"&&T!="dashed"){return}this._config.strokeStyle=T;this._setDomAttribute("strokestyle",T)},setFillColor:function(T){this._config.fillColor=T||"";this._setDomAttribute("fillcolor",T)},_setDomAttribute:function(T,cM){if(this._drawer){this._drawer.setAttribute(this.domElement,T,cM||"",this.getStrokeWeight());this.dispatchEvent(new bh("onlineupdate"))}},addVertexs:function(){var cR=this;if(cR.vertexMarkers.length){return}var cS=this.getVertexPoints();var cQ;for(var cP=0,cN=cS.length;cP<cN;cP++){var T=cS[cP];if(T.t){cQ=cd.imgPath+"nodeT.gif"}else{cQ=cd.imgPath+"node.gif"}var cM=new M(cQ,new aI(11,11),{offset:new aI(5,5)});var cO=new ae(T.p,{icon:cM});cO.enableDragging(true);cO.addEventListener("ondragging",function(cT){cR._onMarkerDragging(cT)});cO.addEventListener("ondragstart",function(cT){cR._onMarkerDragstart(cT)});cO.addEventListener("ondragend",function(cT){cR._onMarkerDragend(cT)});cO.index=cP;cO.t=T.t;this.vertexMarkers.push(cO);this.map.addOverlay(cO)}},clearVertexs:function(){var T;while(T=this.vertexMarkers.pop()){this.map.removeOverlay(T);delete T}this.vertexMarkers.length=0},getVertexPoints:function(){var cP=[];for(var cO=0,cM=this.points.length;cO<cM;cO++){var cQ=this.points[cO];cP.push({p:cQ,t:0});if(cO<cM-1){var T=this.points[cO+1];var cN=new ce((cQ.lng+T.lng)/2,(cQ.lat+T.lat)/2);cP.push({p:cN,t:1})}}this.vertexPoints=cP;return cP},_onMarkerDragstart:function(T){this._editstate=false},_onMarkerDragend:function(cQ){this.vertexPoints.length=0;this._editstate=false;if(this._temp.dashedLine){this.map.removeOverlay(this._temp.dashedLine);delete this._temp.dashedLine}if(this._temp.preTNode){this.map.removeOverlay(this._temp.preTNode);delete this._temp.preTNode}if(this._temp.nexTNode){this.map.removeOverlay(this._temp.nexTNode);delete this._temp.nexTNode}var cP=cQ.currentTarget;var cR=cQ.point;var T=cP.index;var cO;if(T%2!=0){T=Math.ceil(T/2);cO=this.points.slice();var cN=this.points.length-T;var cM=cO.splice(T,cN);cO[cO.length]=cR;cO=cO.concat(cM)}else{T=T/2;this.points.splice(T,1,cR);if(this instanceof co&&this.points.length-1==T){this.points.splice(0,1,cR)}cO=this.points}this.clearVertexs();this.setPath(cO);this.addVertexs()},_getProximity:function(cY){var cM,cO,cZ,cR,cQ,cX,cW,cV=[];var c3=this.map.pointToOverlayPixel(cY);cV=this._getDisplayPixels(this.points)[0];var c6=cV.length;if(c6>1){for(var c4=1;c4<c6;c4++){var cT=cV[c4-1];var da=cV[c4];if(!cT||!da){continue}if(cT.x!=da.x){var c9=(da.y-cT.y)/(da.x-cT.x);var c7=da.y-c9*da.x;cW=Math.abs(c9*c3.x+c7-c3.y)/Math.sqrt(c9*c9+1)}else{cW=Math.abs(c3.x-da.x)}var c5=Math.pow(da.y-cT.y,2)+Math.pow(da.x-cT.x,2);var cN=Math.pow(da.y-c3.y,2)+Math.pow(da.x-c3.x,2);var c8=Math.pow(cT.y-c3.y,2)+Math.pow(cT.x-c3.x,2);var cP=Math.pow(cW,2);var T=cN-cP+c8-cP;if(T>c5){cW=Math.sqrt(Math.min(cN,c8))}if((cM==null)||(cM>cW)){cO=Math.sqrt(c8-cP)/Math.sqrt(c5);cZ=Math.sqrt(cN-cP)/Math.sqrt(c5);cM=cW;cX=c4}cM=Math.min(cM,cW)}if(!(this instanceof f)){var c1=0,c0=0,c2=this.points;for(var c4=0;c4<c6;c4++){c1=(c4==c6-1)?0:c1+1;if((c2[c4].lat!=c2[c1].lat)&&(((cY.lat>=c2[c4].lat)&&(cY.lat<c2[c1].lat))||((cY.lat>=c2[c1].lat)&&(cY.lat<c2[c4].lat)))&&(cY.lng<(c2[c1].lng-c2[c4].lng)*(cY.lat-c2[c4].lat)/(c2[c1].lat-c2[c4].lat)+c2[c4].lng)){c0++}}cM=Math.min(cM,c0%2>0?0:cM)}if(cO>1){cO=1}if(cZ>1){cO=0;cZ=1}var cU=cV[cX-1].x-cV[cX].x;var cS=cV[cX-1].y-cV[cX].y;cR=cV[cX-1].x-(cU*cO);cQ=cV[cX-1].y-(cS*cO)}return{pixel:new bv(cR,cQ),dist:cM}},show:function(){Z.prototype.show.call(this);this.draw()}});function bs(cQ,cO,cX){var cU=false,cS=false,cV=false,cZ=new bv(cQ.x,cQ.y),cY=new bv(cO.x,cO.y),cP=ba(cZ,cX),cN=ba(cY,cX),cW;var c1,c0;var cT=cX.minX,cR=cX.minY,cM=cX.maxX,T=cX.maxY;do{if(cP.all==0&&cN.all==0){cU=true;cV=true}else{if((cP.all&cN.all)!=0){cV=true}else{if(cP.all!=0){cW=cP}else{cW=cN}if(cW.top){c1=cZ.x+(cY.x-cZ.x)*(cR-cZ.y)/(cY.y-cZ.y);c0=cR}else{if(cW.bottom){c1=cZ.x+(cY.x-cZ.x)*(T-cZ.y)/(cY.y-cZ.y);c0=T}else{if(cW.right){c0=cZ.y+(cY.y-cZ.y)*(cM-cZ.x)/(cY.x-cZ.x);c1=cM}else{if(cW.left){c0=cZ.y+(cY.y-cZ.y)*(cT-cZ.x)/(cY.x-cZ.x);c1=cT}}}}cS=true;if(cW.all==cP.all){cZ.x=Math.round(c1);cZ.y=Math.round(c0);cP=ba(cZ,cX)}else{cY.x=Math.round(c1);cY.y=Math.round(c0);cN=ba(cY,cX)}}}}while(!cV);if(cU){return{pixel0:new bv(cZ.x,cZ.y),pixel1:new bv(cY.x,cY.y),clip:cS?true:false}}}function ba(cM,cP){var cN={top:0,bottom:0,right:0,left:0,all:0};var T=cM.x,cO=cM.y;if(cO<cP.minY){cN.top=8;cN.all+=cN.top}else{if(cO>cP.maxY){cN.bottom=4;cN.all+=cN.bottom}}if(T>cP.maxX){cN.right=2;cN.all+=cN.right}else{if(T<cP.minX){cN.left=1;cN.all+=cN.left}}return cN}function cf(cT,cU){if(cU==0){return cT}var cS=0;var cQ=0;for(var cO=1,cM=cT.length-1;cO<cM;cO++){var cR=a4(cT[cO],cT[0],cT[cT.length-1]);if(cR>cS){cQ=cO;cS=cR}}var T=[];if(cS>=cU){var cW=cT.slice(0,cQ);var cV=cT.slice(cQ,cT.length);var cP=cf(cW,cU);var cN=cf(cV,cU);for(var cO=0,cM=cP.length;cO<cM;cO++){T.push(cP[cO])}for(var cO=0,cM=cN.length;cO<cM;cO++){T.push(cN[cO])}}else{T.push(cT[0]);T.push(cT[cT.length-1])}return T}function a4(cM,cR,cQ){var cP=cR.lng-cQ.lng;var cO=cR.lat-cQ.lat;if(cP==0){return Math.abs(cM.lng-cR.lng)}if(cO==0){return Math.abs(cM.lat-cR.lat)}var cN=cO/cP;var T=cR.lat-cN*cR.lng;return Math.abs(cN*cM.lng-cM.lat+T)/Math.sqrt(cN*cN+1)}a9.extend(f.prototype,{initialize:function(T){cG.prototype.initialize.call(this,T);this.setFillColor("");this.setStrokeColor(this._config.strokeColor);this.setStrokeWeight(this._config.strokeWeight);this.setStrokeStyle(this._config.strokeStyle);this.setStrokeOpacity(this._config.strokeOpacity);return this.domElement},_getDisplayPixels:function(cX){var c2=this.map,cO=[];if(cX.length==0||!this.domElement||!this.isVisible()){return[cO]}if(!(aB()&&cX.length>5000)&&!this._config.enableEditing){var cP=this.getParseCacheIndex(c2.getZoom());if(this._parseCache[cP]){cX=this._parseCache[cP]}else{var T=cf(cX,this.getParseTolerance(c2.getZoom()));cX=this._parseCache[cP]=T}}cO.push(c2.pointToOverlayPixel(cX[0]));for(var cZ=1,cW=1,cV=cX.length;cZ<cV;cZ++){var cN=c2.pointToOverlayPixel(cX[cZ]);if(!cN.equals(cO[cW-1])){cO.push(cN);cW++}}var c1=[],cT=c2.offsetX,cS=c2.offsetY,cR=c2.config.drawMargin,cQ={minX:-cT-cR,minY:-cS-cR,maxX:-cT+cR+c2.width,maxY:-cS+cR+c2.height};for(var cZ=0,cV=cO.length-1;cZ<cV;cZ++){var c0=cO[cZ],cY=cO[cZ+1];var cM=bs(c0,cY,cQ);if(cM){c1.push(cM)}}var cU=[[]];for(var cZ=0,cV=c1.length;cZ<cV;cZ++){if(c1[cZ].clip){cU[cU.length-1].push(c1[cZ].pixel0);cU[cU.length-1].push(c1[cZ].pixel1);if(c1[cZ+1]&&c1[cZ+1].clip){cU.push([])}}else{cU[cU.length-1].push(c1[cZ].pixel0);if(cZ==c1.length-1){cU[cU.length-1].push(c1[cZ].pixel1)}}}return cU},_onMarkerDragging:function(cT){this._editstate=true;var cM=cT.currentTarget;var cV=cT.point;var cU=cM.index;var T=this.vertexPoints;var cW;var cR=null,cN=null;if(cU==0){var cS=T[cU+2].p;cW=[cV,cS];cR=new ce((cS.lng+cV.lng)/2,(cS.lat+cV.lat)/2);if(this.vertexMarkers[cU+1]){this.vertexMarkers[cU+1].hide()}}else{if(cU==T.length-1){var cQ=T[cU-2].p;cW=[cQ,cV];cR=new ce((cQ.lng+cV.lng)/2,(cQ.lat+cV.lat)/2);if(this.vertexMarkers[cU-1]){this.vertexMarkers[cU-1].hide()}}else{var cQ=T[cU-1].p;var cS=T[cU+1].p;cW=[cQ,cV,cS];if(!cM.t){cQ=T[cU-2].p;cS=T[cU+2].p;cW=[cQ,cV,cS];cR=new ce((cQ.lng+cV.lng)/2,(cQ.lat+cV.lat)/2);cN=new ce((cS.lng+cV.lng)/2,(cS.lat+cV.lat)/2);if(this.vertexMarkers[cU-1]){this.vertexMarkers[cU-1].hide()}if(this.vertexMarkers[cU+1]){this.vertexMarkers[cU+1].hide()}}}}if(!this._temp.dashedLine){var cP=new f(cW,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(cP);cP.hide();this._temp.dashedLine=cP}else{this._temp.dashedLine.setPath(cW);this._temp.dashedLine.show()}var cO=new M(cd.imgPath+"nodeT.gif",new aI(11,11),{offset:new aI(5,5)});if(!this._temp.preTNode&&cR){this._temp.preTNode=new ae(cR,{icon:cO});this.map.addOverlay(this._temp.preTNode)}else{if(cR){this._temp.preTNode.setPosition(cR)}}if(!this._temp.nexTNode&&cN){this._temp.nexTNode=new ae(cN,{icon:cO});this.map.addOverlay(this._temp.nexTNode)}else{if(cN){this._temp.nexTNode.setPosition(cN)}}}});a9.extend(co.prototype,{initialize:function(T){cG.prototype.initialize.call(this,T);this.setStrokeColor(this._config.strokeColor);this.setStrokeWeight(this._config.strokeWeight);this.setStrokeStyle(this._config.strokeStyle);this.setFillColor(this._config.fillColor);this.setStrokeOpacity(this._config.strokeOpacity);this.setFillOpacity(this._config.fillOpacity);return this.domElement},setPositionAt:function(cM,T){if(!this._userPoints[cM]){return}this._parseCache.length=0;this._userPoints[cM]=new ce(T.lng,T.lat);this.points[cM]=new ce(T.lng,T.lat);if(cM==0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new ce(T.lng,T.lat)}this._calcBounds();this.draw();this.dispatchEvent(new bh("onlineupdate"))},_onMarkerDragging:function(cU){this._editstate=true;var cN=cU.currentTarget;var cW=cU.point;var cV=cN.index;var T=this.vertexPoints;var cY;var cR=T[1].p;var cX=T[T.length-1].p;var cS=null,cM=null;if(cV==0){var cT=T[cV+1].p;cY=[cX,cW,cT];if(!cN.t){cS=new ce((cX.lng+cW.lng)/2,(cX.lat+cW.lat)/2);cM=new ce((cT.lng+cW.lng)/2,(cT.lat+cW.lat)/2)}}else{if(cV==T.length-1){var cQ=T[cV-1].p;cY=[cQ,cW,cR];if(!cN.t){cS=new ce((cQ.lng+cW.lng)/2,(cQ.lat+cW.lat)/2);cM=new ce((cR.lng+cW.lng)/2,(cR.lat+cW.lat)/2)}}else{var cQ=T[cV-1].p;var cT=T[cV+1].p;cY=[cQ,cW,cT];if(!cN.t){cQ=T[cV-2].p;cT=T[cV+2].p;cY=[cQ,cW,cT];cS=new ce((cQ.lng+cW.lng)/2,(cQ.lat+cW.lat)/2);cM=new ce((cT.lng+cW.lng)/2,(cT.lat+cW.lat)/2);if(this.vertexMarkers[cV-1]){this.vertexMarkers[cV-1].hide()}if(this.vertexMarkers[cV+1]){this.vertexMarkers[cV+1].hide()}}}}if(!this._temp.dashedLine){var cP=new f(cY,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(cP);this._temp.dashedLine=cP}else{this._temp.dashedLine.setPath(cY)}var cO=new M(cd.imgPath+"nodeT.gif",new aI(11,11),{offset:new aI(5,5)});if(!this._temp.preTNode&&cS){this._temp.preTNode=new ae(cS,{icon:cO});this.map.addOverlay(this._temp.preTNode)}else{if(cS){this._temp.preTNode.setPosition(cS)}}if(!this._temp.nexTNode&&cM){this._temp.nexTNode=new ae(cM,{icon:cO});this.map.addOverlay(this._temp.nexTNode)}else{if(cM){this._temp.nexTNode.setPosition(cM)}}}});a9.extend(a.prototype,{initialize:function(T){co.prototype.initialize.call(this,T);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return this.domElement},setCenter:function(T,cM){if(!T){return}this._parseCache.length=0;if(!cM){this.vertexPoints=null}this.point=T;this.points=this._getPerimeterPoints(T,this.radius);this._calcBounds();this.draw();this.dispatchEvent(new bh("onlineupdate"))},setRadius:function(T,cM){if(isNaN(T)){return}this._parseCache.length=0;if(!cM){this.vertexPoints=null}this.radius=Math.abs(T);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();this.draw();this.dispatchEvent(new bh("onlineupdate"))},getParseTolerance:function(T){if(this._config.getParseTolerance){return this._config.getParseTolerance(T)}return a.parseTolerance[this.getParseCacheIndex(T)]},_onMarkerDragging:function(cQ){var cO,cS,cT,T=this.map;this._editstate=true;var cN=cQ.currentTarget;var cR=cN.index;var cM=this.vertexPoints;var cP=cM[0].p;var cU=cM[cM.length-1].p;if(cR==0){cS=cN.getPosition();cT=cU}else{cS=cP;cT=cN.getPosition()}cO=bb.getDistanceByLL(cS,cT);this.setRadius(cO,true);this.setCenter(cS,true)},_onMarkerDragend:function(cN){this._editstate=false;var cM=cN.currentTarget;var T=cM.index;this.vertexPoints[0]={p:this.point,t:0};if(T==1){this.vertexPoints[1]={p:cM.point,t:0}}this.clearVertexs();this.addVertexs()},getVertexPoints:function(){if(!this.vertexPoints){var T=[];T.push({p:this.point,t:0});T.push({p:this.points[Math.floor(this.points.length*3/4)],t:0});this.vertexPoints=T}return this.vertexPoints}});function aP(T){this._map=T;this._canvasAttrName={strokeweight:"lineWidth",strokecolor:"strokeStyle",fillcolor:"fillStyle",strokeopacity:"globalAlpha",fillopacity:"globalAlpha"};this._type="canvas"}aP.prototype=new aJ();var b9=aP.prototype;b9.addLine=function(){var cM=ab("canvas");this._map.getPanes().mapPane.appendChild(cM);cM.style.position="absolute";var T=cM.getContext("2d");T.lineCap="round";T.lineJoin="round";T.save();return cM};b9.setPath=function(cN,cM){if(!cN){return}var T=cN.getContext("2d");this._setCanvasPosition(cN);this._clearCanvas(T);var cP=parseInt(cN.style.top),cO=parseInt(cN.style.left);T.beginPath();a9.array.each(cM,function(cS){if(cS.length==0){return}T.moveTo(cS[0].x-cO,cS[0].y-cP);for(var cR=1,cQ=cS.length;cR<cQ;cR++){T.lineTo(cS[cR].x-cO,cS[cR].y-cP)}});this._drawCanvas(cN)};b9.setAttribute=function(cO,cM,cP){if(!cO){return}var T=cO.getContext("2d");var cN=this._getAttributeName(cM);try{T[cN]=cP}catch(cQ){}cO.setAttribute("_"+cM,cP||"");T.save();this._clearCanvas(T);this._drawCanvas(cO)};b9._getAttributeName=function(T){return this._canvasAttrName[T]||T};b9._setCanvasPosition=function(cP){var cM=this._map,cU=cM.config.drawMargin,cN=cM.width+2*cU,cR=cM.height+2*cU,cO=-cM.offsetX-cU,cQ=-cM.offsetY-cU,cT=cP.getContext("2d"),cS={strokeStyle:cT.strokeStyle,fillStyle:cT.fillStyle,globalAlpha:cT.globalAlpha,lineWidth:cT.lineWidth,lineCap:"round",lineJoin:"round"};cP.setAttribute("width",cN);cP.setAttribute("height",cR);for(var T in cS){cT[T]=cS[T]}cT.save();var cV=cP.style;cV.top=cQ+"px";cV.left=cO+"px"};b9._clearCanvas=function(T){T.clearRect(0,0,9999,9999)};b9._drawCanvas=function(cM){var T=cM.getContext("2d");T.globalAlpha=cM.getAttribute("_fillopacity");if(T.globalAlpha!=0&&cM.getAttribute("_fillcolor")){T.fill()}T.globalAlpha=cM.getAttribute("_strokeopacity");if(T.globalAlpha!=0&&cM.getAttribute("_strokecolor")){T.stroke()}};function aJ(){}DrawerPrototype=aJ.prototype;DrawerPrototype.setPalette=function(){};DrawerPrototype.addLine=function(){throw"addLine\u63a5\u53e3\u6ca1\u6709\u5b9e\u73b0"};DrawerPrototype.setAttribute=function(){throw"setAttribute\u63a5\u53e3\u6ca1\u6709\u5b9e\u73b0"};DrawerPrototype.setPath=function(){throw"setPath\u63a5\u53e3\u6ca1\u6709\u5b9e\u73b0"};DrawerPrototype.getType=function(){return this._type};var cs={getDrawer:function(T){if(!cs["_"+T.guid]){cs["_"+T.guid]={}}switch(T.config.drawer){case BMAP_SVG_DRAWER:return cs.getSvgDrawer(T);case BMAP_VML_DRAWER:return cs.getVmlDrawer(T);case BMAP_CANVAS_DRAWER:return cs.getCanvasDrawer(T);default:break}if(cs.isSupportSvg()){return cs.getSvgDrawer(T)}if(cs.isSupportVml()){return cs.getVmlDrawer(T)}if(cs.isSupportCanvas()){return cs.getCanvasDrawer(T)}},getSvgDrawer:function(T){if(!cs["_"+T.guid]._svgDrawer){cs["_"+T.guid]._svgDrawer=new bd(T)}return cs["_"+T.guid]._svgDrawer},getVmlDrawer:function(T){if(!cs["_"+T.guid]._vmlDrawer){cs["_"+T.guid]._vmlDrawer=new bU(T)}return cs["_"+T.guid]._vmlDrawer},getCanvasDrawer:function(T){if(!cs["_"+T.guid]._canvasDrawer){cs["_"+T.guid]._canvasDrawer=new aP(T)}return cs["_"+T.guid]._canvasDrawer},isSupportVml:function(){if(ci(cs.supportVml)){return cs.supportVml}var cN=document.body.appendChild(ab("div"));cN.innerHTML=\'<v:shape id="vml_tester1" adj="1" />\';var cM=cN.firstChild;if(!cM.style){return false}cM.style.behavior="url(#default#VML)";var T=cM?typeof cM.adj=="object":true;cN.parentNode.removeChild(cN);cs.supportVml=T;return T},isSupportSvg:function(){if(!ci(cs.supportSvg)){cs.supportSvg=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")}return cs.supportSvg},isSupportCanvas:function(){if(!ci(cs.supportCanvas)){cs.supportCanvas=!!ab("canvas").getContext}return cs.supportCanvas}};BMap.DrawerSelector=cs;function bd(T){this._map=T;this.SVG_NS="http://www.w3.org/2000/svg";this._svgAttrName={strokeweight:"stroke-width",strokecolor:"stroke",fillcolor:"fill",strokeopacity:"stroke-opacity",fillopacity:"fill-opacity",strokestyle:"stroke-dasharray"};this._svg=this._createSvg();this._type="svg"}bd.prototype=new aJ();var D=bd.prototype;D._createSvg=function(){var T=this._svg=ab("svg",{},this.SVG_NS);T.setAttribute("version","1.1");T.setAttribute("type","system");var cM=T.style;cM.position="absolute";this.setPalette();this._map.getPanes().mapPane.appendChild(T);a9.on(T,"mousedown",cD);return T};D.setPalette=function(){if(!this._svg){return}var cN=this._svg,cS=this._map,cM=cS.config.drawMargin,cP=cS.width+2*cM,T=cS.height+2*cM,cR=-cS.offsetX-cM,cQ=-cS.offsetY-cM;this.setAttribute(cN,"x",cP+"px");this.setAttribute(cN,"y",T+"px");this.setAttribute(cN,"viewBox",cR+" "+cQ+" "+cP+" "+T);var cO=cN.style;cO.top=cQ+"px";cO.left=cR+"px";cO.width=cP+"px";cO.height=T+"px"};D.getPalette=function(){return this._svg};D.setAttribute=function(cN,T,cO,cM){if(!cN){return}if(T=="strokestyle"){cO=cO=="solid"?0:cM*2}var cP=cO||"none";cN.setAttributeNS(null,this._getAttributeName(T),cP);return cN};D._getAttributeName=function(T){return this._svgAttrName[T]||T};D.addLine=function(){var T=ab("path",{},this.SVG_NS);this.setAttribute(T,"stroke-linejoin","round");this.setAttribute(T,"stroke-linecap","round");this.setAttribute(T,"fill-rule","evenodd");this._svg.appendChild(T);return T};D.setPath=function(cN,T){var cM=this._getPathString(T)||"M -9999,-9999";this.setAttribute(cN,"d",cM)};D._getPathString=function(T){if(T.length==0){return""}var cM=[];a9.array.each(T,function(cP){if(cP.length<2){return}cM.push("M "+cP[0].x+" "+cP[0].y+" L");for(var cO=1,cN=cP.length;cO<cN;cO++){cM.push(cP[cO].x);cM.push(cP[cO].y)}});return cM.join(" ")};function bU(T){this._map=T;this._vmlAttrName={strokeweight:"weight",strokecolor:"color",fillcolor:"color",strokeopacity:"opacity",fillopacity:"opacity",strokestyle:"dashstyle"};this._type="vml"}bU.colorMapping={orange:"#ffa500"};bU.prototype=new aJ();var bC=bU.prototype;bC.setAttribute=function(cN,T,cO){if(cN){if(T.indexOf("stroke")==0){cN=cN.getElementsByTagName("stroke")[0]}else{if(T.indexOf("fill")==0){cN=cN.getElementsByTagName("fill")[0]}}if(T.indexOf("color")>0){if(!cO){cN.on=false}else{cN.on=true;if(bU.colorMapping[cO]){cO=bU.colorMapping[cO]}}}if(T=="strokestyle"){cO=cO=="solid"?"solid":"4 2 1 2"}if(T=="strokeweight"){cO=cO+"px"}var cM=this._getAttributeName(T);cN[cM]=cO||""}};bC._getAttributeName=function(T){return this._vmlAttrName[T]||T};bC.addLine=function(){var T=[\'<v:shape style="behavior:url(#default#VML);z-index:1;width:1px;height:1px;position:absolute;left:0;top:0;"\',\'coordsize="1,1" coordorigin="0,0" filled="t" fillcolor="white">\',\'<v:stroke style="behavior:url(#default#VML);" endcap="round" oned="true" />\',\'<v:fill style="behavior:url(#default#VML)" />\',"</v:shape>"].join("");return au(this._map.getPanes().mapPane,T)};bC.setPath=function(cM,T){this.setAttribute(cM,"path",this._getPathString(T));if(a9.browser.ie==6){cM.style.display="none";cM.style.display=""}};bC._getPathString=function(T){if(T.length==0){return""}var cM=[];a9.array.each(T,function(cP){if(cP.length<2){return}cM.push("m "+cP[0].x+" "+cP[0].y+" l");for(var cO=1,cN=cP.length;cO<cN;cO++){cM.push(cP[cO].x);cM.push(cP[cO].y)}cM.push("e")});return cM.join(" ")||" "};');
﻿_jsload&&_jsload('infowindow', 'a9.extend(bQ.prototype,{initialize:function(cM){var cN=this.map=cM.map;this.overlay=cM;this.render();this._bind();if(this._config.enableMaximize){this.enableMaximize()}else{this.disableMaximize()}this.setTitle(this._config.title);this.setContent(this.content,true);if(this._config.ifMaxScene){this.setMaxScene(true)}this.redraw(null,true);var T=cN.infoWindowDoms;if(T){if(cM instanceof ae){T.marker=cM}else{T.marker=null}}},render:function(){var cR=this.map,cO=this,cM=cR.infoWindowDoms,cS=cO.IMG_PATH;if(!cM){cM=cR.infoWindowDoms={};cR.infoWindow=cR.infoWindowDoms;var cN=[\'<div class="BMap_shadow" style="position: absolute;display:none" type="infowindow_shadow">\'];cN.push(\'<div><img onmousedown="return false" style="left: -323px; top: 0px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="left: -393px; top: 0px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="left: -1033px; top: 0px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="top: -30px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="left: -360px; top: -30px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="top: -30px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="left: -14px; top: -310px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="left: -255px; top: -310px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="left: -440px; top: -310px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="left: -255px; top: -310px;" src="\'+cS+\'iws3.png"/></div>\');cN.push(\'<div><img onmousedown="return false" style="left: -754px; top: -310px;" src="\'+cS+\'iws3.png"/></div>\');cN.push("</div>");cN.push(\'<div class="BMap_pop" style="position:absolute;display:none;cursor:default">\');cN.push(\'<div><div style="background:#fff;border-top:1px solid #ababab;border-left:1px solid #ababab;width:30px;height:30px;"></div></div>\');cN.push(\'<div class="BMap_top"></div>\');cN.push(\'<div><div style="position:absolute;top:0;left:-6px;background:#fff;border-top:1px solid #ababab;border-right:1px solid #ababab;width:30px;height:30px;"></div></div>\');cN.push(\'<div class="BMap_center"></div>\');cN.push(\'<div><div style="position:absolute;top:-6px;left:0;background:#fff;border-bottom:1px solid #ababab;border-left:1px solid #ababab;width:30px;height:30px;"></div></div>\');cN.push(\'<div class="BMap_bottom"></div>\');cN.push(\'<div><div style="position:absolute;top:-6px;left:-6px;background:#fff;border-right:1px solid #ababab;border-bottom:1px solid #ababab;width:30px;height:30px;"></div></div>\');cN.push(\'<div><img style="border:none;margin:0px;padding:0px;position:absolute;left:-186px;top:-691px;width:690px;height:786px;" src="\'+cS+\'iw3.png"/></div>\');cN.push(\'<div style="overflow-y:hidde;overflow-x:hidde;width:auto;height:auto;position:absolute;left:16px; top:16px;z-index:10;"></div>\');cN.push("</div>");cM.popDom=au(cR.platform,cN.join(""));cM.shadowDom=cM.popDom.previousSibling;cM.popDivs=cM.popDom.children;cM.shadowDivs=cM.shadowDom.getElementsByTagName("div");cM.contentMain=cM.popDivs[8];cM.titleDiv=au(cM.popDivs[8],\'<div class="BMap_bubble_title" style="display:block;overflow:hidden;height:24px;line-height:24px;white-space:nowrap"></div>\');cM.contentDiv=au(cM.popDivs[8],\'<div class="BMap_bubble_content" style="display:block"></div>\');cM.maxContentDiv=au(cM.popDivs[8],\'<div class="BMap_bubble_max_content" style="display:none;position:relative"></div>\');var T=10;if(a9.platform.isIphone||a9.platform.isAndroid){T=20}var cP=\'<img style="position:absolute;top:12px;width:\'+T+"px;height:"+T+\'px;-moz-user-select:none;cursor:pointer;z-index:10000;" src="\'+cS+\'iw_close1d3.gif"/>\';cM.closeButton=au(cM.popDom,cP);var cQ=\'<img style="position:absolute;top:12px;width:\'+T+"px;height:"+T+\'px;-moz-user-select:none;cursor:pointer;z-index:10000;display:none" src="\'+cS+\'iw_plus1d3.gif"/>\';cM.maxButton=au(cM.popDom,cQ);this._mendIE6(cM)}cM.guid=cM.popDom.guid=this.guid},_mendIE6:function(cO){if(!a9.browser.ie||a9.browser.ie>6){return}var cN=cO.popDom.getElementsByTagName("IMG");for(var cM=0;cM<cN.length;cM++){if(cN[cM].src.indexOf(".png")<0){continue}cN[cM].style.cssText+=";FILTER: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+cN[cM].src+",sizingMethod=crop)";cN[cM].src=this.IMG_PATH+"blank.gif"}var T=cO.shadowDom.getElementsByTagName("IMG");for(var cM=0;cM<T.length;cM++){T[cM].style.cssText+=";FILTER: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+T[cM].src+",sizingMethod=crop)";T[cM].src=this.IMG_PATH+"blank.gif"}},_bind:function(){var cR=this,cS=cR.map,cO=cS.infoWindowDoms,cN=cO.closeButton,cP=cO.popDom;var cM=function(cT){cR.dispatchEvent(new bh("onclickclose"));cR.overlay&&cR.overlay.closeInfoWindow();cp(cT)};cN.onclick=cM;var cQ=["touchstart","touchmove","gesturestart","gesturechange","mousedown","mouseout","mouseover","click","mousewheel","keydown","selectstart"];a9.array.each(cQ,function(cT){a9.on(cP,cT,aQ)});a9.on(cP,"dblclick",cp);a9.on(cP,"contextmenu",cp);if(a9.browser.firefox>=4){a9.on(cP,"mouseup",function(cT){if(cT.button==2){cp(cT)}})}if(window.addEventListener){cP.addEventListener("DOMMouseScroll",aQ,false)}var T=function(cU){var cT=cR.map.infoWindowDoms.maxButton;if(!cR.isWinMax){cR.maximize()}else{cR.restore()}cp(cU)};cO.maxButton.onclick=T;if(aB()){a9.on(cN,"touchend",cM);a9.on(cO.maxButton,"touchend",T)}cP=cN=cO=null},_setWinSize:function(cU,cT){var c4=this._config;cU=cU||c4.width;cT=cT||c4.height;if(cT<0){cT=0}var cO=c4.offset.width;var cS=c4.offset.height;var c3=[25,-1,25,-1,25,-1,25,34];var cN=[25,-1,25,-1,25,-1,25,50];c3[1]=cU-c3[0]-c3[2];if(a9.browser.ie&&document.compatMode!="CSS1Compat"){c3[3]=cU}else{c3[3]=cU-2}c3[5]=cU-c3[4]-c3[6];cN[1]=cN[0];cN[3]=cT-cN[0]-cN[4];if(a9.browser.ie&&document.compatMode!="CSS1Compat"){cN[5]=cN[4]}else{cN[5]=cN[4]-1}var c5=[0,c3[0],cU-c3[2],0,0,c3[4],cU-c3[6],Math.ceil((cU-c3[7])/2)];var cZ=[0,0,0,cN[0],cT-c3[4],cT-c3[4],cT-c3[4],cT-c3[4]];var cM=this._allPopLeft=cO-Math.round((cU-c3[7])/2);var c0=this._allPopTop=cS-cT-24;var c6=Math.floor((cT+cN[7])/2.03)+30;var cQ=[70,-1,70,-1,-1,-1,50,-1,140,-1,70];var cY=[30,30,30,25,25,25,60,60,60,60,60];cQ[7]=Math.round((cU+80-(cQ[6]+cQ[8]+cQ[10])-50)/2);cQ[9]=cQ[7]+50;var c2=cQ[6]+cQ[7]+cQ[8]+cQ[9]+cQ[10];cQ[1]=c2-cQ[0]-cQ[2]-29;cQ[5]=cQ[3]=c6-cY[0]-cY[6]+70;cY[3]=cY[4]=cY[5]=c6-cY[0]-cY[6];cQ[4]=(cQ[0]+cQ[1]+cQ[2]+cY[3]+29)-cQ[5]-cQ[3];var T=[c6-60-1,c6-60-1+cQ[0],c6-60-1+cQ[0]+cQ[1],29,29+cQ[3],29+cQ[3]+cQ[4],0,cQ[6],cQ[6]+cQ[7],cQ[6]+cQ[7]+cQ[8],cQ[6]+cQ[7]+cQ[8]+cQ[9]];var cX=[0,0,0,cY[0],cY[0],cY[0],cY[0]+cY[3],cY[0]+cY[3],cY[0]+cY[3],cY[0]+cY[3],cY[0]+cY[3]];this._allShadowLeft=cO-cQ[6]-cQ[7]-70;this._allShadowTop=cS-c6+30;var cP=323-c6+90;shadowRightImageLeft=740+cP;var c1=function(c7){return"overflow: hidden; z-index: 1; position: absolute;              left:"+c5[c7]+"px;              top:"+cZ[c7]+"px;              width:"+c3[c7]+"px;              height:"+cN[c7]+"px"};var cV=function(c7){return"overflow: hidden; z-index: 1; position: absolute;              left:"+T[c7]+"px;              top:"+cX[c7]+"px;              width:"+cQ[c7]+"px;              height:"+cY[c7]+"px;"};var cR=this.map.infoWindowDoms;if(cR&&cR.popDivs){for(var cW=0;cW<8;cW++){cR.popDivs[cW].style.cssText=c1(cW)}}if(cR&&cR.shadowDivs){for(var cW=0;cW<cR.shadowDivs.length;cW++){cR.shadowDivs[cW].style.cssText=cV(cW)}cR.shadowDivs[3].firstChild.style.left="-"+cP+"px";cR.shadowDivs[5].firstChild.style.left="-"+shadowRightImageLeft+"px"}this.setPosition()},setWidth:function(T){T=T*1;if(!T&&T!=0||isNaN(T)||T<0){return}if(T!=0){if(T<220){T=220}if(T>730){T=730}}this._config.width=T;if(this._isMyDom()&&this.isOpen()){var cM=this;this.redraw(function(){cM.setPanToWithDelay()})}},setHeight:function(T){T=T*1;if(!T&&T!=0||isNaN(T)||T<0){return}if(T!=0){if(T<60){T=60}if(T>650){T=650}}this._config.height=T;var cN=this.map;if(this._isMyDom()&&this.isOpen()){if(this._config.width!=0){cN.infoWindowDoms.contentDiv.style.width=this._config.width+"px"}var cM=this;this.redraw(function(){cM.setPanToWithDelay()})}},setMaxWidth:function(T){T=T*1;if(!T&&T!=0||isNaN(T)||T<0){return}if(T!=0){if(T<220){T=220}if(T>730){T=730}}this._config.maxWidth=T;if(this.isWinMax){this.redraw()}},setTitle:function(cO){this._config.title=cO;if(!this._isMyDom()){return}var cN=this.map;var cM=cN.infoWindowDoms.titleDiv;if(!cO){a9.dom.hide(cM)}else{if(b4(cO)){cM.innerHTML=cO}else{cM.innerHTML="";cM.appendChild(cO)}a9.dom.show(cM)}var T=this;this.redraw(function(){T.setPanToWithDelay()})},setContent:function(cO,cQ){this.content=cO;if(!this._isMyDom()){return}if(this.isWinMax){return}var cP=this.map;var cM=cP.infoWindowDoms.contentDiv;var T=cP.infoWindowDoms.maxContentDiv;if(b4(cO)){cM.innerHTML=cO}else{cM.innerHTML="";cM.appendChild(cO)}if(this._config.width!=0){cM.style.width=this._config.width+"px"}T.style.display="none";cM.style.display="";if(!cQ){var cN=this;this.redraw(function(){cN.setPanToWithDelay()})}},setMaxContent:function(cM){if(!cM){cM=this._config.maxContent}else{this._config.maxContent=cM}var cN=this.map;if(!this._isMyDom()){return}var T=cN.infoWindowDoms;T.maxContentDiv.innerHTML=cM;if(!this.isWinMax){return}T.contentDiv.style.display="none";T.maxContentDiv.style.display=""},redraw:function(cV,cR){if(!this._isMyDom()){return}if(!cR&&!this.isOpen()){return}var cN=this,cQ=1,cO=cN.map.infoWindowDoms,cM=0;cV=cV||function(){};if(cO.titleDiv.style.display!="none"){cM=24}var cP=7,cU=20;if(a9.platform.isIphone||a9.platform.isAndroid){cP=-1;cU=25}if(this.isWinMax){cT=cN._config.maxWidth;setTimeout(function(){var cX=cM+cO.maxContentDiv.scrollHeight;cX=cX>cN.map.height?cN.map.height-60:cX;cT=cT<220?220:cT;cT=cT>600?600:cT;cX=cX<55?55:cX;cX=cX>440?440:cX;cN._setWinSize(cT+32,cX+32);cO.contentMain.style.width=cT+"px";cO.contentMain.style.height=cX+"px";cO.closeButton.style.left=cT+cP+"px";cO.maxButton.style.left=cT-cU+cP+"px";cO.contentMain.style.overflow="hidden";cN.dispatchEvent(new bh("onresize"));cV()},cQ)}else{var cW=cO.contentDiv.style,cS=cO.titleDiv.style,T=cO.contentMain.style;cW.width=T.width=cS.width="auto";cW.height=T.height=cS.height="auto";cW.whiteSpace="nowrap";if(cO.popDom.style.display=="none"){this.show()}cO.popDom.style.visibility="hidden";cO.shadowDom.style.visibility="hidden";var cT=cO.contentMain.clientWidth||0;cT=cN._config.width==0?cT:cN._config.width;cT=cT<220?220:cT;cT=cT>600?600:cT;T.width=cT+"px";h=cO.contentMain.scrollHeight||0;h=cN._config.height==0?h:cN._config.height;cN._setWinSize(cT+32,h+32);setTimeout(function(){cW.whiteSpace="";if(cN._config.width==0){T.overflowX="hidden"}else{T.overflowX="auto"}if(cN._config.height==0){T.overflowY="hidden"}else{T.overflowY="auto"}h=cO.contentMain.scrollHeight||0;h=cN._config.height==0?h:cN._config.height;h=h<55?55:h;h=h>440?440:h;cN._setWinSize(cT+32,h+32);cO.popDom.style.visibility="";cO.shadowDom.style.visibility="";T.height=h+"px";cO.closeButton.style.left=cT+cP+"px";cO.maxButton.style.left=cT-cU+cP+"px";cN.dispatchEvent(new bh("onresize"));cV()},cQ)}},setPosition:function(){if(!this._isMyDom()){return}var T=this.map.infoWindowDoms,cM=this.overlay,cO=this.map.pointToOverlayPixel(cM.getPosition()),cN=cM.getIcon(),cP=new bv(cO.x-cN.anchor.width+cN.infoWindowAnchor.width+cM.getOffset().width,cO.y-cN.anchor.height+cN.infoWindowAnchor.height+cM.getOffset().height);T.popDom.style.left=this._allPopLeft+cP.x+"px";T.popDom.style.top=this._allPopTop+cP.y+"px";T.shadowDom.style.left=this._allShadowLeft+cP.x+"px";T.shadowDom.style.top=this._allShadowTop+cP.y+"px"},setPanToWithDelay:function(T){var cM=this;setTimeout(function(){cM.setPanTo()},T||200)},setPanTo:function(){if(!this.overlay||!this.overlay.getPosition()||!this._config.enableAutoPan||!this._isMyDom()){return}var c1=this.map;var cT=c1.infoWindowDoms;var cN=cT.popDivs;var c2=cT.popDom;if(!cN||!c2){return}var cO=parseInt(cN[3].style.width)+2;var cY=parseInt(cN[1].style.height)+parseInt(cN[3].style.height)+parseInt(cN[7].style.height);var cW=parseInt(c2.style.left)+this.map.offsetX;var cQ=parseInt(c2.style.top)+this.map.offsetY;var cS=new bv(cW,cQ);var cR=new bv(cO+cW,cY+cQ);if(this._config.height!=0&&document.all){if(!c1.temp.infoKey){c1.temp.infoKey=-1}var cZ=-c1.temp.infoKey;c1.temp.infoKey=-c1.temp.infoKey}var cZ=0;var cX=0;var T=10;var cM=this._config.margin[0];var cP=this._config.margin[1];var c0=this._config.margin[2];var cU=this._config.margin[3];if(cS.x<cU){cZ=-cS.x+cU}if(cS.y<cM){cX=-cS.y+cM}if(cR.x>c1.width-cP){cZ=c1.width-cR.x-cP}if(cR.y>c1.height-c0){cX=c1.height-cR.y-c0}this._loadCollisions();var cV=this._config.collisions;if(cS.x<cV[0][0]&&cS.y<cV[0][1]){if(Math.abs(-cS.x+cV[0][0])<Math.abs(-cS.y+cV[0][1])){cZ=-cS.x+cV[0][0]}else{if(c1.height-cV[0][1]-cV[3][1]<cY){cZ=-cS.x+cV[0][0]}else{cX=-cS.y+cV[0][1]}}if(c1.width-cV[0][0]-cV[1][0]<cO&&cS.y<cV[1][1]){cX=-cS.y+cV[1][1]}}if(cR.x>c1.width-cV[1][0]&&cS.y<cV[1][1]){if(Math.abs(-cR.x+c1.width-cV[1][0])<Math.abs(-cS.y+cV[1][1])&&c1.width-cV[0][0]-cV[1][0]>=cO){cZ=-cR.x+c1.width-cV[1][0]}else{cX=-cS.y+cV[1][1];if(c1.width-cV[0][0]-cV[1][0]<cO&&c1.width-cV[0][0]<cO){cZ=-cS.x+cV[0][0]}}}if(cS.x<cV[3][0]&&cR.y>c1.height-cV[3][1]){if(Math.abs(-cS.x+cV[3][0])<Math.abs(-cR.y+c1.height-cV[3][1])&&(Math.abs(-cS.x+cV[3][0])<Math.abs(cX)&&cX!=0||cX==0)&&c1.width-cV[3][0]>=cO){cZ=-cS.x+cV[3][0]}else{cX=-cR.y+c1.height-cV[3][1]}if(c1.height-cV[0][1]-cV[3][1]<cY&&cS.x<cV[0][0]){cZ=-cS.x+cV[0][0]}}if(cR.x>c1.width-cV[2][0]&&cR.y>c1.height-cV[2][1]){if(Math.abs(-cR.x+c1.width-cV[2][0])<Math.abs(-cR.y+c1.height-cV[2][1])&&(Math.abs(-cR.x+c1.width-cV[2][0])<Math.abs(cX)&&cX!=0||cX==0)&&c1.width-cV[0][0]-cV[1][0]>=cO){cZ=-cR.x+c1.width-cV[2][0]}else{if(c1.height-cV[1][1]-cV[2][1]>=cY){cX=-cR.y+c1.height-cV[2][1]}else{cX=-cS.y+cV[1][1]}if(c1.width-cV[0][0]-cV[2][0]<cO){cZ=-cS.x+cV[0][0]}}}if(cZ!=0||cX!=0){c1.panBy(cZ,cX)}},_loadCollisions:function(){if(!this.map){return}var cM=this.map;this._config.collisions=[[10,10],[10,10],[10,10],[10,10]];var cV=this.map.container;for(var cT=0,cN=cV.children.length;cT<cN;cT++){var cQ,cW,cZ=!!(ci(cV.children[cT]._anchor)&&cV.children[cT]._offset);if(cV.children[cT]._jsobj&&cV.children[cT]._jsobj instanceof cq&&cV.children[cT]._jsobj.blockInfoWindow==true){cQ=cV.children[cT]}else{if(cZ){cQ=cV.children[cT]}else{continue}}var cX=cQ.offsetWidth,cU=cQ.offsetHeight,T=cQ._jsobj,cP,cS;if(!T||cZ){if(ci(cQ._anchor)&&cQ._offset&&aK(cQ).display!="none"&&aK(cQ).visibility!="hidden"){cP=cQ._offset;cS=cQ._anchor}else{continue}}else{if(T.isVisible()==false){continue}cP=T.getOffset();cS=T.getAnchor()}switch(cS){case BMAP_ANCHOR_TOP_LEFT:cW=0;break;case BMAP_ANCHOR_TOP_RIGHT:cW=1;break;case BMAP_ANCHOR_BOTTOM_LEFT:cW=3;break;case BMAP_ANCHOR_BOTTOM_RIGHT:cW=2;break;default:break}var cR=cX+cP.width+10,cO=cU+cP.height+10,cY=this._config.collisions[cW];this._config.collisions[cW]=[cR>cY[0]?cR:cY[0],cO>cY[1]?cO:cY[1]]}},enableMaximize:function(){this._config.enableMaximize=true;if(this._isMyDom()){this.map.infoWindowDoms.maxButton.style.display="block"}},disableMaximize:function(){this._config.enableMaximize=false;if(this._isMyDom()){this.map.infoWindowDoms.maxButton.style.display="none"}},show:function(){if(!this._isMyDom()){return}var cM=this.map.infoWindowDoms;if(cM.popDom.style.display!="none"){return}if(cK(this.content)){cM.contentDiv.appendChild(this.content)}if(cK(this._config.title)){cM.titleDiv.appendChild(this._config.title)}a9.dom.show(cM.popDom);a9.dom.show(cM.shadowDom);var T=new bh("onopen");T.point=this.getPosition();this.dispatchEvent(T);this.redraw()},hide:function(){if(!this._isMyDom()){return false}var cM=this.map.infoWindowDoms;if(cM.popDom.style.display=="none"){return false}if(this._config.onClosing()==false){return false}if(cK(this.content)){cM.contentDiv.removeChild(this.content)}if(cK(this._config.title)){cM.titleDiv.removeChild(this._config.title)}a9.dom.hide(cM.popDom);a9.dom.hide(cM.shadowDom);if(this.isWinMax){this.isWinMax=false;cM.maxContentDiv.style.display="none";cM.contentDiv.style.display="";cM.maxButton.src=this.IMG_PATH+"iw_plus1d3.gif"}var T=new bh("onclose");T.point=this.getPosition();this.dispatchEvent(T);if(this.map.temp._clickCloseBindTimer){clearTimeout(this.map.temp._clickCloseBindTimer);this.map.temp._clickCloseBindTimer=null}else{this.map.removeEventListener("click",this.map.temp._clickCloseHandler);this.map.temp._clickCloseBinded=false}a9.lang.decontrol(this.guid);return true},maximize:function(){if(!this.map||!this.isOpen()||!this._config.enableMaximize||this.isWinMax){return}if(!this._isMyDom()){return}var cM=this.map.infoWindowDoms.maxButton;var T=this;T.isWinMax=true;cM.src=T.IMG_PATH+"iw_minus1d3.gif";T.setMaxContent();T.map.infoWindowDoms.maxContentDiv.style.display="block";T.redraw();T.dispatchEvent(new bh("onmaximize"));T.setPanToWithDelay()},restore:function(){if(!this.map||!this.isOpen()||!this.isWinMax){return}if(!this._isMyDom()){return}this.isWinMax=false;var T=this;var cM=T.map.infoWindowDoms.maxButton;cM.src=T.IMG_PATH+"iw_plus1d3.gif";T.setContent(this.content,true);T.map.infoWindowDoms.maxContentDiv.style.display="none";T.redraw();T.dispatchEvent(new bh("onrestore"));T.setPanToWithDelay()},_revert:function(){if(!this._isMyDom()){return}this.isWinMax=false;var T=this.map.infoWindowDoms;T.titleDiv.innerHTML="";T.contentDiv.innerHTML="";T.maxContentDiv.innerHTML="";T.maxButton.src=this.IMG_PATH+"iw_plus1d3.gif"},_setOverflow:function(){var cN=this.map;if(!this._isMyDom()){return}var cM=cN.infoWindowDoms,T=cM.contentMain.style;cM._overflowX=T.overflowX;cM._overflowY=T.overflowY;T.overflowX="hidden";T.overflowY="hidden"},_resetOverflow:function(){var cN=this.map;if(!this._isMyDom()||!cN.infoWindowDoms._overflowX||!cN.infoWindowDoms._overflowY){return}var cM=cN.infoWindowDoms,T=cM.contentMain.style;T.overflowX=cM._overflowX;T.overflowY=cM._overflowY;delete cM._overflowX;delete cM._overflowY},isOpen:function(){if(!this.map){return false}var T=this.map.temp.infoWin;if(!T){return false}if(!this._isMyDom()){return false}if(T&&T.overlay===this.overlay&&this.map.infoWindowDoms&&this.map.infoWindowDoms.popDom.style.display=="none"){return false}else{return true}},setMaxScene:function(cM){var cN=this;if(!this._isMyDom()){return}var T=cN.map.infoWindowDoms;T.maxButton.style.display="block";var cO=T.maxButton;if(!!cM==!!this.isWinMax){return}if(cM){cN.isWinMax=true;cO.src=cN.IMG_PATH+"iw_minus1d3.gif";cN.setMaxContent();T.maxContentDiv.style.display="block"}else{cN.isWinMax=false;cO.src=cN.IMG_PATH+"iw_plus1d3.gif";cN.setContent(this.content,true);T.maxContentDiv.style.display="none"}this.redraw()},_draw:function(){if(this._visible==true&&this.overlay){this.overlay.openInfoWindow(this)}},_isMyDom:function(){return(this.map&&this.map.infoWindowDoms&&this.map.infoWindowDoms.guid==this.guid)}});Z.prototype.openInfoWindow=function(cO){var cN=this.map;if(!cN||!this.domElement||this.isVisible()==false||!cO instanceof bQ){return}var cM=cN.temp;if(cM.infoWin&&cM.infoWin.overlay&&cM.infoWin.overlay._fromMap){cN.closeInfoWindow()}if(cM.infoWin===cO&&cM.infoWin.isOpen()&&cM.infoWin.overlay===this){cO.setPanToWithDelay();return}cN.closeInfoWindow();this.infoWindow=cO;if(cM.infoWin==null||cM.infoWin!=cO){if(cN.infoWindowDoms){cN.infoWindowDoms.closeButton.onclick=null;cN.infoWindowDoms.maxButton.onclick=null}cM.infoWin=cO;cO.initialize(this)}else{cO.redraw(null,true)}a9.lang.Class.call(cO,cO.guid);if(!cM._clickCloseHandler){cM._clickCloseHandler=function(cP){if(!cP.overlay){if(cN.temp.infoWin&&cN.temp.infoWin._config.enableCloseOnClick){cN.closeInfoWindow();cN.removeEventListener("click",arguments.callee);cM._clickCloseBinded=false}}}}if(!cM._clickCloseBinded){cM._clickCloseBindTimer=setTimeout(function(){cN.addEventListener("click",cM._clickCloseHandler);cM._clickCloseBinded=true;cM._clickCloseBindTimer=null},200)}if(cM._infoWin){delete cM._infoWin}cO.overlay=this;var T=cN.infoWindowDoms;this.map.getPanes().floatPane.appendChild(T.popDom);this.map.getPanes().floatShadow.appendChild(T.shadowDom);cO.setPanToWithDelay();this.dispatchEvent(new bh("oninfowindowopen"))};Z.prototype.closeInfoWindow=function(){if(!this.map||!this.map.infoWindowDoms){return}var cM=this;if(cM.infoWindow&&cM.infoWindow.guid==cM.map.infoWindowDoms.guid){try{if(cM.infoWindow.hide()==true){cM.dispatchEvent(new bh("oninfowindowclose"));cM.map.temp.infoWin=cM.infoWindow=null}}catch(T){}}};');
﻿_jsload&&_jsload('menu', 'a9.object.extend(cA.prototype,{initialize:function(cP,cM){if(this._container){return false}this._map=cP;this._overlay=cM||null;this._render();var cO=this;var cQ=cP.config.defaultCursor;if(cM&&cM._config.clickable){cQ="pointer"}this._container.style.cursor=cQ;if(this._shadow){this._shadow.style.cursor=cQ}a9.on(document,"mousedown",function(cS){if(!cO._container){return}cO.hide()});a9.on(this._container,"click",function(cS){cO.hide();aQ(cS)});var cR=this._opts.container;if(!cR){cR=cP.container}if(!this._overlay){cP.addEventListener("rightclickex",function(cS){if(!cO._container||cS.overlay||cS.infoWindow){return}cO._showMenu(cS)})}else{this._overlay.addEventListener("rightclick",function(cS){if(!cO._container){return}cO._showMenu(cS)})}for(var cN=0,T=this._items.length;cN<T;cN++){if(this._items[cN]._type=="menuitem"){this._items[cN].initialize(cP,this)}if(this._items[cN]._type=="divider"){this._dividers[this._items[cN]._dIndex].dom=au(this._container,"<div class=\'BMap_cmDivider\'></div>")}}this._updateShadowSize()},_draw:function(){if(this._map){this.initialize(this._map,this._overlay);if(this._isOpen){this._isOpen=false;this.show()}}},remove:function(){if(this._container){this._container.parentNode.removeChild(this._container);this._container=null}if(this._shadow){this._shadow.parentNode.removeChild(this._shadow);this._shadow=null}for(var cM=0,T=this._items.length;cM<T;cM++){if(this._items[cM]._type=="menuitem"){this._items[cM]._container=null}}this._map=this._overlay=null},_render:function(){this._container=au(this._map.container,"<div unselectable=\'on\'></div>");this._container.className="BMap_contextMenu";var T=this._container.style;T.font="12px "+cd.fontFamily;if(a9.browser.ie<9){this._shadow=au(this._map.container,"<div class=\'BMap_cmShadow\'></div>")}else{T.boxShadow=T.MozBoxShadow=T.WebkitBoxShadow="1px 2px 6px #666"}return this._container},addItem:function(cN){if(!cN||cN._type!="menuitem"||cN._text==""||cN._width<=0){return}for(var cM=0,T=this._items.length;cM<T;cM++){if(this._items[cM]===cN){return}}this._items.push(cN);this._rItems.push(cN);if(!this._map){return}cN.initialize(this._map,this);a9.dom.addClass(cN.getDom(),"BMap_cmLstItem");if(this._items.length>1){this._items[this._items.length-2]._type=="menuitem"&&a9.dom.removeClass(this._items[this._items.length-2].getDom(),"BMap_cmLstItem")}else{this._items[0]._type=="menuitem"&&a9.dom.addClass(this._items[0].getDom(),"BMap_cmFstItem")}this._updateShadowSize()},removeItem:function(cN){if(!cN||cN._type!="menuitem"){return}for(var cM=0,T=this._items.length;cM<T;cM++){if(this._items[cM]===cN){this._items[cM].remove();this._items.splice(cM,1);T--}}for(var cM=0,T=this._rItems.length;cM<T;cM++){if(this._rItems[cM]===cN){this._rItems[cM].remove();this._rItems.splice(cM,1);T--}}if(!this._container){return}if(this._items.length>0){this._items[this._items.length-1]._type=="menuitem"&&a9.dom.addClass(this._items[this._items.length-1].getDom(),"BMap_cmLstItem")}this._updateShadowSize()},addSeparator:function(){this._items.push({_type:"divider",_dIndex:this._dividers.length});this._dividers.push({dom:null});if(!this._container){return}var T="<div class=\'BMap_cmDivider\'></div>";this._dividers[this._dividers.length-1].dom=au(this._container,T);this._updateShadowSize()},removeSeparator:function(cM){if(!this._dividers[cM]){return}if(this._dividers[cM].dom&&this._dividers[cM].dom.parentNode){this._dividers[cM].dom.parentNode.removeChild(this._dividers[cM].dom)}for(var cN=0,T=this._items.length;cN<T;cN++){if(this._items[cN]&&this._items[cN]._type=="divider"&&this._items[cN]._dIndex==cM){this._items.splice(cN,1);T--}if(this._items[cN]&&this._items[cN]._type=="divider"&&this._items[cN]._dIndex>cM){this._items[cN]._dIndex--}}this._dividers.splice(cM,1);this._updateShadowSize()},setPosition:function(T,cM){this._left=T;this._top=cM;this._container.style.left=T+"px";this._container.style.top=cM+"px";if(this._shadow){this._shadow.style.left=T+1+"px";this._shadow.style.top=cM+2+"px"}},show:function(){if(this._isOpen==true){return}if(this._rItems.length==0){return}this._isOpen=true;if(this._container){this._container.style.visibility="visible"}if(this._shadow){this._shadow.style.visibility="visible"}var T=new bh("onopen");T.point=this.curPoint;T.pixel=this.curPixel;this.dispatchEvent(T)},hide:function(){if(this._isOpen==false){return}this._isOpen=false;if(this._container){this._container.style.visibility="hidden"}if(this._shadow){this._shadow.style.visibility="hidden"}var T=new bh("onclose");T.point=this.curPoint;T.pixel=this.curPixel;this.dispatchEvent(T)},setCursor:function(T){if(!T){return}this._opts.cursor=T;if(this._container){this._container.style.cursor=this._opts.cursor}if(this._shadow){this._shadow.style.cursor=this._opts.cursor}},_updateShadowSize:function(){if(this._container&&this._shadow){this._shadow.style.width=this._container.offsetWidth+"px";this._shadow.style.height=this._container.offsetHeight+"px"}},_showMenu:function(cQ){if(this._rItems.length==0){return}var cN=this;cN.curPixel=cQ.pixel;cN.curPoint=cN._map.pixelToPoint(cN.curPixel);var cM=cN.getDom().offsetHeight;var T=cN.getDom().offsetWidth;var cP=cQ.pixel.x;var cO=cQ.pixel.y;if(cQ.pixel.x+T>this._map.width){cP=cQ.pixel.x-T}if(cQ.pixel.y+cM>this._map.height){cO=cQ.pixel.y-cM}cN.setPosition(cP,cO);cN.show()}});a9.object.extend(bf.prototype,{initialize:function(T,cM){if(this._container){return false}this._map=T;this._contextmenu=cM;if(cM.getDom()){this._render();this._bind();if(!this._enabled){this._enabled=true;this.disable()}}return true},remove:function(){var T=this;if(this._container){this._container.parentNode.removeChild(this._container);this._container=null}this._contextmenu=null;this._map=null},_draw:function(){if(this._contextmenu&&this._map){this.initialize(this._map,this._contextmenu)}},_render:function(){var T="<div"+(this._opts.id?" id=\'"+this._opts.id+"\'":"")+" unselectable=\'on\'><span>"+this._text+"</span></div>";this._container=au(this._contextmenu.getDom(),T);var cM=this._container.style;cM.padding="2px 6px";cM.margin="0 2px";cM.fontSize="12px";cM.MozUserSelect="none";cM.lineHeight="17px";cM.width=this._opts.width+"px";if(this._enabled){cM.color="#000";cM.cursor="pointer"}else{cM.color="#aaa";cM.cursor=this._map.config.defaultCursor}return this._container},_bind:function(){var T=this;a9.on(this._container,"click",function(cM){if(!T._enabled){aQ(cM);return}if(T._callback&&T._callback.call){T._callback.call(T,T._contextmenu.curPoint,T._contextmenu.curPixel,T._contextmenu._overlay)}});a9.on(this._container,"mousedown",function(cM){aQ(cM)});a9.on(this._container,"mouseover",function(){if(!T._enabled){return}T._container.style.color="#6688cc"});a9.on(this._container,"mouseout",function(){if(!T._enabled){return}T._container.style.color="#000"})},setText:function(T){if(!T){return}this._text=T+"";if(this._container){this._container.innerHTML="<span>"+this._text+"</span>"}},enable:function(){this._enabled=true;if(this._container){this._container.style.color="#000";this._container.style.cursor="pointer"}},disable:function(){this._enabled=false;if(this._container){this._container.style.color="#aaa";this._container.style.cursor=this._map.config.defaultCursor}}});');
﻿_jsload&&_jsload('opmb', 'BMap.register(function(T){T.config.doubleTouchInterval=500;var cT=false,cO,cV=false,cS=false,cM;var cQ=function(c2,c0){var cX=new bh(c2);var cW=c0.target;var cZ=null;var cY=null;while(cW&&cW!=T.container){if(cW.hashCode){var c5=a9.lang.instance(cW.hashCode);if(c5 instanceof Z&&cW.nodeName.toLowerCase()!="canvas"){cZ=c5}if(c5 instanceof bQ){cY=c5}}cW=cW.offsetParent}var c4=c0.changedTouches[0].pageX;var c3=c0.changedTouches[0].pageY;var c1=T.container;while(c1&&c1!=document.body){c4-=c1.offsetLeft;c3-=c1.offsetTop;c1=c1.offsetParent}cX.offsetX=c4;cX.offsetY=c3;cX.pixel=new bv(cX.offsetX,cX.offsetY);cX.point=T.pixelToPoint(cX.pixel);cX.overlay=cZ;cX.infoWindow=cY;return cX};var cU=function(cW){cT=true;cM=new bh("ontouch").inherit(cW);cO=new bv(cW.changedTouches[0].clientX,cW.changedTouches[0].clientY);var cX=cQ("onclickex",cW);setTimeout(function(){cR();T.dispatchEvent(cX)},T.config.doubleTouchInterval);T.dispatchEvent(cQ("onclick",cW))};var cR=function(){if(cT){cT=false;cO=null;if(!cV){T.dispatchEvent(cM)}}};var cP=function(cW){cV=true};var cN=function(){cV=false};a9.on(T.platform,"touchstart",function(cW){cS=false;T.dispatchEvent(cQ("ontouchstart",cW).inherit(cW));cD(cW)});a9.on(T.platform,"touchmove",function(cW){cS=true;T.dispatchEvent(cQ("ontouchmove",cW).inherit(cW));cD(cW)});a9.on(T.platform,"touchend",function(cX){cX.preventDefault();if(!cS){if(cT){cP(cX);T.dispatchEvent(cQ("onclick",cX));var cY=new bv(cX.changedTouches[0].clientX,cX.changedTouches[0].clientY);var cW=cu(cO,cY);if(cW<20){T.dispatchEvent(cQ("ondblclick",cX));T.dispatchEvent(new bh("ondbltouch").inherit(cX))}else{T.dispatchEvent(cQ("ontouchend",cX).inherit(cX))}cR();cN()}else{cU(cX)}}T.dispatchEvent(new bh("ontouchend").inherit(cX))});a9.on(T.platform,"gesturestart",function(cW){cW.preventDefault();T.dispatchEvent(new bh("ongesturestart").inherit(cW))});a9.on(T.platform,"gesturechange",function(cW){cW.preventDefault();T.dispatchEvent(new bh("ongesturechange").inherit(cW))});a9.on(T.platform,"gestureend",function(cW){cW.preventDefault();T.dispatchEvent(new bh("ongestureend").inherit(cW))})});BMap.register(function(T){var cR={x:0,y:0,scale:1};var cX=[{x:0,y:0},{x:0,y:0}];var cU=0,cS=0,cV=false,cM=false,cN=false;var cT=function(c0,cZ){var cY=new bh(c0);cY.offsetX=cZ.changedTouches[0].clientX;cY.offsetY=cZ.changedTouches[0].clientY;cY.pixel=new bv(cY.offsetX,cY.offsetY);cY.point=T.pixelToPoint(cY.pixel);return cY};var cW=T.platform.style;cW.WebkitBackfaceVisibility="hidden";var cO=function(){var cZ=T.container;var cY=0,c0=0;while(cZ!=document.body){cY+=cZ.offsetLeft;c0+=cZ.offsetTop;cZ=cZ.offsetParent}if(bI){cY=0;c0=0}if(T.config.enableDragging){cW.WebkitTransformOrigin=((cX[0].x+cX[1].x)/2-T.offsetX-cY)+"px "+((cX[0].y+cX[1].y)/2-T.offsetY-c0)+"px"}else{cW.WebkitTransformOrigin=Math.round(T.width/2)+"px "+Math.round(T.height/2)+"px"}};var cP=function(){cW.WebkitTransform=(T.config.enableDragging?"translate3d("+cR.x+"px, "+cR.y+"px,0) ":"")+(T.config.enablePinchToZoom?"scale("+cR.scale+") ":"")};var cQ=function(cY){if(cY){cW.WebkitTransform=""}cR.x=0;cR.y=0;cR.scale=1;cR.rotation=0;cX[0].x=cX[0].y=cX[1].x=cX[1].y=0;cN=false};T.addEventListener("touchstart",function(c0){if(c0.overlay instanceof ae){return}var cY=c0.targetTouches.length;cU+=cY;if(cU>2){cU=2}var cZ=T.temp;if(cY==2){cZ._lenIsTwo=true}if(cZ.dragAni){cZ.dragAni.stop()}if(cU==1){this.temp._startX=cR.x;this.temp._startY=cR.y;cX[0].x=c0.targetTouches[0].clientX;cX[0].y=c0.targetTouches[0].clientY}else{if(cU==2){cX[1].x=c0.targetTouches[cY-1].clientX;cX[1].y=c0.targetTouches[cY-1].clientY}}});T.addEventListener("touchmove",function(c1){var c0=c1.targetTouches.length;if(cU==1&&cS!=2){cR.x+=(c1.targetTouches[0].clientX-cX[0].x);cR.y+=(c1.targetTouches[0].clientY-cX[0].y);cX[0].x=c1.targetTouches[0].clientX;cX[0].y=c1.targetTouches[0].clientY;cP();cN=true}if(cU==2){var c6={x:cX[0].x,y:cX[0].y};var c5={x:cX[1].x,y:cX[1].y};if(!cN){var cY=new bv(c1.targetTouches[0].clientX,c1.targetTouches[0].clientY);var c2=new bv(cX[0].x,cX[0].y);if(c0==1){if(cu(c2,cY)<30){cX[0].x=c1.targetTouches[0].clientX;cX[0].y=c1.targetTouches[0].clientY}else{cN=true;cX[1].x=c1.targetTouches[0].clientX;cX[1].y=c1.targetTouches[0].clientY}}if(c0==2){var c4=new bv(c1.targetTouches[1].clientX,c1.targetTouches[1].clientY);if(cu(cY,c4)<30){cX[0].x=c1.targetTouches[1].clientX;cX[0].y=c1.targetTouches[1].clientY}else{if(cu(c2,cY)<cu(c2,c4)){cX[0].x=c1.targetTouches[0].clientX;cX[0].y=c1.targetTouches[0].clientY;cX[1].x=c1.targetTouches[1].clientX;cX[1].y=c1.targetTouches[1].clientY;cN=true}else{cX[1].x=c1.targetTouches[0].clientX;cX[1].y=c1.targetTouches[0].clientY;cX[0].x=c1.targetTouches[1].clientX;cX[0].y=c1.targetTouches[1].clientY;cN=true}}}}else{for(var cZ=0;cZ<c0;cZ++){var c2=new bv(c1.targetTouches[cZ].clientX,c1.targetTouches[cZ].clientY);if(cu(c2,new bv(cX[0].x,cX[0].y))<cu(c2,new bv(cX[1].x,cX[1].y))){cX[0].x=c2.x;cX[0].y=c2.y}else{cX[1].x=c2.x;cX[1].y=c2.y}}cR.x+=(cX[0].x-c6.x+cX[1].x-c5.x)/2;cR.y+=(cX[0].y-c6.y+cX[1].y-c5.y)/2;cP()}}if(cU==1&&cS==2){for(var cZ=0;cZ<c0;cZ++){var c2=new bv(c1.targetTouches[cZ].clientX,c1.targetTouches[cZ].clientY);if(cu(c2,new bv(cX[0].x,cX[0].y))<cu(c2,new bv(cX[1].x,cX[1].y))){cR.x+=(c2.x-cX[0].x);cR.y+=(c2.y-cX[0].y);cX[0].x=c2.x;cX[0].y=c2.y}else{cR.x+=(c2.x-cX[1].x);cR.y+=(c2.y-cX[1].y);cX[1].x=c2.x;cX[1].y=c2.y}}cP()}if(cU==1&&this.config.enableDragging){var c7=this.temp;if(!c7._moved){c7._moved=true;var c3=cT("ondragstart",c1);T.dispatchEvent(c3);T.dispatchEvent(new bh("onmovestart"));c7.dragStartPos=c3.pixel;c7.dragStartTime=aF();cV=true}c7.lastDomMoveTime=aF();T.dispatchEvent(new bh("ondragging"))}});T.addEventListener("touchend",function(c2){cS=cU;if(this.temp._lenIsTwo){cU=c2.targetTouches.length;delete this.temp._lenIsTwo}else{cU--}if(cU==-1){cU=0}if(a9.platform.isAndroid){cU=0}var c4=this;if(cU==0){if(cM){var c1=0,c0=T.getZoom();if(c4.config.enablePinchToZoom){c1=Math.round(Math.log(cR.scale)/Math.log(2)),c0=Math.max(Math.min(T.getZoom()+c1,T.config.maxZoom),T.config.minZoom)}var c3=T.pointToPixel(T.getCenter()),cZ=new bv((c3.x-cR.x/Math.pow(2,c1)),(c3.y-cR.y/Math.pow(2,c1))),c6=T.config.enableDragging?T.pixelToPoint(cZ):T.getCenter();T.centerAndZoom(c6,c0)}var c5=cR.x!=c4.temp._startX||cR.y!=c4.temp._startY;if(c5){if(cV&&!cM){var cY=cT("ondragend",c2);c4.dispatchEvent(cY);T._processInertialDraggingForTouch(cY.pixel,{x:cR.x,y:cR.y});cV=false}if(cM){cQ(true)}else{cQ(false)}}T.temp._moved=false;cM=false;cS=0}});T.addEventListener("gesturechange",function(cY){cR.scale=cY.scale;cM=true;cO()})});bA.prototype._processInertialDraggingForTouch=function(c5,cO){var c7=this,T=c7.platform.style;if(!c7.config.enableInertialDragging){setTimeout(function(){T.WebkitTransform=""},0);setTimeout(function(){c7._setPlatformPosition(c7.offsetX+cO.x,c7.offsetY+cO.y)},0);c7.dispatchEvent(new bh("onmoveend"));return}var cW=c7.temp;var cN=aF();if(cN-cW.lastDomMoveTime>140){setTimeout(function(){T.WebkitTransform=""},0);setTimeout(function(){c7._setPlatformPosition(c7.offsetX+cO.x,c7.offsetY+cO.y)},0);c7.dispatchEvent(new bh("onmoveend"));cW._moved=false;return}else{var c6=cW.dragStartPos,c0=c5,cM=cu(c6,c0),c3=[c0.x-c6.x>0?1:-1,c0.y-c6.y>0?1:-1],cQ=(cN-cW.dragStartTime)/1000,cU=cM/cQ/2,cV=0.5,c4=cU/(2*cV),c2=0.5*c4*cU/1000,cT=Math.abs(c6.x-c0.x),cS=Math.abs(c6.y-c0.y),cZ=0,cX=0;if(cS==0){cZ=cT}else{var cR=Math.abs(c6.x-c0.x)/Math.abs(c6.y-c0.y);cX=Math.round(Math.sqrt(c2*c2/(1+cR*cR)));cZ=Math.round(cR*cX)}if(c3[0]==-1){cZ=-cZ}if(c3[1]==-1){cX=-cX}if(cW.dragAni){cW.dragAni.stop()}var cP=cU/1000,c1=c7.offsetX,cY=c7.offsetY;cW.dragAni=new g({duration:c4,fps:25,transition:function(c8){var c8=c8*cP/(2*cV);return cP*c8-cV*c8*c8},render:function(c8){c8=c8*(4*cV)/(cP*cP);T.WebkitTransform="translate("+(cO.x+Math.round(c8*cZ))+"px ,"+(cO.y+Math.round(c8*cX))+"px)"},finish:function(){cW.dragAni=null;setTimeout(function(){T.WebkitTransform=""},0);setTimeout(function(){c7._setPlatformPosition(c1+cO.x+Math.round(cZ),cY+cO.y+Math.round(cX))},0);c7.dispatchEvent(new bh("onmoveend"))},onStop:function(c8){cW.dragAni=null;c8=c8*(4*cV)/(cP*cP);setTimeout(function(){T.WebkitTransform=""},0);setTimeout(function(){c7._setPlatformPosition(c1+cO.x+Math.round(c8*cZ),cY+cO.y+Math.round(c8*cX))},0);c7.dispatchEvent(new bh("onmoveend"))}})}};var bI=(navigator.userAgent.indexOf("iPhone OS 5_")>-1)?true:false;');
﻿_jsload&&_jsload('scommon', 'var b=1;var aE=2;var bG=3;var cb=new aI(23,25);var b0=new aI(9,25);var t=new aI(9,0);ao.addSearchPoi=function(cQ,T,cM,cR){var cP=aa(T);if(!cP){return}if(cM<0||cM>9){return}var cO=new M(x+"img/markers.png",cb,{anchor:b0,imageOffset:new aI(0,-25*cM),infoWindowAnchor:t});var cN=new ae(cP,{icon:cO});cQ.addOverlay(cN);if(cR){cN.setTitle(cR)}return cN};ao.addCenterPoi=function(cP,T,cQ){var cO=aa(T);if(!cO){return}var cN=new M(x+"img/markers.png",cb,{anchor:b0,imageOffset:new aI(0,-250),infoWindowAnchor:t});var cM=new ae(cO,{icon:cN});cP.addOverlay(cM);if(cQ){cM.setTitle(cQ)}return cM};ao.addSearchInBoundsPoi=function(cP,T,cQ){var cO=aa(T);if(!cO){return}var cN=new M(x+"img/markers.png",cb,{anchor:b0,imageOffset:new aI(0,-300),infoWindowAnchor:t});var cM=new ae(cO,{icon:cN});cP.addOverlay(cM);if(cQ){cM.setTitle(cQ)}return cM};function aa(T){var cN=[];var cM=null;if(T instanceof ce){cM=T}else{if(typeof T=="string"){cN=a9.trim(T).split(",");if(cN.length<2){return}cN[0]=parseFloat(a9.trim(cN[0]));cN[1]=parseFloat(a9.trim(cN[1]))}else{cN=T.slice(0);if(cN.length<2){return}}cM=new ce(cN[0],cN[1])}return cM}ao.createSearchInfoWnd=function(cN,T){var cV=cN.title;var cU=cN.addr;var cQ=cN.tel;var cS=cN.uid||"";var cM=cN.url;var cT=cN.poiType||BMAP_POI_TYPE_NORMAL;T=T||{};if(!cV){return null}var cR=cV;if(cT==BMAP_POI_TYPE_BUSSTOP){cR=cR+"-\u516c\u4ea4\u8f66\u7ad9"}else{if(cT==BMAP_POI_TYPE_SUBSTOP){cR=cR+"-\u5730\u94c1\u7ad9"}}if(cR.replace(/[\u0100-\uffff]/g,"##").length>27){cR=cR.substring(0,13)+"&#8230"}var cP="<p style=\'width:210px;font:bold 14px/16px "+cd.fontFamily+";margin:0;color:#cc5522;white-space:nowrap;overflow:hidden\' title=\'"+cV+"\'>"+cR+"</p>";var cX=[];cX.push("<div style=\'font:12px "+cd.fontFamily+";margin-top:10px\'>");if(cU){var cW="\u5730\u5740\uff1a";if(cT==BMAP_POI_TYPE_BUSSTOP||cT==BMAP_POI_TYPE_SUBSTOP){cW="\u8f66\u6b21\uff1a"}cX.push(\'<table cellspacing="0" style="overflow:hidden;table-layout:fixed;width:100%;font:12px \'+cd.fontFamily+\'" >\');cX.push(\'<tr><td style="vertical-align:top;width:38px;white-space:nowrap;word-break:keep-all">\'+cW+\'&nbsp;</td><td style="line-height:16px">\');cX.push(cU+"&nbsp;</td></tr>");if(cQ){cX.push(\'<tr><td style="vertical-align:top;">\u7535\u8bdd\uff1a</td><td>\'+cQ+"</td></tr>")}cX.push("</table>")}else{if(cQ){cX.push(\'<table cellspacing="0" style="table-layout:fixed;width:100%;font:12px \'+cd.fontFamily+\'">\');cX.push(\'<tr><td style="vertical-align:top;width:36px;white-space:nowrap;word-break:keep-all">\u7535\u8bdd\uff1a</td><td>\'+cQ+"</td></tr></table>")}}cX.push("</div>");var cO=new bQ(cX.join(""),{title:cP,height:0,width:230,margin:[10,10,20,10]});return cO};ao.addDestPoi=function(cQ,T,cR,cN){var cP=aa(T);if(!cP){return}var cO=new M(x+"img/dest_markers.png",new aI(42,34),{anchor:new aI(14,32),imageOffset:new aI(0,-34*cN),infoWindowAnchor:new aI(14,0)});var cM=new ae(cP,{icon:cO,baseZIndex:3500000,draggingCursor:"pointer"});cQ.addOverlay(cM);if(cR){cM.setTitle(cR)}return cM};ao.addLine=function(cM,T){return ao.addRoute(cM,T,bi)};ao.ROUTE_STYLE_CONFIG=[{stroke:6,color:"#0030ff",opacity:0.45,style:"solid"},{stroke:6,color:"#0030ff",opacity:0.45,style:"solid"},{stroke:4,color:"#30a208",opacity:0.55,style:"dashed"},{stroke:5,color:"#0030ff",opacity:0.45,style:"solid"},{stroke:4,color:"#ff0103",opacity:0.65,style:"dashed"},{stroke:5,color:"#ff0103",opacity:0.65,style:"solid"}];ao.addRoute=function(cS,cP,cO){var cN=ao.ROUTE_STYLE_CONFIG;if(typeof cO=="undefined"){cO=0}if(!cN[cO]){return}var T=cP;var cM=cN[cO];var cR=new f(T,{strokeWeight:cM.stroke,strokeColor:cM.color,strokeOpacity:cM.opacity,strokeStyle:cM.style,clickable:false});cS.addOverlay(cR);cR._routeType=cO;if(cO==bi){var cQ=new f(T,{strokeWeight:cM.stroke-2,strokeColor:"#fff",strokeOpacity:0.3,clickable:false});cR._p=cQ;cS.addOverlay(cQ)}return cR};ao.createTransInfoWnd=function(cM){var cQ=cM.content;var T=cM.curIndex;var cR=cM.total;var cO=cM.nextTransCbk;var cP=cM.obj;var cS=cM.hideStep;var cT=["<div style=\'font:12px "+cd.fontFamily+"\'>"];if(cQ){cT.push("<div style=\'margin:0 1em 24px 0\'>"+cQ+"</div>")}if(!cS){cT.push(ao.genStepNavHtml(cR,T))}cT.push("</div>");var cN=new bQ(cT.join(""),{title:"",height:0,width:220,margin:[10,10,20,10]});if(cS){return cN}cN.addEventListener("open",function(){if(a9.G("trans_prev")){a9.on(a9.G("trans_prev"),"click",function(){if(cO&&typeof cO=="function"){cO(T-1,cP)}})}if(a9.G("trans_next")){a9.on(a9.G("trans_next"),"click",function(){if(cO&&typeof cO=="function"){cO(T+1,cP)}})}});return cN};ao.genStepNavHtml=function(cN,T){var cM=[];cM.push(\'<table width="99%" cols="2" style="background:#eaf2ff;font:12px \'+cd.fontFamily+\'"><tbody><tr>\');cM.push(\'<td nowrap="nowrap" width="50%" align="left">\');if(T==0){cM.push(\'<span unselectable="on" style="color:#9c9d99;-moz-user-select:none" >\u4e0a\u4e00\u6b65</span>\')}else{cM.push(\'<a id="trans_prev" style="color:#7777cc;-moz-user-select:none" href="javascript:void(0)">\u4e0a\u4e00\u6b65</a>\')}cM.push("</td>");cM.push(\'<td nowrap="nowrap" width="50%" align="right">\');if(T==cN+1){cM.push(\'<span unselectable="on" style="color:#9c9d99;-moz-user-select:none" >\u4e0b\u4e00\u6b65</span>\')}else{cM.push(\'<a style="color:#7777cc" id="trans_next" href="javascript:void(0)">\u4e0b\u4e00\u6b65</a>\')}cM.push("</td></tr></tbody></table>");return cM.join("")};ao.addTransPoi=function(cQ,T,cN,cR){var cP=aa(T);if(!cP){return}cN=cN||BMAP_LINE_TYPE_BUS;var cS=-55;if(cN==BMAP_LINE_TYPE_SUBWAY){cS=-76}var cO=new M(x+"img/trans_icons.png",new aI(21,21),{imageOffset:new aI(0,cS),infoWindowAnchor:new aI(10,0)});var cM=new ae(cP,{icon:cO});cQ.addOverlay(cM);if(cR){cM.setTitle(cR)}return cM};ao.getInfoWindowDom=function(T){if(T&&T.infoWindowDoms&&T.infoWindowDoms.contentDiv){return T.infoWindowDoms.contentDiv.childNodes[0]}return null};ao.addStationPoi=function(cN,T,cO){var cM=new ae(T,{icon:new M(bn._stopUrl,new aI(11,11))});if(cO){cM.setTitle(cO)}cN.addOverlay(cM);return cM};ao.addDragMkr=function(cN,T){var cM=new ae(T,{icon:new M(cd.imgPath+"drag.png",new aI(11,11)),draggingCursor:"pointer"});cN.addOverlay(cM);cM.setZIndex(10);return cM};ao.createTipLbl=function(cM){var T=new ah(cM,{offset:new aI(30,-10)});T.setStyle({border:"solid 1px gray",padding:"2px",whiteSpace:"nowrap",background:"#fff"});return T};ao.getDistanceByPixel=function(cM,T){if(!cM||!T){return}return Math.round(Math.sqrt(Math.pow(cM.x-T.x,2)+Math.pow(cM.y-T.y,2)))};w.CBK_SEARCH_COMPLETE=1;w.CBK_MARKERS_SET=2;w.CBK_INFO_HTML_SET=3;w.CBK_POLYLINES_SET=4;w.CBK_RESULTS_HTML_SET=5;w.CBK_BUSLIST_COMPLETE=6;w.CBK_BUSLINE_COMPLETE=7;w.CBK_BUSLISTHTML_SET=8;w.CBK_BUSLINEHTML_SET=9;w._getPoiUrl=function(T,cM){if(T){return cJ+"?s="+encodeURIComponent("inf&uid="+T+"&c="+cM)+"&i=0&sr=1"}return""};w._getLocType=function(T){if(!T){return a1}if(typeof T=="string"){return a7}if(T instanceof ce){return cr}if(T instanceof bA){return ac}if(typeof T=="number"){return B}return a1};a9.extend(w.prototype,{_getIdByLoc:function(cP,T){var cM=w._getLocType(cP.src);if(cM==a1){return}var cN=this;if(cM==B){T&&T(cP.src);return}if(cM==a7){if(cP.curLocType==cM&&cP.curSrc==cP.src&&cP.curId){T&&T(cP.curId);return}cP.curLocType=cM;cP.curSrc=cP.src;bc.request(function(cR){if(cR&&cR.result&&cR.result.type==s){cN._loc.curId=cR.content.code;T&&T(cN._loc.curId)}},{qt:cw,wd:cP.src})}else{var cO;var cQ=18;if(cM==ac){cO=cP.src.getCenter();cQ=cP.src.getZoom()}else{cO=cP.src}if(cM==cP.curLocType&&cP.curSrc.equals(cO)&&cP.curId){T&&T(cP.curId);return}if(cM==ac){cO=bb.convertLL2MC(cO)}if(cM==cr){cO=bb.convertLL2MC(cO)}cP.curLocType=cM;cP.curSrc=new ce(cO.lng,cO.lat);bc.request(function(cR){if(cR&&cR.result&&cR.result.type==a6){cN._loc.curId=cR.content?cR.content.uid:1;T&&T(cN._loc.curId)}},{qt:c,b:cO.lng+","+cO.lat+";"+cO.lng+","+cO.lat,l:cQ})}},_setStatus:function(T){if(typeof T=="number"){this._status=T}else{delete this._status}},_triggerCbk:function(cM,cO,cN){var T;switch(cM){case w.CBK_SEARCH_COMPLETE:T=this._opts.onSearchComplete;break;case w.CBK_MARKERS_SET:T=this._opts.onMarkersSet;break;case w.CBK_POLYLINES_SET:T=this._opts.onPolylinesSet;break;case w.CBK_INFO_HTML_SET:T=this._opts.onInfoHtmlSet;break;case w.CBK_RESULTS_HTML_SET:T=this._opts.onResultsHtmlSet;break;case w.CBK_BUSLIST_COMPLETE:T=this._opts.onGetBusListComplete;break;case w.CBK_BUSLINE_COMPLETE:T=this._opts.onGetBusLineComplete;break;case w.CBK_BUSLISTHTML_SET:T=this._opts.onBusListHtmlSet;break;case w.CBK_BUSLINEHTML_SET:T=this._opts.onBusLineHtmlSet;break;default:break}T&&T(cO,cN)}});var aS=0;var bx=1;var aN=2;U.unique=function(cM){var cP=false;var cO=[],cQ={};for(var cN=0,T=cM.length;cN<T;cN++){if(!cQ[cM[cN]]){cQ[cM[cN]]=true;cO.push(cM[cN])}}return cO};U.getBestLevel=function(cN,cM){if(cM){var T=Math.min(cM.width/1100,cM.height/660);cN=Math.round(cN+(Math.log(T)/Math.log(2)))}if(cN<1){cN=1}if(cN>18){cN=18}return cN};U.parseGeo=function(cQ,cT){if(typeof cQ!="string"||!cQ){return}var cV=cQ.split("|");var T;var cO;var cM;if(cV.length==1){T=X(cQ)}else{T=X(cV[2]);cO=X(cV[0]);cM=X(cV[1]);if(!cT){return T}}var cR={type:T.geoType};if(cT){switch(cR.type){case aN:var cS=new ce(T.geo[0][0],T.geo[0][1]);var cU=bb.convertMC2LL(cS);cR.point=cU;cR.points=[cU];break;case bx:cR.points=[];var cW=T.geo[0];for(var cP=0,cN=cW.length-1;cP<cN;cP+=2){var cX=new ce(cW[cP],cW[cP+1]);cX=bb.convertMC2LL(cX);cR.points.push(cX)}cO=new ce(cO.geo[0][0],cO.geo[0][1]);cM=new ce(cM.geo[0][0],cM.geo[0][1]);cO=bb.convertMC2LL(cO);cM=bb.convertMC2LL(cM);cR.bounds=new bO(cO,cM);break;default:break}}return cR};U.parseGeoExt=function(c6,cX){if(!cX){cX=0}else{if(cX<0.25){cX=0}else{if(cX>0.25&&cX<1){cX=1}else{if(cX>32){cX=32}}}}var cS=c6.split("|");if(cS.length==1){var cN=X(cS[0]);return{type:cN.type,bound:"",points:cN.geo.join(",")}}else{if(cS.length>1){var cY=c6.split(";.=");var cU=[];var cO=[];var cZ=0;var c3=cY.length;for(var c0=0;c0<c3;c0++){var c5=cY[c0];if(c3>1){if(c0==0){c5=c5+";"}if(c0>0&&c0<c3-1){c5=".="+c5+";"}if(c0==c3-1){c5=".="+c5}}var cP=c5.split("|");var c2=X(cP[0]);var c1=X(cP[1]);cU.push(c2.geo.join(","));cU.push(c1.geo.join(","));var cN=X(cP[2]);cZ=cN.type;var c4=cN.geo.join(",");c4=U.parseGeoExtReg1(c4);if(cX>0){c4=U.parseGeoExtReg2(c4,cX)}cO.push(c4)}if(c3<=1){cO=cO.join(";")}if(c3==2){var cM=cO[0]+";"+cO[1];var cQ=cM.split(";");var T=[];for(var c0=0;c0<cQ.length;c0++){var cT=cQ[c0].split(",")[0];var cR=cQ[c0].split(",")[1];var cV=new ce(cT,cR);var cW=bb.convertMC2LL(cV);T.push(cW)}cO=T}return{type:cZ,bound:cU.join(";"),points:cO}}}};U.parseGeoStr=function(cN){var cM=cN.split(",");var T=new ce(cM[0],cM[1]);return bb.convertMC2LL(T)};var aA=["=",".","-","*"];var bY=1<<23;function X(cT){var cS=ap(cT.charAt(0));var cM=cT.substr(1);var cV=0;var T=cM.length;var cW=[];var cQ=[];var cR=[];while(cV<T){if(cM.charAt(cV)==aA[0]){if((T-cV)<13){return 0}cR=cC(cM.substr(cV,13),cW);if(cR<0){return 0}cV+=13}else{if(cM.charAt(cV)==";"){cQ.push(cW.slice(0));cW.length=0;++cV}else{if((T-cV)<8){return 0}cR=aT(cM.substr(cV,8),cW);if(cR<0){return 0}cV+=8}}}for(var cP=0,cN=cQ.length;cP<cN;cP++){for(var cO=0,cU=cQ[cP].length;cO<cU;cO++){cQ[cP][cO]/=100}}return{geoType:cS,geo:cQ}}function ap(cM){var T=-1;if(cM==aA[1]){T=aN}else{if(cM==aA[2]){T=bx}else{if(cM==aA[3]){T=aS}}}return T}function cC(cO,cM){var T=0;var cQ=0;var cP=0;for(var cN=0;cN<6;cN++){cP=ad(cO.substr(1+cN,1));if(cP<0){return -1-cN}T+=cP<<(6*cN);cP=ad(cO.substr(7+cN,1));if(cP<0){return -7-cN}cQ+=cP<<(6*cN)}cM.push(T);cM.push(cQ);return 0}function aT(cP,cN){var cM=cN.length;if(cM<2){return -1}var T=0;var cR=0;var cQ=0;for(var cO=0;cO<4;cO++){cQ=ad(cP.substr(cO,1));if(cQ<0){return -1-cO}T+=cQ<<(6*cO);cQ=ad(cP.substr(4+cO,1));if(cQ<0){return -5-cO}cR+=cQ<<(6*cO)}if(T>bY){T=bY-T}if(cR>bY){cR=bY-cR}cN.push(cN[cM-2]+T);cN.push(cN[cM-1]+cR);return 0}function ad(cM){var T=cM.charCodeAt(0);if(cM>="A"&&cM<="Z"){return T-"A".charCodeAt(0)}else{if(cM>="a"&&cM<="z"){return(26+T-"a".charCodeAt(0))}else{if(cM>="0"&&cM<="9"){return(52+T-"0".charCodeAt(0))}else{if(cM=="+"){return 62}else{if(cM=="/"){return 63}}}}}return -1}');
﻿_jsload&&_jsload('local', 'function aC(T,cP,cM){a9.lang.Class.call(this);if(!T){return}this.container=(typeof(T)=="object")?T:a9.G(T);this.page=1;this.pageCount=100;this.argName="pg";this.pagecap=4;this.callback=cP;this.update=true;var cN={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:true};if(!cM){cM=cN}for(var cO in cM){if(typeof(cM[cO])!="undefined"){this[cO]=cM[cO]}}this.render()}a9.extend(aC.prototype,{render:function(){this.initialize()},initialize:function(){this.checkPages();this.container.innerHTML=this.createHtml()},checkPages:function(){if(isNaN(parseInt(this.page))){this.page=1}if(isNaN(parseInt(this.pageCount))){this.pageCount=1}if(this.page<1){this.page=1}if(this.pageCount<1){this.pageCount=1}if(this.page>this.pageCount){this.page=this.pageCount}this.page=parseInt(this.page);this.pageCount=parseInt(this.pageCount)},getPage:function(){var cM=location.search;var cN=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");var T=cM.match(cN);this.page=RegExp.$1},createHtml:function(){var cT=[],cN=this.page-1,cQ=this.page+1;cT.push(\'<p style="margin:0;padding:0;white-space:nowrap">\');if(cN<1){}else{if(this.page>=this.pagecap){var cM=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp1}">\u9996\u9875</a></span>\';cT.push(cM.replace("{temp1}","BMap.I(\'"+this.guid+"\').toPage(1);"))}var cM=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp2}">\u4e0a\u4e00\u9875</a></span>\';cT.push(cM.replace("{temp2}","BMap.I(\'"+this.guid+"\').toPage("+cN+");"))}if(this.page<this.pagecap){if(this.page%this.pagecap==0){var cO=this.page-this.pagecap-1}else{var cO=this.page-this.page%this.pagecap+1}var cR=cO+this.pagecap-1}else{var cS=Math.floor(this.pagecap/2);var cP=this.pagecap%2-1;if(this.pageCount>this.page+cS){var cR=this.page+cS;var cO=this.page-cS-cP}else{var cR=this.pageCount;var cO=this.page-cS-cP}}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap){var cO=this.pageCount-this.pagecap+1;var cR=this.pageCount}for(var T=cO;T<=cR;T++){if(T>0){if(T==this.page){cT.push(\'<span style="margin-right:3px">\'+T+"</span>")}else{if(T>=1&&T<=this.pageCount){var cM=\'<span><a style="color:#7777cc;margin-right:3px" href="javascript:void(0)" onclick="{temp3}">[\'+T+"]</a></span>";cT.push(cM.replace("{temp3}","BMap.I(\'"+this.guid+"\').toPage("+T+");"))}}}}if(cQ>this.pageCount){}else{var cM=\'<span><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp4}">\u4e0b\u4e00\u9875</a></span>\';cT.push(cM.replace("{temp4}","BMap.I(\'"+this.guid+"\').toPage("+cQ+");"))}cT.push("</p>");return cT.join("")},toPage:function(cM){var T=cM?cM:1;if(typeof(this.callback)=="function"){this.callback(T);this.page=T}if(this.update){this.render()}}});a5.isReqDataMap=function(cM,T){if(!cM||typeof T=="undefined"){return false}if(cM==ck&&T!=Y&&T!=bu&&T!=s&&T!=aq&&T!=bF){return false}if(cM==cc&&T!=aO){return false}if(cM==am&&T!=S){return false}if(cM==aH&&T!=ay){return false}if(cM==aj&&T!=af){return false}if(cM==a2&&T!=bT){return false}return true};a9.extend(a5.prototype,{_check:function(){for(var cM=0,T=this._queryList.length;cM<T;cM++){var cN=this._queryList[cM];this[cN.method].apply(this,cN.arguments)}delete this._queryList;this.initialize()},initialize:function(){var T=this;this.renderMap=new ar(T);this.renderList=new Q(T)},search:function(T,cM){if(!T||(T instanceof Array&&(T.length<1||T.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE);return}cM=cM||{};if(cM.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:T,customData:cM.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}var cO=arguments[2]||{};var cN=this;this._getIdByLoc(this._loc,function(cT){cT=cT||1;cN._isMultiKey=cN._isKeywordArray(T);var cS;if(!cN._isMultiKey){cS={qt:cM.forceLocal?R:ck,c:cT,wd:T,rn:cN.getPageCapacity()}}else{var cR=T.join("$$");var cP=T.length;cS={qt:aj,c:cT,wd:cR,wdn:cP,rn:cN.getPageCapacity()}}if(cN._opts.reqFrom){a9.extend(cS,{from:cN._opts.reqFrom})}a9.extend(cS,cO.params);var cQ={params:cS,options:cM,userKw:cO.userKw||T};a9.extend(cQ,cO);bc.request(function(cV,cU){cN._rawDataCbk(cV,cU)},cS,cQ)})},_isKeywordArray:function(T){if(T&&T instanceof Array){return true}else{return false}},searchInBounds:function(T,cP,cM){if(!T||!cP||(T instanceof Array&&(T.length<1||T.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE);return}var cM=cM||{};var cO=this;if(cM.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:T,bounds:cP,customData:cM.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}var cN=arguments[2]||{};this._getIdByLoc(this._loc,function(cX){cX=cX||1;var cW=cP.getSouthWest();var cV=cP.getNorthEast();cW=bb.convertLL2MC(cW);cV=bb.convertLL2MC(cV);var cR="("+cW.lng+","+cW.lat+";"+cV.lng+","+cV.lat+")";cO._isMultiKey=cO._isKeywordArray(T);var cU;if(!cO._isMultiKey){cU={qt:am,c:cX,wd:T,ar:cR,rn:cO._opts.pageCapacity,l:18}}else{var cT=T.join("$$");var cQ=T.length;cU={qt:aH,c:cX,wd:cT,wdn:cQ,ar:cR,rn:cO.getPageCapacity(),l:18}}if(cO._opts.reqFrom){a9.extend(cU,{from:cO._opts.reqFrom})}a9.extend(cU,cN.params);var cS;if(cN&&cN.center&&cN.radius){cS={params:cU,bounds:cP,center:cN.center,radius:cN.radius,userKw:cN.userKw||T}}else{cS={params:cU,bounds:cP,userKw:cN.userKw||T}}bc.request(function(cZ,cY){cO._rawDataCbk(cZ,cY)},cU,cS)})},searchNearby:function(cP,cN,cQ,cW){if(!cP||!cN||(!(cN instanceof ce)&&typeof cN=="object"&&!cN.uid)||(cP instanceof Array&&(cP.length<1||cP.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE);return}var cW=cW||{};if(cW.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:cP,center:cN,radius:cQ,customData:cW.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}cQ=cQ||a5.DEFAULT_RADIUS;cQ=cQ<0?a5.DEFAULT_RADIUS:(cQ>a5.MAX_RADIUS?a5.MAX_RADIUS:cQ);var cT=this;var cM=arguments[3]||{};if(cN instanceof ce){var cO=bb.convertLL2MC(cN);var cS=new ce(cO.lng-cQ,cO.lat-cQ);var cR=new ce(cO.lng+cQ,cO.lat+cQ);var cV=bb.convertMC2LL(cS);var cU=bb.convertMC2LL(cR);var T=new bO(new ce(cV.lng,cV.lat),new ce(cU.lng,cU.lat));cM.center=cN;cM.radius=cQ;this.searchInBounds(cP,T,cM);return}this._getIdByLoc(this._loc,function(c1){c1=c1||1;cT._isMultiKey=cT._isKeywordArray(cP);var cZ;if(!cT._isMultiKey){cZ={qt:cc,c:c1,wd:cP,rn:cT.getPageCapacity(),uid:cN.uid,r:cQ}}else{cZ={qt:a2,c:c1,wd:cP.join("$$"),wdn:cP.length,rn:cT.getPageCapacity(),uid:cN.uid,r:cQ}}if(typeof cN=="string"){if(!cT._isMultiKey){cZ.qt=ck;cZ.wd=cN+" "+cP}else{cZ.qt=aj;var cX=[];for(var cY=0;cY<cP.length;cY++){var c0=cN+" "+cP[cY];cX.push(c0)}cZ.wd=cX.join("$$");cZ.wdn=cX.length}delete cZ.r;delete cZ.uid}if(cT._opts.reqFrom){a9.extend(cZ,{from:cT._opts.reqFrom})}a9.extend(cZ,cM.params);bc.request(function(c3,c2){cT._rawDataCbk(c3,c2)},cZ,{params:cZ,center:cN,radius:cQ,userKw:cM.userKw||cP})})},_rawDataCbk:function(cV,cN){var cU=this;if(cV.result.type==ay||cV.result.type==af||cV.result.type==bT){cU._isMultiKey=true}else{cU._isMultiKey=false}this.clearResults();cU._json=cV;this._ud=cN;var T=cV.result;var cT=cN.params.qt;if(!cU._isMultiKey){if(T.error!=0||!a5.isReqDataMap(cT,T.type)){var cO=cV.current_city;this._results=new cm({keyword:cN.userKw,city:cO.name,province:cO.up_province_name||"",ccode:cO.code,pc:cU.getPageCapacity(),center:cN.center,radius:cN.radius,bounds:((cN.center&&cN.radius)?undefined:cN.bounds),moreUrl:this._getMoreUrl(cN,cO)});this._results._qt=cN.params.qt;this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results);this._renderList();return}}else{if(T.error!=0||!a5.isReqDataMap(cT,T.type)){var cO=cV.current_city;this._arrResults=[];var cM=cN.userKw;for(var cS=0,cP=cM.length;cS<cP;cS++){var cR=new cm({keyword:cM[cS],city:cO.name,province:cO.up_province_name||"",ccode:cO.code,pc:cU.getPageCapacity(),center:cN.center,radius:cN.radius,bounds:((cN.center&&cN.radius)?undefined:cN.bounds),moreUrl:""});cR._qt=cN.params.qt;this._arrResults.push(cR)}this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._arrResults);this._renderList();return}}cU._processRaw(cN);cU._renderMap();cU._renderList();var cQ;if(!this._isMultiKey){cQ=this._results}else{cQ=this._getMaxResults()}if(this._opts.renderOptions.selectFirstResult&&cQ&&cQ.getNumPois()>0){var cU=this;setTimeout(function(){cU._select(0)},240)}},_processRaw:function(cR){var db=this._json.result,dm=this._json.content,c7=this._json.current_city,dn=db.type,cV=this,cS=db.page_num||0,c4=0,dc=0,cY=[],c9=[],T=[],dl=[],c6=[],c0=[];if(this._json.psrs&&this._json.psrs.SEResult){var cO=this._json.psrs.SEResult;if(cO.length>0){for(var dj=0,cW=cO.length;dj<cW;++dj){c0.push(cO[dj])}}}var de=this._json.suggest_query;if(de){for(var dj=0,cW=de.length;dj<cW;++dj){de[dj]&&de[dj].query&&c0.push(de[dj].query)}}c0=U.unique(c0);if(dn!=bu&&dn!=aq){var c2;if(!this._isMultiKey){dc=db.count-(cS==0?(db.spec_dispnum||0):0);c4=db.total<760?db.total:760;c2=cS==0?(db.spec_dispnum||0):0}if(dn!=s){if(!this._isMultiKey){for(var dj=c2;dj<db.count;dj++){if(dm&&dm[dj]){var cP=dm[dj];var cZ=this._formatAddr(cP.addr,cP.poiType);var c3=[];if(cP.cla&&cP.cla.length>0){var cN=cP.cla.length;while(cN--){var da=cP.cla[cN][1];da=da.replace("<b>","").replace("</b>","");c3.unshift(da)}}var c8={title:cP.name,uid:cP.uid,point:U.parseGeo(cP.geo,true).point,url:w._getPoiUrl(cP.uid,c7.code),address:cZ,city:c7.name,province:c7.up_province_name||"",phoneNumber:cP.tel,postcode:cP.zip,type:cP.poiType||BMAP_POI_TYPE_NORMAL,isAccurate:(cP.acc_flag&&cP.acc_flag==1)?true:false};if(c3.length>0){c8.tags=c3}cY.push(c8);c9.push(c8.point)}}}else{var cU=db.result_array;var dd=cR.userKw.length;for(var dj=0;dj<dd;dj++){dl[dj]=[];c6[dj]=[];T[dj]=[];if(!cU[dj]){continue}if(cU[dj].type==bu){if(dm&&dm[dj]){for(var dh=0;dh<dm[dj].length;dh++){var cM=dm[dj][dh];T[dj].push({city:cM.name,_code:cM.code,numResults:cM.num})}}if(this._json.more_city&&this._json.more_city[dj]){var cX=this._json.more_city[dj];for(var dh=0,df=cX.length;dh<df;dh++){for(var dg=0,c5=cX[dh].city.length;dg<c5;dg++){var cM=cX[dh].city[dg];T[dj].push({city:cM.name,_code:cM.code,numResults:cM.num})}}}continue}var c1=cU[dj].count;var cT=cU[dj].page_num||0;var dk=cU[dj].total>760?760:cU[dj].total;var cQ={count:c1,pagenum:cT,total:dk};c6[dj].push(cQ);for(var dh=0;dh<c1;dh++){if(dm&&dm[dj]&&dm[dj][dh]){var cP=dm[dj][dh];var cZ=this._formatAddr(cP.addr,cP.poiType);var c3=[];if(cP.cla&&cP.cla.length>0){var cN=cP.cla.length;while(cN--){var da=cP.cla[cN][1];da=da.replace("<b>","").replace("</b>","");c3.unshift(da)}}var c8={title:cP.name,uid:cP.uid,point:U.parseGeo(cP.geo,true).point,url:w._getPoiUrl(cP.uid,c7.code),address:cZ,city:c7.name,province:c7.up_province_name||"",phoneNumber:cP.tel,postcode:cP.zip,type:cP.poiType||BMAP_POI_TYPE_NORMAL,isAccurate:(cP.acc_flag&&cP.acc_flag==1)?true:false,tags:c3};dl[dj].push(c8)}}}}}else{dc=c4=1;var c8={title:dm.cname,uid:dm.uid,point:U.parseGeo(dm.geo,true).point,address:dm.cname,url:cJ+"?s="+encodeURIComponent("s&wd="+db.wd)};cY.push(c8);c9.push(c8.point)}}else{if(dn==aq){dc=c4=1;var c8={title:db.wd,point:U.parseGeoStr(dm[0]),url:cJ+"?s="+encodeURIComponent("s&wd="+db.wd)};cY.push(c8);c9.push(c8.point)}if(dn==bu){dc=c4=0;for(var dj=0;dj<dm.length;dj++){T.push({city:dm[dj].name,_code:dm[dj].code,numResults:dm[dj].num})}if(this._json.more_city){var cX=this._json.more_city;for(var dj=0,df=cX.length;dj<df;dj++){for(var dh=0,c5=cX[dj].city.length;dh<c5;dh++){var dm=cX[dj].city[dh];T.push({city:dm.name,_code:dm.code,numResults:dm.num})}}}}}if(!this._isMultiKey){this._results=new cm({keyword:cR.userKw,count:dc,total:c4,pageIdx:db.page_num,city:c7.name,province:c7.up_province_name||"",ccode:c7.code,pois:cY,cityList:T,pc:cV.getPageCapacity(),center:cR.center,radius:cR.radius,bounds:((cR.center&&cR.radius)?undefined:cR.bounds),moreUrl:this._getMoreUrl(cR,c7),suggestions:c0});this._results._qt=cR.params.qt;if(c4==0&&dn!=bu){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{if(dn!=bu){this._setStatus(BMAP_STATUS_SUCCESS)}else{this._setStatus(BMAP_STATUS_CITY_LIST)}}this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results)}else{this._arrResults=[];var dd=cR.userKw.length;var di=true;for(var dj=0;dj<dd;dj++){if(c6[dj].length>0&&c6[dj][0].total>0){di=false}var cY=new cm({keyword:cR.userKw[dj]||"",count:c6[dj].length>0?c6[dj][0].count:0,total:c6[dj].length>0?c6[dj][0].total:0,pageIdx:c6[dj].length>0?c6[dj][0].pagenum:0,city:c7.name,province:c7.up_province_name||"",ccode:c7.code,pois:dl[dj]||[],cityList:T[dj]||[],pc:cV.getPageCapacity(),center:cR.center,radius:cR.radius,bounds:((cR.center&&cR.radius)?undefined:cR.bounds),moreUrl:"",suggestions:c0});cY._qt=cR.params.qt;this._arrResults.push(cY)}if(di){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{this._setStatus(BMAP_STATUS_SUCCESS)}this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._arrResults)}},_getMoreUrl:function(cM,cN){var cR="";var cP=typeof cM.center=="string"?(cM.center+" "+cM.userKw):cM.userKw;var cQ="s",cO="",cT="";if(typeof cM.center=="object"&&!(cM.center instanceof ce)){cQ="nb";var cS=cM.center.point;cS=bb.convertLL2MC(cS);cO=encodeURIComponent("&uid="+cM.center.uid+"&r="+cM.radius)+"&l=13&c="+cS.lng+","+cS.lat}if(cM.bounds&&!cM.center){cQ="bd";var cS=cM.bounds.getCenter();cS=bb.convertLL2MC(cS);cT="&c="+cS.lng+","+cS.lat+"&l=13"}if(cM.center&&cM.center instanceof ce){var cS=cM.center;cS=bb.convertLL2MC(cS);cT="&c="+cS.lng+","+cS.lat+"&l=13";var T=cM.radius;cQ="tpl:PoiSearch?nb&ar=("+(cS.lng-T)+","+(cS.lat-T)+";"+(cS.lng+T)+","+(cS.lat+T)+")"}cR=cJ+"?sr=1"+cT+"&s="+encodeURIComponent(cQ+"&wd="+cP+"&c="+cN.code)+cO;return cR},_formatAddr:function(cM,T){T=T||BMAP_POI_TYPE_NORMAL;if(T==BMAP_POI_TYPE_BUSSTOP||T==BMAP_POI_TYPE_SUBSTOP){return U.unique(cM.split(";")).join("; ")}return cM},_chkMultiKeyResults:function(cO){for(var cN=0,T=cO.length;cN<T;cN++){var cM=cO[cN];if(cM.getCurrentNumPois()>0){return true}}return false},_renderMap:function(){if(this._opts.renderOptions.map&&((this._results&&this._results.getCurrentNumPois()>0)||(this._arrResults&&this._chkMultiKeyResults(this._arrResults)))){var cW=this,cM=this._opts.renderOptions.map,cY=[];if(!cW._isMultiKey){for(var cT=0;cT<this._results.getCurrentNumPois();cT++){var cX=this._results.getPoi(cT);cY.push(cX.point);var cU=this._addPoi(cX.point,cT,cX.title);if(!cU){continue}cX.marker=cU;(function(){var c0=cT;cU.addEventListener("click",function(){cW._select(c0)})})();this._overlays.push(cU)}}else{var cZ=0;for(var cT=0,cQ=this._arrResults.length;cT<cQ;cT++){var cR=this._arrResults[cT];for(var cS=0,cP=cR.getCurrentNumPois();cS<cP;cS++){var cX=cR.getPoi(cS);cY.push(cX.point);var cU=ao.addSearchInBoundsPoi(cM,cX.point,cX.title);if(!cU){continue}cX.marker=cU;cX._kwIndex=cT;(function(){var c0=cZ;cU.addEventListener("click",function(){cW._select(c0)})})();this._overlays.push(cU);this._arrPois.push(cX);cZ++}}}var T=this._ud.center;if(T&&typeof T!="string"&&!(T instanceof ce)){var cO=this._centerMkr=ao.addCenterPoi(cM,T.point,T.title);cO.addEventListener("click",function(){cW._select(-1);cW._curIndex="c";var c0=ao.createSearchInfoWnd({title:T.title,addr:T.address,tel:T.phoneNumber,url:T.url,poiType:T.type});c0.addEventListener("open",function(){cW._triggerCbk(w.CBK_INFO_HTML_SET,T,ao.getInfoWindowDom(cM))});cO.openInfoWindow(c0)})}var cV=this._json.result&&this._json.result.type;var cN={};switch(cV){case Y:case aO:case S:case ay:case af:case bT:cN.points=cY;break;case s:cN.center=this._results.getPoi(0).point;cN.level=this._json.content.level;break;case bF:cN.center=this._results.getPoi(0).point;cN.level=13;break;case aq:cN.center=this._results.getPoi(0).point;cN.level=parseInt(this._json.content[1]);break;default:break}this._getBestViewport(cN);if(!cW._isMultiKey){this._triggerCbk(w.CBK_MARKERS_SET,this._results._pois)}else{this._triggerCbk(w.CBK_MARKERS_SET,this._arrPois)}}},_addPoi:function(cM,T,cN){if(this._opts.pageCapacity<=a5.DEFAULT_PAGE_CAPACITY){return ao.addSearchPoi(this._opts.renderOptions.map,cM,T,cN)}else{return ao.addSearchInBoundsPoi(this._opts.renderOptions.map,cM,cN)}},_select:function(cO){var cN=this._curIndex,cR=this._opts.renderOptions.map,T=this._opts.renderOptions.panel;if(cR&&cO>-1&&this._overlays[cO]){var cP=this._overlays[cO];cR.closeInfoWindow();var cS;if(!this._isMultiKey){cS=this._results.getPoi(cO)}else{cS=this._arrPois[cO]}if(!cS){return}var cM=ao.createSearchInfoWnd({title:cS.title,addr:cS.address,tel:cS.phoneNumber,url:cS.url,poiType:cS.type});var cQ=this;cM.addEventListener("close",function(){if(T){if(typeof cQ._curIndex=="number"&&cQ._curIndex!=-1&&T.getElementsByTagName("li")[cQ._curIndex]){T.getElementsByTagName("li")[cQ._curIndex].style.backgroundColor=""}}cQ._curIndex=-1});cM.addEventListener("open",function(){cQ._triggerCbk(w.CBK_INFO_HTML_SET,cS,ao.getInfoWindowDom(cR))});cP.openInfoWindow(cM)}if(T){if(typeof cN=="number"&&cN!=-1&&T.getElementsByTagName("li")[cN]){T.getElementsByTagName("li")[cN].style.backgroundColor=""}if(typeof cO=="number"&&cO!=-1&&T.getElementsByTagName("li")[cO]){T.getElementsByTagName("li")[cO].style.backgroundColor="#f0f0f0"}}this._curIndex=cO},_clearOverlays:function(){for(var cM=0,T=this._overlays.length;cM<T;cM++){this._overlays[cM].remove();this._overlays[cM]=null}this._overlays.length=0;for(var cM=0,T=this._arrPois.length;cM<T;cM++){this._arrPois[cM]=null}this._arrPois.length=0;if(this._centerMkr){this._centerMkr.remove();this._centerMkr=null}},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&(this._results||this._arrResults)){var cN=ab("div",{style:"font:12px "+cd.fontFamily+";border:1px solid #999;"});var cT=this.getStatus();var cU=ab("div",{style:"background:#fff"});var cW=ab("ol",{style:"list-style:none;padding:0;margin:0"});if(cT==BMAP_STATUS_SUCCESS){if(!this._isMultiKey){for(var cV=0,cQ=this._results.getCurrentNumPois();cV<cQ;cV++){var c1=this._createItem(cV);cW.appendChild(c1)}}else{var cY=0;for(var cV=0,cQ=this._arrResults.length;cV<cQ;cV++){var cR=this._arrResults[cV];for(var cS=0,cP=cR.getCurrentNumPois();cS<cP;cS++){var c1=this._createItem(cY);cW.appendChild(c1);cY++}}}}if(cT==BMAP_STATUS_CITY_LIST){if(!this._isMultiKey){for(var cV=0,cQ=Math.min(6,this._results.getCityList().length);cV<cQ;cV++){var c1=this._createCityItem(cV);cW.appendChild(c1)}}}if(cT==BMAP_STATUS_UNKNOWN_LOCATION){var c1=ab("li",{style:"margin:2px 0;padding:0 5px 0 3px;overflow:hidden;line-height:17px"});c1.innerHTML="\u62b1\u6b49\uff0c\u672a\u627e\u5230\u76f8\u5173\u5730\u70b9\u3002";cW.appendChild(c1)}cU.appendChild(cW);cN.appendChild(cU);var cZ=this;var cM=ab("div",{style:"white-space:nowrap;text-align:right;background:#e5ecf9;margin-top:5px;padding:2px"});var T;if(!this._isMultiKey){T=ab("a",{style:"color:#7777cc",href:this._results.moreResultsUrl,target:"_blank",title:"\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b\u66f4\u591a\u7ed3\u679c"});T.innerHTML="\u66f4\u591a\u7ed3\u679c&#187;"}else{T=ab("a",{style:"color:#7777cc"});T.innerHTML="&nbsp;"}var cO=ab("div",{style:"float:left;margin-right:5px"});if(!this._isMultiKey){if(this._results.getNumPages()>1){var cX=new aC(cO,function(c2){cZ.gotoPage(c2-1)},{pageCount:cZ._results.getNumPages(),page:cZ._results.getPageIndex()+1,update:false})}}else{var c0=this._getMaxResults();if(c0&&c0.getNumPages()>1){var cX=new aC(cO,function(c2){cZ.gotoPage(c2-1)},{pageCount:c0.getNumPages(),page:c0.getPageIndex()+1,update:false})}}cM.appendChild(cO);cM.appendChild(T);cN.appendChild(cM);this._opts.renderOptions.panel.appendChild(cN);this._triggerCbk(w.CBK_RESULTS_HTML_SET,cN)}},_getMaxResults:function(){var cP,T=-1;for(var cO=0,cM=this._arrResults.length;cO<cM;cO++){var cN=this._arrResults[cO];if(cN.getNumPages()>T){cP=cN;T=cN.getNumPages()}}return cP},_createItem:function(cP){var cT,cM;if(!this._isMultiKey){cT=this._results;if(!cT||!cT.getPoi(cP)){return}cM=cT.getPoi(cP)}else{var cQ=0,cO=false;for(var cX=0,cV=this._arrResults.length;cX<cV;cX++){var cR=this._arrResults[cX];for(var cW=0,cU=cR.getCurrentNumPois();cW<cU;cW++){if(cQ==cP){cM=cR.getPoi(cW);cM._kwIndex=cX;cO=true;break}cQ++}if(cO){break}}}var cZ=ab("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});if(this._curIndex>-1&&cP==this._curIndex){cZ.style.backgroundColor="#f0f0f0"}var cY=cP==0?cP+2+"px":"-"+(cP*20-2)+"px";if(!this._isMultiKey){if(this._opts.pageCapacity>a5.DEFAULT_PAGE_CAPACITY){cY="-218px"}}else{cY="-218px"}var T=["<span style=\'background:url("+x+"bmap/red_labels.gif) 0 "+cY+" no-repeat;padding-left:10px;margin-right:3px\'>&nbsp;</span>"];var c2,cS;if(!this._isMultiKey){var c0=this._results.keyword;var cN=new RegExp(c0,"ig");if(cM.title){c2=cM.title.replace(cN,"<b>$&</b>")}if(cM.address){cS=cM.address.replace(cN,"<b>$&</b>")}}else{if(typeof cM._kwIndex!="undefined"&&this._ud.userKw instanceof Array){var c0=this._ud.userKw[cM._kwIndex];if(c0){var cN=new RegExp(c0,"ig");if(cM.title){c2=cM.title.replace(cN,"<b>$&</b>")}if(cM.address){cS=cM.address.replace(cN,"<b>$&</b>")}}}else{c2=cM.title;cS=cM.address}}if(cM.type==BMAP_POI_TYPE_BUSSTOP){c2+="-\u516c\u4ea4\u8f66\u7ad9"}else{if(cM.type==BMAP_POI_TYPE_SUBSTOP){c2+="-\u5730\u94c1\u7ad9"}}T.push("<span style=\'color:#00c;text-decoration:underline\'>"+c2+"</span>");if(cM.address){T.push("<span style=\'color:#666;\'> - "+cS+"</span>")}cZ.innerHTML=T.join("");var c1=this;cZ.onclick=function(){c1._select(cP)};return cZ},_createCityItem:function(T){var cN=ab("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});cN._index=T;var cO=this._results.getCityList();cN.innerHTML="<span style=\'color:#00c;text-decoration:underline\'>"+cO[T].city+"</span> <span style=\'color:#666\'>(\u5171"+cO[T].numResults+"\u6761\u7ed3\u679c)</span>";var cM=this;cN.onclick=function(){cM.setLocation(cM._results.getCityList()[T].city);cM.search(cM._results.keyword)};return cN},clearResults:function(){delete this._json;delete this._status;delete this._results;if(this._isMultiKey){delete this._arrResults}delete this._ud;this._curIndex=-1;this._setStatus();this._clearOverlays();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},gotoPage:function(cM){if(this._useCustomdata){this.customSearch.gotoPage(cM);return}if(this._ud){var T;if(!this._isMultiKey){T=this._results}else{T=this._getMaxResults()}if(typeof cM=="number"&&!isNaN(cM)&&cM>=0&&cM<=T.getNumPages()-1){this._ud.params.pn=cM;var cN=this._ud.params.qt;switch(cN){case ck:case R:this.search(this._ud.params.wd,this._ud.options,this._ud);break;case am:this.searchInBounds(this._ud.params.wd,this._ud.bounds,this._ud);break;case cc:this.searchNearby(this._ud.params.wd,this._ud.center,this._ud.radius,this._ud);break;case aH:this.searchInBounds(this._ud.userKw,this._ud.bounds,this._ud);break;case aj:this.search(this._ud.userKw,this._ud.options,this._ud);break;case a2:this.searchNearby(this._ud.userKw,this._ud.center,this._ud.radius,this._ud);break;default:break}}else{this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE)}}},_getBestViewport:function(cM){var T=this._opts.renderOptions,cQ=T.map;if(cQ){if(cM.points){var cR=cM.points;var cO=!T.autoViewport,cP=!T.selectFirstResult&&T.autoViewport,cN=cQ.getViewport(cR,{margins:[30,30,30,30]});if(!cO){cQ.setViewport(cN,{enableAnimation:cP})}}else{cM.level=U.getBestLevel(cM.level,cQ);if(this._opts.renderOptions.autoViewport){cQ.centerAndZoom(cM.center,cM.level)}}}},_createCustomSearchInstance:function(){if(!this.customSearch){var T=this;this.customSearch=new aG(T)}},select:function(T){this.renderMap.select(T);this.renderList.select(T);this._curIndex=T}});function cm(T){this.keyword=T.keyword||"";this._pageIndex=T.pageIdx||0;this._currentNumPois=T.count||0;this._numPois=T.total||0;this._numPages=Math.ceil(T.total/T.pc);this.center=T.center;this.radius=T.radius;this.bounds=T.bounds;this.city=T.city;this.province=T.province;this.viewport=T.viewport;this.moreResultsUrl=T.moreUrl;this._pois=T.pois&&T.pois.slice(0)||[];this._cityList=T.cityList&&T.cityList.slice(0);this.suggestions=T.suggestions||[]}a9.extend(cm.prototype,{getPoi:function(T){if(this._pois[T]){return this._pois[T]}},getNumPois:function(){return this._numPois},getNumPages:function(){return this._numPages},getCurrentNumPois:function(){return this._currentNumPois},getPageIndex:function(){return this._pageIndex},getCityList:function(){return this._cityList},toString:function(){return"LocalResult"}});function aG(T){a9.lang.Class.call(this);this.localSearch=T;this.localSearch._curIndex=-1}a9.lang.inherits(aG,a9.lang.Class,"CustomSearch");a9.extend(aG.prototype,{search:function(T){this.localSearch._isMultiKey=false;if(!this._check(T)){return}var cM=this;this.localSearch._getIdByLoc(this.localSearch._loc,function(cP){T.region=cP;var cO=cM._getParams(T);var cN={params:cO,options:T};cM.searchRequest(cO,cN)})},_check:function(){var T=true;if(!bK){this.localSearch._setStatus(BMAP_STATUS_INVALID_KEY);this.localSearch._triggerCbk(w.CBK_SEARCH_COMPLETE);T=false}return T},_getParams:function(cN){var cQ={region:cN.region,page_size:this.localSearch.getPageCapacity(),ak:bK};if(cN.page_index){cQ.page_index=cN.page_index}if(cN.keyword){cQ.q=cN.keyword}if(cN.bounds){var cM=cN.bounds.getSouthWest();var cP=cN.bounds.getNorthEast();var cO=cP.lat+","+cM.lng+";"+cM.lat+","+cP.lng;cQ.bounds=cO}if(cN.center&&(cN.center instanceof ce||cN.center.point instanceof ce)){var T=null;if(cN.center instanceof ce){T=cN.center}else{if(cN.center.point instanceof ce){T=cN.center.point}}cQ.location=T.lat+","+T.lng}if(typeof cN.center=="string"){cQ.q=cN.center+" "+cN.keyword}if(cN.radius){cQ.radius=cN.radius}if(cN.customData&&cN.customData.databoxId){cQ.filter="databox:"+cN.customData.databoxId}return cQ},searchRequest:function(cN,T){var cM=this;bc.request(function(cP,cO){cM._rawDataCbk(cP,cO)},cN,T,"geosearch/poi")},_rawDataCbk:function(cO,cM){this.localSearch.clearResults();this.localSearch._ud=cM;if(cO.status!=0){this._results=new cm({keyword:cM.options.keyword,pc:this.localSearch.getPageCapacity(),center:cM.options.center||"",radius:cM.options.radius||"",bounds:cM.options.bounds||"",moreUrl:""});if(cO.status==5){this.localSearch._setStatus(BMAP_STATUS_INVALID_KEY)}else{this.localSearch._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}this.localSearch._results=this._results;this.localSearch._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results);this.localSearch.renderList.dispatchEvent("render");return}this._processRaw(cO,cM);this.localSearch.renderMap.dispatchEvent("render");this.localSearch.renderList.dispatchEvent("render");var T=cM.options.center;if(T&&typeof T!="string"&&!(T instanceof ce)&&this.localSearch.getStatus()==BMAP_STATUS_SUCCESS){this.localSearch.renderMap.addCenterPoi(T)}var cN=this.localSearch._results;if(this.localSearch._opts.renderOptions.selectFirstResult&&cN&&cN.getNumPois()>0){var cP=this;setTimeout(function(){cP.localSearch.select(0)},240)}},_processRaw:function(cV,T){var cQ=cV.content||{},cR=this,cN=[],cU=[],cP=cQ.length;for(var cO=0,cW=cV.size;cO<cW&&cQ[cO];cO++){var cT=cQ[cO];var cS=new ce(cT.longitude,cT.latitude);var cM={title:cT.name,uid:cT.uid,point:cS,url:"",address:cT.addr,city:cT.city,province:cT.province,phoneNumber:cT.tel,postcode:cT.zip,type:cT.cla};cN.push(cM);cU.push(cS)}this._results=new cm({keyword:T.options.keyword,count:cV.size,total:cV.total,pageIdx:T.params.page_index,city:"",province:"",ccode:"",pois:cN,pc:this.localSearch.getPageCapacity(),center:T.options.center,radius:T.options.radius,bounds:T.options.bounds,moreUrl:""});if(cV.total==0){this.localSearch._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{this.localSearch._setStatus(BMAP_STATUS_SUCCESS)}this.localSearch._results=this._results;this.localSearch._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results)},gotoPage:function(cM){var T=this.localSearch._results;if(typeof cM=="number"&&!isNaN(cM)&&cM>=0&&cM<=T.getNumPages()-1){this.localSearch._ud.params.page_index=cM;this.searchRequest(this.localSearch._ud.params,this.localSearch._ud)}else{this.localSearch._setStatus(BMAP_STATUS_INVALID_REQUEST);this.localSearch._triggerCbk(w.CBK_SEARCH_COMPLETE)}}});function ar(T){a9.lang.Class.call(this);this.localSearch=T;this.map=T._opts.renderOptions.map;this._overlays=T._overlays;this.initialize()}a9.lang.inherits(ar,a9.lang.Class,"RenderMap");a9.extend(ar.prototype,{initialize:function(){this.addEventListener("render",this._render)},_render:function(){var cQ=this,cR=this.localSearch._results._pois,cP=[];for(var cO=0,T=cR.length;cO<T;cO++){var cS=cR[cO];cP.push(cS.point);var cN=this._addPoi(cS.point,cO,cS.title);if(!cN){continue}cS.marker=cN;(function(){var cT=cO;cN.addEventListener("click",function(){cQ.localSearch.select(cT)})})();this._overlays.push(cN)}var cM={};cM.points=cP;this._getBestViewport(cM);this.localSearch._triggerCbk(w.CBK_MARKERS_SET,cR)},addCenterPoi:function(cO){var T=cO;var cM=this;if(T&&typeof T!="string"&&!(T instanceof ce)){var cN=this.localSearch._centerMkr=ao.addCenterPoi(this.map,T.point,T.title);cN.addEventListener("click",function(){cM.localSearch.select(-1);cM.localSearch._curIndex="c";var cP=cM._createInfoWindowByPoi(cO);cN.openInfoWindow(cP)})}},_addPoi:function(cM,T,cN){if(this.localSearch._opts.pageCapacity<=a5.DEFAULT_PAGE_CAPACITY){return ao.addSearchPoi(this.map,cM,T,cN)}else{return ao.addSearchInBoundsPoi(this.map,cM,cN)}},select:function(cM){if(this.map&&cM>-1&&this._overlays[cM]){this.map.closeInfoWindow();var cO=this.localSearch._results.getPoi(cM);if(!cO){return}var T=this._createInfoWindowByPoi(cO);var cN=this._overlays[cM];cN.openInfoWindow(T)}},_createInfoWindowByPoi:function(cN){var T=ao.createSearchInfoWnd({title:cN.title,addr:cN.address,tel:cN.phoneNumber,url:cN.url,poiType:cN.type});var cM=this;T.addEventListener("close",function(){cM.localSearch.renderList.clearSelected()});T.addEventListener("open",function(){cM.localSearch._triggerCbk(w.CBK_INFO_HTML_SET,cN,ao.getInfoWindowDom(cM.map))});return T},_getBestViewport:function(cM){var T=this.localSearch._opts.renderOptions;if(this.map){var cQ=cM.points;var cO=!T.autoViewport,cP=!T.selectFirstResult&&T.autoViewport,cN=this.map.getViewport(cQ,{margins:[30,30,30,30]});if(!cO){this.map.setViewport(cN,{enableAnimation:cP})}}}});function Q(T){a9.lang.Class.call(this);this.localSearch=T;this.panel=T._opts.renderOptions.panel;this.initialize()}a9.lang.inherits(Q,a9.lang.Class,"RenderList");a9.extend(Q.prototype,{initialize:function(){this.addEventListener("render",this._render)},_render:function(){if(!this.panel){return}var cM=ab("div",{style:"font:12px "+cd.fontFamily+";border:1px solid #999;"}),cP=ab("div",{style:"background:#fff"}),cR=ab("ol",{style:"list-style:none;padding:0;margin:0"}),cO=this.localSearch.getStatus(),T=null;if(cO==BMAP_STATUS_SUCCESS){for(var cQ=0,cN=this.localSearch._results.getCurrentNumPois();cQ<cN;cQ++){var cT=this._createItem(cQ);cR.appendChild(cT)}}else{var cS="";switch(cO){case BMAP_STATUS_UNKNOWN_LOCATION:cS="\u62b1\u6b49\uff0c\u672a\u627e\u5230\u76f8\u5173\u5730\u70b9\u3002";break;case BMAP_STATUS_INVALID_KEY:cS="\u62b1\u6b49\uff0c\u60a8\u6240\u63d0\u4f9b\u7684key\u65e0\u6548\u3002";break}var cT=ab("li",{style:"margin:2px 0;padding:0 5px 0 3px;overflow:hidden;line-height:17px"});cT.innerHTML=cS;cR.appendChild(cT)}cP.appendChild(cR);cM.appendChild(cP);T=this._createResultsControl();cM.appendChild(T);this.panel.appendChild(cM);this.localSearch._triggerCbk(w.CBK_RESULTS_HTML_SET,cM)},_createItem:function(cO){var T=this.localSearch._results;if(!T||!T.getPoi(cO)){return}var cM=T.getPoi(cO),cV=ab("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});if(this.localSearch._curIndex>-1&&cO==this.localSearch._curIndex){cV.style.backgroundColor="#f0f0f0"}var cN=cO==0?cO+2+"px":"-"+(cO*20-2)+"px";if(this.localSearch._opts.pageCapacity>a5.DEFAULT_PAGE_CAPACITY){cN="-218px"}var cU=["<span style=\'background:url("+x+"bmap/red_labels.gif) 0 "+cN+" no-repeat;padding-left:10px;margin-right:3px\'>&nbsp;</span>"];var cT,cR;var cP=this.localSearch._results.keyword;var cS=new RegExp(cP,"ig");if(cM.title){cT=cM.title.replace(cS,"<b>$&</b>")}cU.push("<span style=\'color:#00c;text-decoration:underline\'>"+cT+"</span>");if(cM.address){cR=cM.address.replace(cS,"<b>$&</b>");cU.push("<span style=\'color:#666;\'> - "+cR+"</span>")}cV.innerHTML=cU.join("");var cQ=this;cV.onclick=function(){cQ.localSearch.select(cO)};return cV},_createResultsControl:function(){var cM=this,cN=ab("div",{style:"white-space:nowrap;text-align:right;background:#e5ecf9;margin-top:5px;padding:2px;overflow:hidden;zoom:1;"});var T=ab("div",{style:"float:left;margin-right:5px"});if(this.localSearch._results.getNumPages()>1){var cO=new aC(T,function(cP){cM.localSearch.gotoPage(cP-1)},{pageCount:cM.localSearch._results.getNumPages(),page:cM.localSearch._results.getPageIndex()+1,update:false})}cN.appendChild(T);return cN},clearSelected:function(){if(this.panel){if(typeof this.localSearch._curIndex=="number"&&this.localSearch._curIndex!=-1&&this.panel.getElementsByTagName("li")[this.localSearch._curIndex]){this.panel.getElementsByTagName("li")[this.localSearch._curIndex].style.backgroundColor=""}}this.localSearch._curIndex=-1},select:function(cM){if(this.panel){var T=this.localSearch._curIndex;if(typeof T=="number"&&T!=-1&&this.panel.getElementsByTagName("li")[T]){this.panel.getElementsByTagName("li")[T].style.backgroundColor=""}if(typeof cM=="number"&&cM!=-1&&this.panel.getElementsByTagName("li")[cM]){this.panel.getElementsByTagName("li")[cM].style.backgroundColor="#f0f0f0"}}}});');
﻿_jsload&&_jsload('route', 'function v(T){this.city=T.city;this._start=T.start;this._end=T.end;this._plans=T.plans;this.moreResultsUrl=T.url;this.taxiFare=T.taxiFare||null}a9.extend(v.prototype,{getStart:function(){return this._start},getEnd:function(){return this._end},getNumPlans:function(){return this._plans.length},getPlan:function(T){if(this._plans[T]){return this._plans[T]}}});function a8(T){v.call(this,T);this.policy=T.policy}a9.inherits(a8,v,"DrivingRouteResult");function bX(T){v.call(this,T)}a9.inherits(bX,v,"WalkingRouteResult");function C(T){v.call(this,T);this.policy=T.policy}a9.inherits(C,v,"TransitRouteResult");function l(T){this._routes=T.routes.slice(0);this._distance=T.distance||0;this._duration=T.duration||0;this._dragPois=T.dragPois||[]}a9.extend(l.prototype,{getRoute:function(T){if(this._routes[T]){return this._routes[T]}},getNumRoutes:function(){return this._routes.length},getDistance:function(T){if(T===false){return this._distance}else{return aW(this._distance)}},getDuration:function(T){if(T===false){return this._duration}else{return k(this._duration,"nav")}},getDragPois:function(){return this._dragPois}});function cl(T){l.call(this,T);this._lines=T.lines;this._description=T.description;this._duration=T.duration||0}a9.inherits(cl,l,"TransitRoutePlan");a9.extend(cl.prototype,{getNumLines:function(){return this._lines.length},getLine:function(T){if(this._lines[T]){return this._lines[T]}},getDescription:function(T){if(T===false){return U.removeHtml(this._description)}else{return this._description}},getDuration:function(T){if(T===false){return this._duration}else{return k(this._duration,"bustime")}}});function bM(T){this._steps=T.steps&&T.steps.slice(0)||[];this._distance=T.distance||0;this._index=T.index||0;this._points=T.points.slice(0);this._planIndex=T.planIndex||0;this._rt=T.rt;if(this._distance===0&&this._points.length>2){this._points.length=2}}a9.extend(bM.prototype,{getNumSteps:function(){return this._steps.length},getStep:function(T){if(this._steps[T]){return this._steps[T]}},getDistance:function(T){if(T===false){return this._distance}else{return aW(this._distance)}},getIndex:function(){return this._index},getPolyline:function(){return this._polyline},getPath:function(){return this._points},getRouteType:function(){return this._rt},getPlanIndex:function(){return this._planIndex}});function ch(T){this.title=T.title;this.uid=T.uid;this.type=T.type;this._stops=T.stops.slice(0);this._points=T.points.slice(0);this._distance=T.distance||0;this._numViaStops=T.numViaStops||0}a9.extend(ch.prototype,{getNumViaStops:function(){return this._numViaStops},getGetOnStop:function(){return this._stops[0]},getGetOffStop:function(){return this._stops[1]},getPath:function(){return this._points},getPolyline:function(){return this._polyline},getDistance:function(T){if(T===false){return this._distance}else{return aW(this._distance)}}});function aX(T){this._point=T.point;this._index=T.index;this._description=T.description;this._distance=T.distance||0;this._routeIndex=T.routeIndex||0;this._planIndex=T.planIndex||0}a9.extend(aX.prototype,{getPosition:function(){return this._point},getIndex:function(){return this._index},getDescription:function(T){if(T===false){return U.removeHtml(this._description)}else{return this._description}},getDistance:function(T){if(T===false){return this._distance}else{return aW(this._distance)}},getRouteIndex:function(){return this._routeIndex},getPlanIndex:function(){return this._planIndex}});b6._genTitle=function(cP,cQ,cO){var cM="border-bottom:1px solid #ccc";var T="-21px";if(cO===0){cM+=";border-top:1px solid #ccc";T="5px"}var cN=["<div style=\'"+cM+"\'><div style=\'cursor:pointer;background:url("];cN.push(x+"img/trans_icons.png) no-repeat 5px "+T+";padding:8px 0 8px 33px;line-height:15px\' ");cN.push("onclick=\'"+cQ+"\'><span style=\'white-space:nowrap\'>");cN.push(cP);cN.push("</span></div></div>");return cN.join("")};b6._genResultTitle=function(cN,cM,T){return\'<h1 style="margin:0;border-top:1px solid #ccc;\'+(T?"border-bottom:1px solid #ccc;padding:10px 0 10px 7px;":"padding:10px 0 9px 7px;")+"font:bold 16px "+cd.fontFamily+\'"> \'+cM+"\u524d\u5f80 "+cN+" \u7684\u8def\u7ebf</h1>"};a9.extend(b6.prototype,{search:function(cM,T){if(!cM||!T){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE);return false}return true},clearResults:function(){delete this._results;delete this._ud;delete this._json;delete this._boundsPoints;delete this._segPolylinePoints;var T=this._opts.renderOptions;this._setStatus();if(T.panel){T.panel.innerHTML=""}if(T.map){T.map.closeInfoWindow()}this._clearOverlays();this._curIndex=-1},_formatDestQuery:function(cM,cN){var T;cN=cN||{};if(typeof cM=="string"){T=[2,"","",cM,"",""]}else{if(cM instanceof BMap.Point){var cO=bb.convertLL2MC(cM);T=[1,"",cO.lng+","+cO.lat,(cN.wd||""),"",""]}else{var cO=bb.convertLL2MC(cM.point);T=[1,cM.uid,cO.lng+","+cO.lat,cM.title,"",""]}}return T.join("$$")}});var bp=0;var bq=1;function aW(T){if(typeof T=="string"){T=parseFloat(T)}var cM;if(!T||T<0){cM="0\u7c73"}else{if(T<=10){cM="10\u7c73"}else{cM=T<1000?Math.round(T/10)*10+"\u7c73":(T/1000).toFixed(1)+"\u516c\u91cc"}}if(cM=="1000\u7c73"){cM="1.0\u516c\u91cc"}return cM}function k(cT,cO){if(!cT||isNaN(cT)){return""}var T="",cM=60,cP=cM*24;var cN=Math.ceil(cT/cM);if(cO=="bustime"){var cS=cN%10,cQ=parseInt(cN/10);cN=cS!=0?(cS>5?(++cQ*10):cQ?(cQ*10):5):cN}var cU=parseInt(cN/cP);cN%=cP;var cR=parseInt(cN/cM);cN%=cM;if(cU>=1){T+=cU+"\u5929"}if(cR>=1){T+=cR+"\u5c0f\u65f6"}if(cN>=1){if(cO&&cO=="nav"&&cU>=1){return T}else{T+=cN+"\u5206\u949f"}}return T}function az(T){var cN=T.getSouthWest();var cM=T.getNorthEast();return[cN,cM]}a9.extend(aV.prototype,{_asyncSearch:function(){for(var cM=0,T=this._queryList.length;cM<T;cM++){var cN=this._queryList[cM];this[cN.method].apply(this,cN.arguments)}delete this._queryList},_internalSearch:function(cO,T){var cM=this;function cN(cR){var cP=cR.split("$$"),cQ=cP[0],cS=null;if(/[0-2]/.test(cQ)&&cP.length===7){cS=cP[+cQ+1]}return cS}this._getIdByLoc(this._loc,function(cS){var cQ={qt:cM.QUERY_TYPE,c:cS,sn:cO,en:T,sy:cM._opts.policy||0,ext:1};if(cQ.sy==BMAP_TRANSIT_POLICY_AVOID_SUBWAYS){cQ.f="[0,2,4,7,5,8,9,10,11]"}var cR=cN(cO),cP=cN(T);bc.request(function(cU,cT){cM._rawDataCbk(cU,cT)},cQ,{start:cR,end:cP})})},search:function(cN,T){if(b6.prototype.search.call(this,cN,T)==true){var cM=this;this._getIdByLoc(this._loc,function(cP){if(!cP){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE)}var cO;if((typeof cN=="object"&&typeof T=="string")||(typeof cN=="string"&&typeof T=="object")){if(typeof cN=="string"){cO={qt:aR,c:cP,isSingle:true,wd:cN,en:cM._formatDestQuery(T),sy:cM._opts.policy||0,ex:1}}else{if(typeof T=="string"){cO={qt:aR,c:cP,isSingle:true,wd:T,sn:cM._formatDestQuery(cN),sy:cM._opts.policy||0,ex:1}}}}else{cO={qt:cM.QUERY_TYPE,c:cP,sn:cM._formatDestQuery(cN),en:cM._formatDestQuery(T),sy:cM._opts.policy||0,ex:1}}if(cO.sy==BMAP_TRANSIT_POLICY_AVOID_SUBWAYS){cO.f="[0,2,4,7,5,8,9,10,11]"}bc.request(function(cR,cQ){cM._rawDataCbk(cR,cQ)},cO,{start:cN,end:T})})}},_rawDataCbk:function(cM,T){this.clearResults();this._json=cM;var cN=cM.result;this._ud=T;if(cN.error!=0||cN.type!=this.RETURN_TYPE||!cM.content){this._results=new C({city:cM.current_city.name,plans:[],policy:cN.sy});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results);return}this._processRaw();this._renderList();this._selectPlan(0)},_processRaw:function(){var cY=this._json.result;var dc=this._json.content;var c0=this._json.current_city;var cR={};var cP={};if(typeof this._ud.start=="object"&&!(this._ud.start instanceof BMap.Point)){a9.extend(cR,this._ud.start)}else{cR.title=cY.start.wd||"\u8d77\u70b9";cR.uid=cY.start.uid;cR.url=w._getPoiUrl(cR.uid,c0.code);cR.point=U.parseGeo(cY.start.pt,true).point;cR.city=c0.name}if(typeof this._ud.end=="object"&&!(this._ud.end instanceof BMap.Point)){a9.extend(cP,this._ud.end)}else{cP.title=cY.end.wd||"\u7ec8\u70b9";cP.uid=cY.end.uid;cP.url=w._getPoiUrl(cP.uid,c0.code);cP.point=U.parseGeo(cY.end.pt,true).point;cP.city=c0.name}var c9=[],cW=0;this._boundsPoints=[];for(var c6=0;c6<dc.length;c6++){if(cW>this._opts.pageCapacity-1){break}for(var cV=0,df=dc[c6].stops.length;cV<df;cV++){if(cW>this._opts.pageCapacity-1){break}this._boundsPoints[cW]=[];var cS=dc[c6].stops[cV];var cN=dc[c6].lines[cV];var c7=0;for(var c2=0,c3=cN.length;c2<c3;c2++){if(typeof cN[c2]=="object"){c7++}}var T=cN[c7+1],da=[],c5=[],c1=0,c8="";for(var c4=0;c4<cS.length-1;c4++){var cU=cS[c4].getOn;var cT={title:cU.name,uid:cU.uid,url:w._getPoiUrl(cU.uid,c0.code),city:c0.name,point:U.parseGeo(cU.geo,true).point};var de=cS[c4+1].getOff;var cO={title:de.name,uid:de.uid,url:w._getPoiUrl(de.uid,c0.code),city:c0.name,point:U.parseGeo(de.geo,true).point};var cM=[];if(c4==0){if(cS[c4].walk.distance>0){cM=U.parseGeo(cS[c4].walk.geo,true).points.concat(cT.point)}c5.push(new bM({distance:cS[c4].walk.distance,points:cM.slice(0),rt:BMAP_ROUTE_TYPE_WALKING,index:c4,planIndex:c6}))}else{if(cS[c4].walk.distance>0){var dd=U.parseGeo(cS[c4].getOff.geo,true).point;var db=U.parseGeo(cS[c4].getOn.geo,true).point;cM=([dd].concat(U.parseGeo(cS[c4].walk.geo,true).points)).concat(db)}c5.push(new bM({distance:cS[c4].walk.distance,points:cM.slice(0),rt:BMAP_ROUTE_TYPE_WALKING,index:c4,planIndex:c6}))}c1+=cS[c4].walk.distance;if(c4==cS.length-2){if(cS[c4+1].walk.distance>0){cM=[cO.point].concat(U.parseGeo(cS[c4+1].walk.geo,true).points)}c5.push(new bM({distance:cS[c4+1].walk.distance,points:cM.slice(0),rt:BMAP_ROUTE_TYPE_WALKING,index:c4+1,planIndex:c6}));c1+=cS[c4+1].walk.distance}var cX=U.parseGeo(cN[c4].geo,true);da.push(new ch({title:cN[c4].name,uid:cN[c4].uid,distance:cN[c4].distance,points:cX.points,stops:[cT,cO],type:this._getLineType(cN[c4].type),numViaStops:cN[c4].station_num}));var cZ=az(cX.bounds);this._boundsPoints[cW].push(cZ[0],cZ[1]);c1+=cN[c4].distance;if(cS[c4].walk.distance){c8+="<b>\u6b65\u884c</b>\u7ea6"+aW(cS[c4].walk.distance)+"\uff0c\u5230\u8fbe<b>"+cT.title+"</b>\uff0c"}c8+="\u4e58\u5750<b>"+this._shortTitle(cN[c4].name)+"</b>\uff0c\u7ecf\u8fc7"+cN[c4].station_num+"\u7ad9\uff0c\u5230\u8fbe<b>"+cO.title+"</b>";if(c4<cS.length-2){c8+="\uff0c"}else{if(cS[c4+1].walk.distance){c8+="\uff0c<b>\u6b65\u884c</b>\u7ea6"+aW(cS[c4+1].walk.distance)+"\uff0c\u5230\u8fbe<b>"+cS[c4+1].getOn.name+"</b>"}}}c9.push(new cl({routes:c5,distance:c1,duration:T,lines:da,description:c8}));cW++}}var cQ=cJ+"?s="+encodeURIComponent(this.QUERY_TYPE+"&c="+c0.code+"&sy="+cY.sy+"&sn="+this._formatDestQuery(this._ud.start)+"&en="+this._formatDestQuery(this._ud.end)+"&sq="+(this._ud.start.title?this._ud.start.title:this._ud.start)+"&eq="+(this._ud.end.title?this._ud.end.title:this._ud.end))+"&sr=1";if(this._ud.start instanceof ce&&this._ud.end instanceof ce){cQ=""}if((typeof this._ud.start=="object"&&typeof this._ud.end=="string")||(typeof this._ud.start=="string"&&typeof this._ud.end=="object")){cQ=""}this._results=new C({city:c0.name,plans:c9,start:cR,end:cP,url:cQ,policy:cY.sy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results)},_renderPlan:function(cO){var c2=this._opts.renderOptions.map;if(!c2){return}var cM=this._results.getPlan(cO);if(!cM){return}var cN=this._results.getStart();var c0=this._results.getEnd();var cX=ao.addDestPoi(c2,cN.point,cN.title,bp);cN.marker=cX;cX.addEventListener("click",function(){c4._select(0)});this._overlays.push(cX);var cV=ao.addDestPoi(c2,c0.point,c0.title,bq);c0.marker=cV;this._overlays.push(cV);cV.addEventListener("click",function(){c4._selectLast()});var cT=cN.point;var cZ=c0.point;this._boundsPoints[cO].push(cT,cZ);var T=[];var c4=this;for(var cY=0,cW=cM.getNumLines();cY<cW;cY++){var cR=cM.getLine(cY);var cU=ao.addLine(c2,cR.getPath());cR._polyline=cU;this._overlays.push(cU);var cQ=cR.getGetOnStop();T.push(cQ);var cS=ao.addTransPoi(c2,cQ.point,cR.type,cQ.title);cQ.marker=cS;this._overlays.push(cS);var c3=cR.getGetOffStop();T.push(c3);var cP=ao.addTransPoi(c2,c3.point,cR.type,c3.title);c3.marker=cP;(function(){var c5=cY;cS.addEventListener("click",function(){c4._select((c5+1)*2-1)});cP.addEventListener("click",function(){c4._select((c5+1)*2)})})();this._overlays.push(cP);var c1=cM.getRoute(cY);if(c1.getDistance(false)>0){cU=ao.addRoute(c2,c1.getPath(),c1.getRouteType());c1._polyline=cU;this._overlays.push(cU)}}var c1=cM.getRoute(cY);cU=ao.addRoute(c2,c1.getPath(),c1.getRouteType());c1._polyline=cU;this._overlays.push(cU);var c4=this;if(this._opts.renderOptions.autoViewport){c2.setViewport(this._boundsPoints[cO],{margins:[30,30,30,30]})}this._triggerCbk(w.CBK_POLYLINES_SET,cM._lines,cM._routes);this._triggerCbk(w.CBK_MARKERS_SET,[cN,c0],T)},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var cM=ab("div",{style:"font:12px "+cd.fontFamily+";background:#fff"});var cW=b6._genResultTitle(this._results.getEnd().title,"\u4e58\u516c\u5171\u4ea4\u901a\u5de5\u5177");var cQ=b6._genTitle(this._results.getStart().title,\'Instance("\'+this.guid+\'")._select(0)\',0);var cX=["<table style=\'font:12px "+cd.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];for(var cU=0,cR=this._results.getNumPlans();cU<cR;cU++){var cV=this._results.getPlan(cU),cP=cV.getDistance().replace(/(\d+(?:.\d+)?)/,"$1 "),T=cV.getDuration().replace(/(\d+)/,"$1 "),cT="";if(this._curIndex==cU){cT=";background:#f0f0f0"}var cO="border-bottom:1px solid #ccc;vertical-align:top;";cX.push(\'<tr style="cursor:pointer\'+cT+\'" onclick=\\\'Instance("\'+this.guid+\'")._selectPlan(\'+cU+")\'>");cX.push("<td style=\'"+cO+"width:20px;text-align:right;padding:4px 3px\' >"+(cU+1)+".</td>");cX.push("<td style=\'"+cO+"padding:2px;line-height:18px\' >"+cV.getDescription()+"</td>");cX.push("<td style=\'"+cO+"text-align:right;padding:4px 3px;white-space:nowrap\' >"+cP+" / "+T+"</td></tr>");cX.push("</tr>")}cX.push("</table>");var cN=b6._genTitle(this._results.getEnd().title,\'Instance("\'+this.guid+\'")._selectLast()\',1);var cS="<div style=\'border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'>";if(this._results.moreResultsUrl){cS+="<a style=\'color:#7777cc\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b&#187;</a>"}cS+="&nbsp;</div>";cM.innerHTML=cW+cQ+cX.join("")+cN+cS;this._opts.renderOptions.panel.appendChild(cM);this._triggerCbk(w.CBK_RESULTS_HTML_SET,cM)}},_select:function(cP){var cM=this._opts.renderOptions.map;if(cM){var cT=this._results.getPlan(this._curIndex);if(!cT){return}var cS=this;var cU=cT.getNumLines()*2;if(cP==0||cP==cU+1){var cR=cP===0?this._results.getStart():this._results.getEnd();var cN=ao.createTransInfoWnd({content:"<b>"+cR.title+"</b>",total:cU,curIndex:cP,nextTransCbk:function(cW){cS._select(cW)}});cN.addEventListener("open",function(){cS._triggerCbk(w.CBK_INFO_HTML_SET,cR,ao.getInfoWindowDom(cM))});var cQ=cP===0?0:1;this._overlays[cQ].openInfoWindow(cN)}else{var T=cT.getLine(Math.floor((cP+1)/2)-1);var cV;var cO;if(cP%2===1){cV=T.getGetOnStop();cO="<b>"+cV.title+"\u7ad9\u4e0a\u8f66</b>"}else{cV=T.getGetOffStop();cO="<b>"+cV.title+"\u7ad9\u4e0b\u8f66</b>"}var cN=ao.createTransInfoWnd({content:cO,total:cU,curIndex:cP,nextTransCbk:function(cW){cS._select(cW)}});cN.addEventListener("open",function(){cS._triggerCbk(w.CBK_INFO_HTML_SET,cV,ao.getInfoWindowDom(cM))});cV.marker.openInfoWindow(cN)}}},_selectLast:function(){if(this._results&&this._curIndex>-1){var cM=this._results.getPlan(this._curIndex);if(!cM){return}var T=cM.getNumLines()*2;this._select(T+1)}},_selectPlan:function(cM){if(!this._results&&!this._result.getPlan(cM)){return}var cP=this._results.getPlan(cM);var cO=this._opts.renderOptions.map;if(cO){cO.closeInfoWindow();this._clearOverlays();this._renderPlan(cM)}if(this._opts.renderOptions.panel){var cN=this._opts.renderOptions.panel.getElementsByTagName("table")[0];if(!cN){return}var T=cN.getElementsByTagName("tr");if(this._curIndex>=0&&T[this._curIndex]){T[this._curIndex].style.background=""}if(cM>=0&&T[cM]){T[cM].style.background="#f0f0f0"}}this._curIndex=cM},_clearOverlays:function(){for(var T=0;T<this._overlays.length;T++){if(this._overlays[T]._p){this._overlays[T]._p.remove();this._overlays[T]._p=null}this._overlays[T].remove();this._overlays[T]=null}this._overlays.length=0},_getLineType:function(T){return aV.LINE_TYPE_MAPPING[T]}});bm.MAX_THRESHOLD=20;bm.DRAG_REQ_FREQUENCE=50;bm.DRAG_MAXPOINTS=10;a9.extend(bm.prototype,{_d:{plys:[],viaPts:[],viaPtsInfo:[],dragOverlays:[],tipLbl:null,sliderMkr:null,dragReqFlag:false,cbkDragPt:null,cbkPly:null,isSearchByDrag:false,curDragPly:null,dragSrcCityCode:1,dragEndCityCode:1,cbkStartPoiName:"\u8d77\u70b9",cbkEndPoiName:"\u7ec8\u70b9",mouseOnViaMkr:false,cxtMenu:[]},_asyncSearch:function(){for(var cM=0,T=this._queryList.length;cM<T;cM++){var cN=this._queryList[cM];this[cN.method].apply(this,cN.arguments)}delete this._queryList},search:function(cN,T){this._d.isSearchByDrag=false;if(b6.prototype.search.call(this,cN,T)==true){var cM=this;this._getIdByLoc(this._loc,function(cQ){cQ=cQ||1;var cP;if((typeof cN=="object"&&typeof T=="string")||(typeof cN=="string"&&typeof T=="object")){if(typeof cN=="string"){cP={qt:e,c:cQ,isSingle:true,wd:cN,en:cM._formatDestQuery(T),sy:cM._opts.policy||0}}else{if(typeof T=="string"){cP={qt:e,c:cQ,isSingle:true,wd:T,sn:cM._formatDestQuery(cN),sy:cM._opts.policy||0}}}this.QUERY_TYPE=e}else{cP={qt:cM.QUERY_TYPE,c:cQ,sn:cM._formatDestQuery(cN),en:cM._formatDestQuery(T),sy:cM._opts.policy||0}}var cO={start:cN,end:T};bc.request(function(cS,cR){cM._rawDataCbk(cS,cR)},cP,cO)})}},_dragSearch:function(cN,T){var cM=this;cM._d.isSearchByDrag=true;cM._getIdByLoc(cM._loc,function(cP){cP=cP||1;var cT=bb.convertLL2MC(cM._d.viaPts[0]);var cO="1$$$$"+cT.lng+","+cT.lat+"$$$$";var cX=cM._d.dragSrcCityCode||cP;var cW="",cQ="";for(var cU=1,cR=cM._d.viaPts.length;cU<cR;cU++){var cV=bb.convertLL2MC(cM._d.viaPts[cU]);if(cU==cR-1){cW+="1$$$$"+cV.lng+","+cV.lat+"$$$$";cQ+=(cM._d.dragEndCityCode||cP)}else{cW+="1$$$$"+cV.lng+","+cV.lat+"$$$$+to:";cQ+="0 +to:"}}var cS={qt:cM.QUERY_TYPE,c:cP,drag:1,sc:cX,ec:cQ,sn:cO,en:cW,sy:cM._opts.policy||0};var cY={start:cN,end:T};a9.extend(cY,{useEncodeURI:true});bc.request(function(c0,cZ){cM._rawDataCbk(c0,cZ)},cS,cY)})},_rawDataCbk:function(cM,T){this.clearResults();this._json=cM;var cN=cM.result;this._ud=T;if(cN.error!=0||cN.type!=this.RETURN_TYPE){this._results=this._createResults({city:cM.current_city.name,plans:[],policy:cN.sy});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results);return}this._processRaw();this._renderMap();this._renderList()},_stopDragging:function(){var cO=this;if(cO._d.sliderMkr){cO._d.sliderMkr.disableDragging()}for(var cN=0,T=this._d.dragOverlays.length;cN<T;cN++){var cM=this._d.dragOverlays[cN];if(cM instanceof ae){cM.disableDragging()}}},_processRaw:function(){var dj=this._json.result;var dx=this._json.content;var df=this._json.current_city;var dn=dx.kps;var cM=dx.rss;var c4={};var c0={};if(typeof this._ud.start=="object"&&!(this._ud.start instanceof ce)){a9.extend(c4,this._ud.start)}else{c4.title=dj.start.wd||"\u8d77\u70b9";c4.uid=dj.start.uid;c4.url=w._getPoiUrl(c4.uid,dj.start_city.code);c4.point=U.parseGeo(dj.start.pt,true).point;c4.city=dj.start_city.cname}this._d.dragSrcCityCode=dj.start_city.code;if(typeof this._ud.end=="object"&&!(this._ud.end instanceof ce)){a9.extend(c0,this._ud.end)}else{var cP,cY;if(this._d.isSearchByDrag){cP=dj.end[dj.end.length-1];cY=dj.end_city[dj.end_city.length-1]}else{cP=dj.end[0];cY=dj.end_city[0]}this._d.dragEndCityCode=cY.code;c0.title=cP.wd||"\u7ec8\u70b9";c0.uid=cP.uid;if(c0.uid=="null"){c0.uid=""}c0.url=w._getPoiUrl(cP.uid,cY.code);c0.point=U.parseGeo(cP.pt,true).point;c0.city=cY.cname}var dg=[];var c9=[];var T=[];var c7=0;var di=[];this._segPolylinePoints=[];var cW=[],db=[],dq=[];var dk=0;this._d.viaPtsInfo.length=0;var dh=1;for(var dr=0,dp=dn.length-1;dr<dp;dr++){var c1=dn[dr];var cN=dn[dr+1];var dc=cM[dr];var dm=cM[dr-1]||{};var cZ=cM[dr+1];var cT=U.parseGeo(c1.pt,true).point;var dv=parseInt(dc.d);var cQ=U.parseGeo(dc.g,true);if(cQ){dq=dq.concat(cQ.points)}c7+=cZ.d;if(c1.rt==3){cW.push(cT);db.push(dq.slice(0));dq=[];dg.push(c9.slice(0));c9=[];T.push(c7);c7=0;var c2=dm.n||cZ.n||"\u672a\u77e5\u8def\u6bb5";var dy=dh;this._d.viaPtsInfo.push({title:c2,curNo:dh,point:cT});dh++}else{var cV=this._getDescription(c1,dc,cZ,dr,dp,dm,cN);var dw=c9.length;var dd=new aX({point:cT,index:dw,description:cV,distance:cZ.d});c9.push(dd);if(cQ){if(dr>1){this._segPolylinePoints[dk]=[di[di.length-1]].concat(cQ.points)}else{this._segPolylinePoints[dk]=cQ.points}di=di.concat(cQ.points)}dk++}}if(dq.length>0){db.push(dq)}if(c9.length>0){dg.push(c9)}if(c7>0){T.push(c7)}var du=[];for(var dr=0,dp=db.length;dr<dp;dr++){var dt=new bM({steps:dg[dr],distance:T[dr],index:dr,points:db[dr],rt:this.ROUTE_TYPE});du.push(dt)}var dl=dx.time;if(this.QUERY_TYPE==bw){dl=Math.round(dx.dis/1.35)}var da=new l({routes:du,distance:dx.dis,duration:dl,dragPois:this._d.viaPtsInfo});var cO="",cR={},ds=null,de=null,cX="string",c5="string",c6=this._opts.renderOptions.map;if(this._ud.start instanceof ce){cX="point"}if(this._ud.end instanceof ce){c5="point"}if(cX==="point"&&c5==="string"||cX==="string"&&c5==="point"){ds=e;de=c6.getBounds();a9.extend(cR,{c:df.code,isSingle:true,sy:dj.sy,newmap:1,nstep:1,ie:"utf-8",l:c6.getZoom()});if(cX==="string"){cR.wd=this._ud.start;cR.en=this._formatDestQuery(this._ud.end,{wd:"\u7ec8\u70b9"})}else{cR.wd=this._ud.end;cR.sn=this._formatDestQuery(this._ud.start,{wd:"\u8d77\u70b9"})}cR.tn=c6.getMapType()===BMAP_NORMAL_MAP?"B_NORMAL_MAP":"B_DIMENSIONAL_MAP"}else{ds=bN;cR.c=df.code;cR.sc=dj.start_city.code;cR.ec=dj.end_city[0].code;cR.sy=dj.sy;cR.sn=this._formatDestQuery(this._ud.start);cR.en=this._formatDestQuery(this._ud.end);cR.sq=this._ud.start.title?this._ud.start.title:this._ud.start;cR.eq=this._ud.end.title?this._ud.end.title:this._ud.end}if(ds!==null){cO=cJ+"?s="+encodeURIComponent(ds+"&"+P(cR))+"&sr=1"}this._results=this._createResults({city:df.name,plans:[da],start:c4,end:c0,url:cO,policy:dj.sy,taxiFare:this._getTaxiFare()});this._d.viaPts.length=0;this._d.plys.length=0;var c3=c4.point;this._d.viaPts.push(c3);for(var dr=0,dp=cW.length;dr<dp;dr++){var cU=cW[dr];this._d.viaPts.push(cU)}var c8=c0.point;this._d.viaPts.push(c8);for(var dr=0,dp=db.length;dr<dp;dr++){var cS=db[dr];cS.stNo=dr;cS.edNo=dr+1;this._d.plys.push(cS)}this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results)},_getAllStepCount:function(){var cO=0;var cP=this._results.getPlan(0);for(var cN=0,T=cP.getNumRoutes();cN<T;cN++){var cM=cP.getRoute(cN);cO+=cM.getNumSteps()}return cO},_getCurStep:function(cQ){var cP=0;var cR=this._results.getPlan(0);for(var cO=0,cM=cR.getNumRoutes();cO<cM;cO++){var cT=cR.getRoute(cO);for(var cN=0,cS=cT.getNumSteps();cN<cS;cN++){var T=cT.getStep(cN);if(cP==cQ){return T}cP++}}},_getDescription:function(cR,cQ,c0,cX,cW,cN,c4){var cP="";var cV=parseInt(cQ.d);var cS=cQ.poi;if(cS){cV=cV-cS.pd}var cZ=aW(cV);var cM=this._getRoadName(cN.t,cN.n);var cO=this._getRoadName(cQ.t,cQ.n);var c3=this._getRoadName(cQ.t,c0.n);var cT=this._getDwType(cR.dw)||"";var cU=cR.dr?(cT+"<b>"+cR.dr+"</b>\uff0c"):"";if(c4.rt==3){cU+="\u5230\u8fbe<b>"+this._getRetType(c4.rt)+"</b>\uff0c"}var c1=((cO!=""&&cM==cO)?"\u7ee7\u7eed":"")+this._getRoadAct(cQ.t,cQ.n);var T=this._getPoiInfo(cQ);var cY=this._getTicInfo(cR);var c2=(cO==c3)?"":(this._getRetAct(c0.t,c0.n)+"<b>"+c3+"</b>");cP=c1+"<b>"+cO+"</b>"+this._getRetType(cR.rt)+cZ+"\uff0c"+T+cY+cU;if(cX==0){cP="\u4ece<b>\u8d77\u70b9</b>\u5411"+this._getTurnType(cR.ett||cR.tt)+"\u51fa\u53d1"}else{if(cX>0&&cX<cW-1){cP=cP+"<b>"+this._getTurnType(cR.ett||cR.tt)+"</b>"+c2}else{cP=cP+"\u5230\u8fbe<b>\u7ec8\u70b9</b>"}}return cP},_isInThreshold:function(cR,cM,cQ){if(cM&&cQ&&cQ.length>0){for(var cP=0,T=cQ.length;cP<T;cP++){var cO=cQ[cP];var cN=cR.pointToPixel(cO);if(ao.getDistanceByPixel(cM,cN)<=bm.MAX_THRESHOLD){return true}}}return false},_renderMap:function(){var T=this._opts.renderOptions.map;if(T&&this._results){this._renderViaMkr();this._renderPly()}},_renderPly:function(){var cM=this._opts.renderOptions.map;var cT=this._results.getPlan(0);var cV=cT.getRoute(0);var T=this._results.getStart();var cR=this._results.getEnd();var cS=this;var cP=this._d.viaPts.length;var cU=[];for(var cO=0,cN=this._d.plys.length;cO<cN;cO++){var cX=this._d.plys[cO];var cQ=ao.addRoute(cM,cX,cV.getRouteType());cT._routes[cO]._polyline=cQ;cQ.stNo=cX.stNo;cQ.edNo=cX.edNo;var cW=cQ.getBounds();cU.push(cW.getSouthWest());cU.push(cW.getNorthEast());if(this._enableDragging){if(cP<bm.DRAG_MAXPOINTS+2){cQ.addEventListener("mousemove",function(cY){if(cS._d.mouseOnViaMkr){if(cS._d.sliderMkr){cS._d.sliderMkr.hide()}return}cS._d.curDragPly=this;if(cS._d.sliderMkr){if(cS._isInThreshold(cM,cY.pixel,cS._d.viaPts)){cS._d.sliderMkr.hide()}else{cS._d.sliderMkr.show();cS._d.sliderMkr.setPosition(cY.point);cS._d.tipLbl.setContent("\u62d6\u52a8\u4ee5\u66f4\u6539\u8def\u7ebf");cS._d.tipLbl.show();cS._d.sliderMkr.setLabel(cS._d.tipLbl)}}else{cS._d.sliderMkr=ao.addDragMkr(cM,cY.point);cS._d.sliderMkr.enableDragging();cS._d.sliderMkr.addEventListener("dragging",function(c0){var c1=cS._d.curDragPly.stNo;var cZ=cS._d.curDragPly.edNo;cS._requestDragging(this,cM,c1,cZ)});cS._d.sliderMkr.addEventListener("dragend",function(c1){var c0=cS._d.cbkDragPt;var cZ=cS._d.curDragPly.edNo;cS._d.viaPts.splice(cZ,0,c0);this.setPosition(c0);cS._stopDragging();cS._dragSearch(T,cR)});if(!cS._d.tipLbl){cS._d.tipLbl=ao.createTipLbl("\u62d6\u52a8\u4ee5\u66f4\u6539\u8def\u7ebf")}cM.addOverlay(cS._d.sliderMkr)}});cQ.addEventListener("mouseout",function(cY){if(cS._d.sliderMkr){cS._d.sliderMkr.hide()}})}}cS._d.dragOverlays.push(cQ)}if(this._opts.renderOptions.autoViewport){cM.setViewport(cU,{margins:[30,30,30,30]})}this._triggerCbk(w.CBK_POLYLINES_SET,cT._routes)},_renderViaMkr:function(){var cM=this._opts.renderOptions.map;var cV=this._results.getPlan(0);var T=this._results.getStart();var cT=this._results.getEnd();var cU=this;for(var cR=0,cN=this._d.viaPts.length;cR<cN;cR++){var cS=this._d.viaPts[cR];var cP;if(cR==0){cP=ao.addDestPoi(cM,cS,T.title,bp);T.marker=cP;cP.addEventListener("click",function(){cU._select(0)});this._overlays.push(cP)}else{if(cR==this._d.viaPts.length-1){cP=ao.addDestPoi(cM,cS,cT.title,bq);cT.marker=cP;cP.addEventListener("click",function(){cU._select(cU._getAllStepCount()+1)});this._overlays.push(cP)}else{cP=ao.addDragMkr(cM,cS);this._d.viaPtsInfo[cR-1].marker=cP;var cQ=new cA();cQ.addItem(new bf("\u5220\u9664\u8be5\u70b9",function(cY,cX,cW){cU._delVia(cW.curNo)},{width:60}));cP.addContextMenu(cQ);cU._d.cxtMenu.push(cQ)}}cP.curNo=cR;if(this._enableDragging){cP.enableDragging();cP.addEventListener("mouseover",function(cW){cU._d.mouseOnViaMkr=true;if(cU._d.tipLbl){cU._d.tipLbl.setContent("\u62d6\u52a8\u4ee5\u66f4\u6539\u8def\u7ebf");cU._d.tipLbl.show();this.setLabel(cU._d.tipLbl)}else{cU._d.tipLbl=ao.createTipLbl("\u62d6\u52a8\u4ee5\u66f4\u6539\u8def\u7ebf");this.setLabel(cU._d.tipLbl)}});cP.addEventListener("mouseout",function(cW){this.getLabel().hide();cU._d.mouseOnViaMkr=false});cP.addEventListener("dragging",function(cW){cU._requestDragging(this,cM)});cP.addEventListener("dragend",function(cX){var cW=cU._d.cbkDragPt;var cY=this.curNo;cU._d.viaPts[cY]=cW;this.setPosition(cW);var c0=cU._d.viaPts[0];var cZ=cU._d.viaPts[cU._d.viaPts.length-1];if(cY==0){T.point=c0;T.title=cU._d.cbkStartPoiName}if(cY==cU._d.viaPts.length-1){cT.point=cZ;cT.title=cU._d.cbkEndPoiName}cU._stopDragging();cU._dragSearch(T,cT)})}cU._d.dragOverlays.push(cP)}var cO=[T];cO=cO.concat(this._d.viaPtsInfo);cO=cO.concat([cT]);this._triggerCbk(w.CBK_MARKERS_SET,cO)},_requestDragging:function(cS,cM,cO,cT){var cV=this;if(cV._d.dragReqFlag==true){return}cV._d.dragReqFlag=true;window.setTimeout(function(){cV._d.dragReqFlag=false},bm.DRAG_REQ_FREQUENCE);var cQ;var cW=bb.convertLL2MC(cS.getPosition());var T=cM.getZoom();var cU=cS.curNo;if(typeof cO!="undefiend"&&typeof cT!="undefined"){var cP=cV._d.viaPts[cO];cP=bb.convertLL2MC(cP);var cR=cV._d.viaPts[cT];cR=bb.convertLL2MC(cR);cQ={qt:cj,pt:cW.lng+","+cW.lat,sn:cP.lng+","+cP.lat,en:cR.lng+","+cR.lat,r:5000,st:1,et:1,sy:0,l:T}}else{if(cU==0){var cR=cV._d.viaPts[cU+1];cR=bb.convertLL2MC(cR);cQ={qt:cj,pt:cW.lng+","+cW.lat,sn:"",en:cR.lng+","+cR.lat,r:5000,st:1,et:1,sy:0,l:T}}else{if(cU==this._d.viaPts.length-1){var cP=cV._d.viaPts[cU-1];cP=bb.convertLL2MC(cP);cQ={qt:cj,pt:cW.lng+","+cW.lat,sn:cP.lng+","+cP.lat,en:"",r:5000,st:1,et:1,sy:0,l:T}}else{var cP=cV._d.viaPts[cU-1];cP=bb.convertLL2MC(cP);var cR=cV._d.viaPts[cU+1];cR=bb.convertLL2MC(cR);cQ={qt:cj,pt:cW.lng+","+cW.lat,sn:cP.lng+","+cP.lat,en:cR.lng+","+cR.lat,r:5000,st:1,et:1,sy:0,l:T}}}}var cN={curDragMkr:cS,map:cM,stNo:cO,edNo:cT};bc.request(function(cY,cX){cV._requestDraggingCbk(cY,cX)},cQ,cN)},_requestDraggingCbk:function(cX,cN){var cT=this;if(cX&&cX.content){cT._d.cbkDragPt=U.parseGeo(cX.content.dragpt,true).point;var cW;var cM=cN.map;var cP=cN.stNo;var cR=cN.edNo;var cQ=cN.curDragMkr;var cS=cQ.curNo;if(typeof cP!="undefiend"&&typeof cR!="undefined"){cW=U.parseGeoExt(cX.content.geo).points}else{if(cS==0){cW=U.parseGeo(cX.content.geo,true).points;cT._d.cbkStartPoiName=cX.content.name?cX.content.name:"\u8d77\u70b9"}else{if(cS==cT._d.viaPts.length-1){cW=U.parseGeo(cX.content.geo,true).points;cT._d.cbkEndPoiName=cX.content.name?cX.content.name:"\u7ec8\u70b9"}else{cW=U.parseGeoExt(cX.content.geo).points}}}if(cW){cT._clearOldLine(cS,cM,cP,cR);if(cT._d.cbkPly){cT._d.cbkPly.setPath(cW)}else{var cU=cT._results.getPlan(0);var cV=cU.getRoute(0);cT._d.cbkPly=ao.addRoute(cM,cW,cV.getRouteType())}}var T=cX.content.name?cX.content.name:"\u672a\u77e5\u8def\u6bb5";var cO="("+aW(cX.content.dis)+")";cT._d.tipLbl.show();cT._d.tipLbl.setContent(T+cO)}},_clearOldLine:function(cQ,cR,cP,cM){for(var cO=0,T=this._d.dragOverlays.length;cO<T;cO++){var cN=this._d.dragOverlays[cO];if(cN instanceof f){if(typeof cP!="undefiend"&&typeof cM!="undefined"){if(cN.stNo==cP&&cN.edNo==cM){cR.removeOverlay(cN);break}}else{if(cN.stNo==cQ||cN.edNo==cQ){cR.removeOverlay(cN)}}}}if(this._hlRoute){this._hlRoute.hide()}},_select:function(cN){var cR=this._curIndex;var cP=this._opts.renderOptions;if(cP.panel){var cQ=cP.panel.getElementsByTagName("table");var cW=cQ[cQ.length-1];var cT=cW.getElementsByTagName("tr");if(cR-1>=0&&cT[cR-1]){cT[cR-1].style.background=""}if(cN-1>=0&&cT[cN-1]){cT[cN-1].style.background="#f0f0f0"}}var c0=cP.map;if(c0){var T=this._results.getPlan(0);var cY=T.getRoute(0);var c2=this._getAllStepCount();var c1=this;c0.closeInfoWindow();if(cN==0||cN==c2+1){var cX=cN===0?this._results.getStart():this._results.getEnd();var cM=ao.createTransInfoWnd({content:"<b>"+cX.title+"</b>",total:c2,curIndex:cN,nextTransCbk:function(c3){c1._select(c3)},hideStep:(cP.highlightMode==BMAP_HIGHLIGHT_STEP?false:true)});cM.addEventListener("open",function(){c1._triggerCbk(w.CBK_INFO_HTML_SET,cX,ao.getInfoWindowDom(c0))});cM.addEventListener("close",function(){if(c1._opts.renderOptions.panel){var c4=cP.panel.getElementsByTagName("table");var c5=c4[c4.length-1];if(c5){var c3=c5.getElementsByTagName("tr");if(c1._curIndex-1>=0&&c3[c1._curIndex-1]){c3[c1._curIndex-1].style.background=""}}}c1._curIndex=-1});var cZ=cN===0?0:1;this._overlays[cZ].openInfoWindow(cM);if(this._hlRoute){this._hlRoute.hide()}}else{var cV=cP.highlightMode;if(cV==BMAP_HIGHLIGHT_STEP){var cO=this._getCurStep(cN-1);var cM=ao.createTransInfoWnd({content:cO.getDescription(),total:c2,curIndex:cN,nextTransCbk:function(c3){c1._select(c3)}});cM.addEventListener("open",function(){c1._triggerCbk(w.CBK_INFO_HTML_SET,cO,ao.getInfoWindowDom(c0))});cM.addEventListener("close",function(){if(c1._opts.renderOptions.panel){var c4=cP.panel.getElementsByTagName("table");var c5=c4[c4.length-1];if(c5){var c3=c5.getElementsByTagName("tr");if(c1._curIndex-1>=0&&c3[c1._curIndex-1]){c3[c1._curIndex-1].style.background=""}}}c1._curIndex=-1});var cU=cO.getPosition();c0.openInfoWindow(cM,cU)}else{if(cV==BMAP_HIGHLIGHT_ROUTE){if(cN==1){var cO=this._getCurStep(0);c0.setCenter(cO.getPosition());if(cP.autoViewport){c0.setZoom(17)}if(this._hlRoute){this._hlRoute.hide()}}else{if(this._segPolylinePoints[cN-1]){if(!this._hlRoute){this._hlRoute=ao.addRoute(c0,this._segPolylinePoints[cN-1],cY.getRouteType()+2)}else{this._hlRoute.setPath(this._segPolylinePoints[cN-1]);this._hlRoute.show()}if(cP.autoViewport){var cS=c0.getViewport(this._hlRoute.getBounds());if(cS.zoom>17){cS.zoom=17}c0.setViewport(cS)}}}}}}}this._curIndex=cN},_clearOverlays:function(){var cN=this._opts.renderOptions.map;if(!cN){return}for(var cM=0,T=this._overlays.length;cM<T;cM++){cN.removeOverlay(this._overlays[cM]);this._overlays[cM]=null}this._overlays.length=0;cN.removeOverlay(this._hlRoute);this._hlRoute=null;if(this._d.sliderMkr){cN.removeOverlay(this._d.sliderMkr);this._d.sliderMkr=null}if(this._d.tipLbl){cN.removeOverlay(this._d.tipLbl);this._d.tipLbl=null}for(var cM=0,T=this._d.dragOverlays.length;cM<T;cM++){cN.removeOverlay(this._d.dragOverlays[cM]);this._d.dragOverlays[cM]=null}this._d.dragOverlays.length=0;if(this._d.cbkPly){cN.removeOverlay(this._d.cbkPly);this._d.cbkPly=null}for(var cM=0,T=this._d.cxtMenu.length;cM<T;cM++){cN.removeContextMenu(this._d.cxtMenu[cM]);this._d.cxtMenu[cM]=null}this._d.cxtMenu.length=0;this._d.mouseOnViaMkr=false},_delVia:function(cN){if(this._results){var cM=this._results.getStart();var T=this._results.getEnd();this._d.viaPts.splice(cN,1);this._stopDragging();this._dragSearch(cM,T)}},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var cO=this._results.getPlan(0);var cV=ab("div",{style:"font:12px "+cd.fontFamily+";background:#fff"});var cN=this._d.viaPtsInfo;var T=cN.length;var cR=[];var cY=this.QUERY_TYPE===bN;var c2=b6._genResultTitle(this._results.getEnd().title,(cY?"\u9a7e\u8f66":"\u6b65\u884c"),T>0);if(T>0){cR.push("<table style=\'margin-left:4px;font:12px "+cd.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>");for(var cZ=0;cZ<T;cZ++){cR.push("<tr>");if(cZ==0){if(T==1){cR.push(\'<td style="padding:2px 5px;line-height:18px">\u9014\u7ecf\u70b9</td>\')}else{cR.push(\'<td valign="top" rowspan="\'+T+\'" style="padding:2px 5px;line-height:18px">\u9014\u7ecf\u70b9</td>\')}}cR.push(\'<td style="padding:2px 5px;line-height:18px">\'+cN[cZ].title+"</td>");cR.push(\'<td style="padding:2px 10px;line-height:18px;cursor:pointer;color:#0000ff" onclick=\\\'Instance("\'+this.guid+\'")._delVia(\'+cN[cZ].curNo+")\'>\u5220\u9664</td>");cR.push("</tr>")}cR.push("</table>")}var c0=b6._genTitle(this._results.getStart().title,\'Instance("\'+this.guid+\'")._select(0)\',0);var cS=["<table style=\'font:12px "+cd.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];var cX=0;for(var cU=0,cQ=cO.getNumRoutes();cU<cQ;cU++){var c1=cO.getRoute(cU);for(var cZ=0,cW=c1.getNumSteps();cZ<cW;cZ++){var cP="";if(this._curIndex==cX+1){cP=";background:#f0f0f0"}cS.push(\'<tr style="cursor:pointer\'+cP+\'" onclick=\\\'Instance("\'+this.guid+\'")._select(\'+(cX+1)+")\'>");cS.push("<td style=\'border-bottom:1px solid #ccc;width:20px;vertical-align:top;text-align:right;padding:4px 3px\' >"+(cX+1)+".</td>");cS.push("<td style=\'border-bottom:1px solid #ccc;padding:2px;line-height:18px\' >"+this._getCurStep(cX).getDescription()+"</td>");cS.push("</tr>");cX++}}cS.push("</table>");var cM=b6._genTitle(this._results.getEnd().title,\'Instance("\'+this.guid+\'")._select(\'+(cX+1)+")",1);var cT="<div style=\'border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'><span style=\'float:left;padding-left:6px\'>\u5168\u7a0b\uff1a"+cO.getDistance().replace(/(\d+(?:.\d+)?)/,"$1 ")+" / "+cO.getDuration().replace(/(\d+)/,"$1 ")+"</span>";if(this._results.moreResultsUrl){cT+="<a style=\'color:#7777cc\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b&#187;</a>"}cT+="&nbsp;</div>";cV.innerHTML=c2+cR.join("")+c0+cS.join("")+cM+cT;this._opts.renderOptions.panel.appendChild(cV);this._triggerCbk(w.CBK_RESULTS_HTML_SET,cV)}},_getRoadName:function(cM,T){if(T==""||!T){if(cM==9||cM==12||cM==1||cM==16){T=bm.ROAD_TYPE[cM]}}return T},_getPoiInfo:function(cQ){var T="";var cP=cQ.poi;if(cP){var cO=this._getPsType(cP.ps)||"",cM=this._getPwType(cP.pw)||"";var cN=cP.pd<((cQ.t==13||cQ.t==4)?1000:50)?"":"\u7ea6"+aW(cP.pd)+"\u540e";T=cM+cO+"<b>"+cP.pn+"</b>"+cN+(cO==""?"":"\uff0c")}return T},_getTicInfo:function(cM){var T=cM.iw;return !cM.ic?"":((this._getIwGo(T)||"")+"<b>"+cM.ic+"</b>"+(this._getIwTo(T)||""))},_getRoadAct:function(cN,cM){var T="\u6cbf";if(cN==0||(!cM&&cN!=1&&cN!=16&&cN!=9&&cN!=12)){T=""}return T},_getRetAct:function(cN,cM){var T="\u8fdb\u5165";if(!cM&&(cN==9||cN==12)){T="\u4e0a"}else{if(cN==0||(!cM&&cN!=1&&cN!=16)){T=""}}return T},_getTaxiFare:function(){if(this._json&&this._json.content&&this._json.content.taxi){var cO=this._json.content.taxi;var T={distance:cO.dis,remark:cO.remark};if(cO.detail[0]){var cN=cO.detail[0];T.day={initialFare:parseFloat(cN.startPrice),unitFare:parseFloat(cN.kmPrice),totalFare:parseFloat(cN.totalPrice)}}if(cO.detail[1]){var cM=cO.detail[1];T.night={initialFare:parseFloat(cM.startPrice),unitFare:parseFloat(cM.kmPrice),totalFare:parseFloat(cM.totalPrice)}}return T}return null}});q.TURN_TYPE=["","\u76f4\u884c","\u53f3\u524d\u65b9\u8f6c\u5f2f","\u53f3\u8f6c","\u53f3\u540e\u65b9\u8f6c\u5f2f","\u8c03\u5934","\u5de6\u540e\u65b9\u8f6c\u5f2f","\u5de6\u8f6c","\u5de6\u524d\u65b9\u8f6c\u5f2f","\u7a0d\u5411\u5de6\u8f6c","\u76f4\u884c","\u7a0d\u5411\u53f3\u8f6c","\u6b63\u5317\u65b9\u5411","\u4e1c\u5317\u65b9\u5411","\u6b63\u4e1c\u65b9\u5411","\u4e1c\u5357\u65b9\u5411","\u6b63\u5357\u65b9\u5411","\u897f\u5357\u65b9\u5411","\u6b63\u897f\u65b9\u5411","\u897f\u5317\u65b9\u5411"];q.RET_TYPE=["","\u4ece\u8d77\u70b9\u51fa\u53d1","\u5230\u8fbe\u76ee\u7684\u5730","\u9014\u7ecf\u70b9","\u884c\u9a76"];q.IWGO=["\u5728","\u4ece","\u4ece"];q.IWTO=["","","\u79bb\u5f00"];q.PWTYPE=["\u8fc7","\u5728"];q.PSTYPE=["\u5de6\u4fa7\u7684","\u53f3\u4fa7\u7684",""];q.DWTYPE=["","\u671d"];a9.extend(q.prototype,{_createResults:function(T){return new a8(T)},_getTurnType:function(T){return q.TURN_TYPE[T]},_getRetType:function(T){return q.RET_TYPE[T]},_getIwGo:function(T){return q.IWGO[T]},_getIwTo:function(T){return q.IWTO[T]},_getPwType:function(T){return q.PWTYPE[T]},_getPsType:function(T){return q.PSTYPE[T]},_getDwType:function(T){return q.DWTYPE[T]}});cE.TURN_TYPE=["","\u76f4\u8d70","\u5411\u53f3\u524d\u65b9\u8f6c","\u53f3\u8f6c","\u5411\u53f3\u540e\u65b9\u8f6c","\u5411\u540e\u8f6c","\u5411\u5de6\u540e\u65b9\u8f6c","\u5de6\u8f6c","\u5411\u5de6\u524d\u65b9\u8f6c","\u5de6\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u7ee7\u7eed\u5411\u524d","\u53f3\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u7ee7\u7eed\u5411\u524d","\u5de6\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u5f80\u56de\u8d70","\u53f3\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u5f80\u56de\u8d70","\u6b63\u5317\u65b9\u5411","\u4e1c\u5317\u65b9\u5411","\u6b63\u4e1c\u65b9\u5411","\u4e1c\u5357\u65b9\u5411","\u6b63\u5357\u65b9\u5411","\u897f\u5357\u65b9\u5411","\u6b63\u897f\u65b9\u5411","\u897f\u5317\u65b9\u5411","","","",""];cE.RET_TYPE=["","\u4ece\u8d77\u70b9\u51fa\u53d1","\u5230\u8fbe\u76ee\u7684\u5730","\u9014\u7ecf\u70b9","\u8d70"];cE.IWGO=["\u5728","\u4ece","\u4ece"];cE.IWTO=["","","\u79bb\u5f00"];cE.PWTYPE=["\u8fc7","\u5728"];cE.PSTYPE=["\u5de6\u4fa7\u7684","\u53f3\u4fa7\u7684",""];cE.DWTYPE=["","\u671d"];a9.extend(cE.prototype,{_createResults:function(T){delete T.url;return new bX(T)},_getTurnType:function(T){return cE.TURN_TYPE[T]},_getRetType:function(T){return cE.RET_TYPE[T]},_getIwGo:function(T){return cE.IWGO[T]},_getIwTo:function(T){return cE.IWTO[T]},_getPwType:function(T){return cE.PWTYPE[T]},_getPsType:function(T){return cE.PSTYPE[T]},_getDwType:function(T){return cE.DWTYPE[T]}});');
﻿_jsload&&_jsload('othersearch', 'a9.extend(aY.prototype,{_asyncSearch:function(){for(var cM=0,T=this._queryList.length;cM<T;cM++){var cN=this._queryList[cM];this[cN.method].apply(this,cN.arguments)}delete this._queryList},getPoint:function(T,cP,cO){var cN=this;cO=cO||"\u5317\u4eac\u5e02";var cM=/^[ \s]*$/;if(cM.test(T)){return}bc.request(function(cU){if(cU&&cU.result&&cU.result.type==br){var cS=cU.result,cV=cU.content,cR=null,cT=null;if(cS){if(cS.error==0){var cQ=cV.coord.x,cW=cV.coord.y;cR=new BMap.Point(cQ,cW);cR=bb.convertMC2LL(cR);cN.point=cR;cN.city=cV.cn;cN.citycode=cV.sc;cN.address=cV.wd;cN.precise=cV.prc;cN.confidence=cV.fuzzy_score;cN.level=cV.catalog;cT={city:cV.cn,address:cV.wd,citycode:cV.sc,precise:cV.prc,confidence:cV.fuzzy_score,level:cV.catalog}}}cP&&cP(cR,cT)}},{qt:bB,wd:T,cn:cO})},getLocation:function(cM,cS,cP){if(!(cM instanceof ce)&&cS){cS(null);return}var cO=this,cM=bb.convertLL2MC(cM),T=cM.lng,cR=cM.lat,cP=cP||{},cN=cP.poiRadius||100,cQ=cP.numPois||10;bc.request(function(c9){var cW=null;if(c9&&c9.result&&c9.result.type==bD){var cZ=c9.result,c6=c9.content,cY,c0={},c1=[],c3;if(cZ.error==0){var da=c6.address_detail,c7=da.city;if(da){c0.streetNumber=da.street_number;c0.street=da.street;c0.district=da.district;c0.city=c7;c0.province=da.province}c3=c6.point;var c5=new BMap.Point(c3.x,c3.y);c5=bb.convertMC2LL(c5);var cV=c6.surround_poi;if(cV&&cV.length){for(var c8=0,c4=cV.length;c8<c4;c8++){var cU={},cX=cV[c8];cU.title=cX.name;cU.uid=cX.uid;var c2=new BMap.Point(cX.point.x,cX.point.y);c2=bb.convertMC2LL(c2);cU.point=c2;cU.city=c7;cU._poiType=cX.poiType;cU.type=BMAP_POI_TYPE_NORMAL;cU.address=cX.addr;cU.postcode=cX.zip||null;cU.phoneNumber=cX.tel||null;var cT=cU._poiType;if(cT.length!==0){cU.tags=cT.split(",")}c1.push(cU)}}cW={point:c5,address:c6.address,addressComponents:c0,surroundingPois:c1,business:c6.business}}}cS&&cS(cW)},{qt:d,x:T,y:cR,dis_poi:cN,poi_num:cQ})}});a9.extend(al.prototype,{_asyncSearch:function(){for(var cM=0,T=this._queryList.length;cM<T;cM++){var cN=this._queryList[cM];this[cN.method].apply(this,cN.arguments)}delete this._queryList},getCurrentPosition:function(cN,cM){this._callback=cN||function(){};if(!navigator.geolocation){this._onErrorCallback(BMAP_STATUS_SERVICE_UNAVAILABLE);return}var T=this;navigator.geolocation.getCurrentPosition(function(cO){T._onSuccessCallback(cO)},function(cO){T._onErrorCallback(cO.code+5)},cM)},_onSuccessCallback:function(T){var cO=T.coords,cN=this,cM={x:cO.longitude,y:cO.latitude,from:"0",to:"4"};bc.request(function(cR){var cQ=(cR&&cR.error==0)?new BMap.Point(cR.x,cR.y):new BMap.Point(cO.longitude,cO.latitude);cN._status=BMAP_STATUS_SUCCESS;var cP={point:cQ,accuracy:cO.accuracy};cN._callback(cP)},cM,null,"ag/coord/convert")},_onErrorCallback:function(T){this._status=T;this._callback(null)}});a9.extend(ca.prototype,{_asyncSearch:function(){for(var cM=0,T=this._queryList.length;cM<T;cM++){var cN=this._queryList[cM];this[cN.method].apply(this,cN.arguments)}delete this._queryList},get:function(cM){var T=this;bc.request(function(cQ){if(cQ&&cQ.result&&cQ.result.type==s){var cO=cQ.result,cS=cQ.content;if(cO){if(cO.error==0){var cT=T._opts.renderOptions.map;var cU=cS.level;var cP=cS.cname;var cR=cS.code;var cN=U.parseGeo(cS.geo,true).point;cU=U.getBestLevel(cU,cT);if(cT){cT.centerAndZoom(cN,cU)}}}cM&&cM({center:cN,level:cU,name:cP,code:cR})}},{qt:V})}});a9.extend(W.prototype,{_asyncSearch:function(){for(var cM=0,T=this._queryList.length;cM<T;cM++){var cN=this._queryList[cM];this[cN.method].apply(this,cN.arguments)}delete this._queryList},get:function(cM,T){var cN={};cN.boundaries=[];var cO=this;bc.request(function(cP){if(cP&&cP.content&&cP.content.uid){var cQ=cP.content.uid;bc.request(function(cZ){if(cZ&&cZ.content&&cZ.content.geo){if(cM.indexOf("\u798f\u5efa")>-1||cM.indexOf("\u6d59\u6c5f")>-1){var c0=cO._parseGeoSpecial(cZ.content.geo);cN.boundaries=c0}else{var cT=U.parseGeo(cZ.content.geo,false);if(cT.geo&&cT.geo.length&&cT.geo.length>0){var cR=cT.geo.length;for(i=0;i<cR;i++){var cS=cT.geo[i];if(cS&&cS.length&&cS.length>0){var cX=cS.length-1;var cV=[];for(var cU=0;cU<cX;cU+=2){var cY=cS[cU];var cW=cS[cU+1];var c1=new BMap.Point(cY,cW);c1=bb.convertMC2LL(c1);cV.push(c1.lng+", "+c1.lat)}cN.boundaries.push(cV.join(";"))}}}}}T&&T(cN)},{qt:b5,num:1000,l:10,uid:cQ})}else{T&&T(cN)}},{qt:ck,wd:cM})},_parseGeoSpecial:function(cQ){var cT=this;var cN=[];if(typeof(cQ)!="string"){return cN}var cM=cQ.split("|");var cX=cM[2];var cP=cX.split(";");for(var cR=0;cR<cP.length-1;cR++){var cW=cP[cR];var cS=[];var T=cW.split(",");for(var cO=0;cO<T.length;cO+=2){var cV=T[cO];var cU=T[cO+1];var cY=new BMap.Point(cV,cU);cY=bb.convertMC2LL(cY);cS.push(cY.lng+", "+cY.lat)}cN.push(cS.join(";"))}return cN}});');
﻿_jsload&&_jsload('autocomplete', 'a9.dom.getComputedStyle=function(cM,T){cM=a9.dom._g(cM);var cO=a9.dom.getDocument(cM),cN;if(cO.defaultView&&cO.defaultView.getComputedStyle){cN=cO.defaultView.getComputedStyle(cM,null);if(cN){return cN[T]||cN.getPropertyValue(T)}}return""};a9.dom.remove=function(T){T=a9.dom._g(T);var cM=T.parentNode;cM&&cM.removeChild(T)};a9.lang.isArray=function(T){return"[object Array]"==Object.prototype.toString.call(T)};a9.event=a9.event||{};a9.event.stopPropagation=function(T){if(T.stopPropagation){T.stopPropagation()}else{T.cancelBubble=true}};a9.event.preventDefault=function(T){if(T.preventDefault){T.preventDefault()}else{T.returnValue=false}};a9.event.stop=function(T){var cM=a9.event;cM.stopPropagation(T);cM.preventDefault(T)};a9.array.indexOf=function(cP,cM,cO){var T=cP.length,cN=cM;cO=cO|0;if(cO<0){cO=Math.max(0,T+cO)}for(;cO<T;cO++){if(cO in cP&&cP[cO]===cM){return cO}}return -1};a9.array.contains=function(T,cM){return(a9.array.indexOf(T,cM)>=0)};a9.ui=a9.ui||{version:"1.3.9"};a9.ui.getUI=function(cN){var cN=cN.split("-"),cM=a9.ui,T=cN.length,cO=0;for(;cO<T;cO++){cM=cM[cN[cO].charAt(0).toUpperCase()+cN[cO].slice(1)]}return cM};a9.ui.create=function(cM,T){if(a9.lang.isString(cM)){cM=a9.ui.getUI(cM)}return new cM(T)};a9.event._listeners=a9.event._listeners||[];a9.event.on=function(cM,cP,cR){cP=cP.replace(/^on/i,"");cM=a9.dom._g(cM);var cQ=function(cT){cR.call(cM,cT)},T=a9.event._listeners,cO=a9.event._eventFilter,cS,cN=cP;cP=cP.toLowerCase();if(cO&&cO[cP]){cS=cO[cP](cM,cP,cQ);cN=cS.type;cQ=cS.listener}if(cM.addEventListener){cM.addEventListener(cN,cQ,false)}else{if(cM.attachEvent){cM.attachEvent("on"+cN,cQ)}}T[T.length]=[cM,cP,cR,cQ,cN];return cM};a9.on=a9.event.on;a9.event.un=function(cN,cQ,cM){cN=a9.dom._g(cN);cQ=cQ.replace(/^on/i,"").toLowerCase();var cT=a9.event._listeners,cO=cT.length,cP=!cM,cS,cR,T;while(cO--){cS=cT[cO];if(cS[1]===cQ&&cS[0]===cN&&(cP||cS[2]===cM)){cR=cS[4];T=cS[3];if(cN.removeEventListener){cN.removeEventListener(cR,T,false)}else{if(cN.detachEvent){cN.detachEvent("on"+cR,T)}}cT.splice(cO,1)}}return cN};a9.un=a9.event.un;a9.ui.Base={id:"",getId:function(T){var cN=this,cM;cM="tangram-"+cN.uiType+"--"+(cN.id?cN.id:cN.guid);return T?cM+"-"+T:cM},getClass:function(cM){var cO=this,cN=cO.classPrefix,T=cO.skin;if(cM){cN+="-"+cM;T+="-"+cM}if(cO.skin){cN+=" "+T}return cN},getMain:function(){return a9.g(this.mainId)},getBody:function(){return a9.g(this.getId())},uiType:"",getCallRef:function(){return"window[\'$BAIDU$\']._instances[\'"+this.guid+"\']"},getCallString:function(cO){var cN=0,cM=Array.prototype.slice.call(arguments,1),T=cM.length;for(;cN<T;cN++){if(typeof cM[cN]=="string"){cM[cN]="\'"+cM[cN]+"\'"}}return this.getCallRef()+"."+cO+"("+cM.join(",")+");"},on:function(T,cM,cN){a9.on(T,cM,cN);this.addEventListener("ondispose",function(){a9.un(T,cM,cN)})},renderMain:function(cM){var cO=this,cN=0,T;if(cO.getMain()){return}cM=a9.g(cM);if(!cM){cM=document.createElement("div");document.body.appendChild(cM);cM.style.position="absolute";cM.className=cO.getClass("main")}if(!cM.id){cM.id=cO.getId("main")}cO.mainId=cM.id;cM.setAttribute("data-guid",cO.guid);return cM},dispose:function(){this.dispatchEvent("dispose");a9.lang.Class.prototype.dispose.call(this)}};a9.ui.createUI=function(cN,cT){cT=cT||{};var cR=cT.superClass||a9.lang.Class,cQ=cR==a9.lang.Class?1:0,cO,cM,cS=function(cV,cU){var cW=this;cV=cV||{};cR.call(cW,!cQ?cV:(cV.guid||""),true);a9.object.extend(cW,cS.options);a9.object.extend(cW,cV);cW.classPrefix=cW.classPrefix||"tangram-"+cW.uiType.toLowerCase();for(cO in a9.ui.behavior){if(typeof cW[cO]!="undefined"&&cW[cO]){a9.object.extend(cW,a9.ui.behavior[cO]);if(a9.lang.isFunction(cW[cO])){cW.addEventListener("onload",function(){a9.ui.behavior[cO].call(cW[cO].apply(cW))})}else{a9.ui.behavior[cO].call(cW)}}}cN.apply(cW,arguments);for(cO=0,cM=cS._addons.length;cO<cM;cO++){cS._addons[cO](cW)}if(cV.parent&&cW.setParent){cW.setParent(cV.parent)}if(!cU&&cV.autoRender){cW.render(cV.element)}},T=function(){};T.prototype=cR.prototype;var cP=cS.prototype=new T();for(cO in a9.ui.Base){cP[cO]=a9.ui.Base[cO]}cS.extend=function(cU){for(cO in cU){cS.prototype[cO]=cU[cO]}return cS};cS._addons=[];cS.register=function(cU){if(typeof cU=="function"){cS._addons.push(cU)}};cS.options={};return cS};a9.dom.getAttr=function(cM,T){cM=a9.dom.g(cM);if("style"==T){return cM.style.cssText}T=a9.dom._NAME_ATTRS[T]||T;return cM.getAttribute(T)};a9.getAttr=a9.dom.getAttr;a9.ui.get=function(T){var cM;if(a9.lang.isString(T)){return a9.lang.instance(T)}else{do{if(!T||T.nodeType==9){return null}if(cM=a9.dom.getAttr(T,"data-guid")){return a9.lang.instance(cM)}}while((T=T.parentNode)!=document.body)}};a9.ui.Suggestion=a9.ui.createUI(function(T){var cM=this;cM.addEventListener("onload",function(){cM.on(document,"mousedown",cM.documentMousedownHandler);cM.on(window,"blur",cM.windowBlurHandler)});cM.documentMousedownHandler=cM._getDocumentMousedownHandler();cM.windowBlurHandler=cM._getWindowBlurHandler();cM.enableIndex=[];cM.currentIndex=-1}).extend({uiType:"suggestion",onbeforepick:new Function,onpick:new Function,onconfirm:new Function,onhighlight:new Function,onshow:new Function,onhide:new Function,getData:function(){return[]},prependHTML:"",appendHTML:"",currentData:{},tplDOM:"<div id=\'#{0}\' class=\'#{1}\' style=\'position:relative; top:0px; left:0px\'></div>",tplPrependAppend:"<div id=\'#{0}\' class=\'#{1}\'>#{2}</div>",tplBody:\'<table cellspacing="0" cellpadding="2"><tbody>#{0}</tbody></table>\',tplRow:\'<tr><td id="#{0}" onmouseover="#{2}" onmouseout="#{3}" onmousedown="#{4}" onclick="#{5}" class="#{6}">#{1}</td></tr>\',getString:function(){var T=this;return a9.format(T.tplDOM,T.getId(),T.getClass(),T.guid)},render:function(cN){var cM=this,T,cN=a9.g(cN);if(cM.getMain()||!cN){return}if(cN.id){cM.targetId=cN.id}else{cM.targetId=cN.id=cM.getId("input")}T=cM.renderMain();T.style.display="none";T.innerHTML=cM.getString();this.dispatchEvent("onload")},_isShowing:function(){var cM=this,T=cM.getMain();return T&&T.style.display!="none"},pick:function(T){var cO=this,cM=cO.currentData,cP=cM&&typeof T=="number"&&typeof cM[T]!="undefined"?cM[T].value:T,cN={data:{item:cP==T?{value:T,content:T}:cM[T],index:T}};if(cO.dispatchEvent("onbeforepick",cN)){cO.dispatchEvent("onpick",cN)}},show:function(cQ,cP,cN){var cM=0,T=cP.length,cO=this;cO.enableIndex=[];cO.currentIndex=-1;if(T==0&&!cN){cO.hide()}else{cO.currentData=[];for(;cM<T;cM++){if(typeof cP[cM].value!="undefined"){cO.currentData.push(cP[cM])}else{cO.currentData.push({value:cP[cM],content:cP[cM]})}if(typeof cP[cM]["disable"]=="undefined"||cP[cM]["disable"]==false){cO.enableIndex.push(cM)}}cO.getBody().innerHTML=cO._getBodyString();cO.getMain().style.display="block";cO.dispatchEvent("onshow")}},hide:function(){var cP=this;if(!cP._isShowing()){return}if(cP.currentIndex>=0&&cP.holdHighLight){var cO=cP.currentData,cM=-1;for(var cN=0,T=cO.length;cN<T;cN++){if(typeof cO[cN].disable=="undefined"||cO[cN].disable==false){cM++;if(cM==cP.currentIndex){cP.pick(cN)}}}}cP.getMain().style.display="none";cP.dispatchEvent("onhide")},highLight:function(T){var cN=this,cO=cN.enableIndex,cM=null;if(!cN._isEnable(T)){return}cN.currentIndex>=0&&cN._clearHighLight();cM=cN._getItem(T);a9.addClass(cM,cN.getClass("current"));cN.currentIndex=a9.array.indexOf(cO,T);cN.dispatchEvent("onhighlight",{index:T,data:cN.getDataByIndex(T)})},clearHighLight:function(){var cN=this,T=cN.currentIndex,cM=cN.enableIndex[T];cN._clearHighLight()&&cN.dispatchEvent("onclearhighlight",{index:cM,data:cN.getDataByIndex(cM)})},_clearHighLight:function(){var cN=this,T=cN.currentIndex,cO=cN.enableIndex,cM=null;if(T>=0){cM=cN._getItem(cO[T]);a9.removeClass(cM,cN.getClass("current"));cN.currentIndex=-1;return true}return false},confirm:function(T,cN){var cM=this;if(cN!="keyboard"){if(!cM._isEnable(T)){return}}cM.pick(T);cM.dispatchEvent("onconfirm",{data:cM.getDataByIndex(T)||T,source:cN});cM.currentIndex=-1;cM.hide()},getDataByIndex:function(T){return{item:this.currentData[T],index:T}},getTargetValue:function(){return this.getTarget().value},getTarget:function(){return a9.g(this.targetId)},_getItem:function(T){return a9.g(this.getId("item"+T))},_getBodyString:function(){var cQ=this,cP="",cO=[],cR=cQ.currentData,T=cR.length,cN=0;function cM(cS){return a9.format(cQ.tplPrependAppend,cQ.getId(cS),cQ.getClass(cS),cQ[cS+"HTML"])}cP+=cM("prepend");for(;cN<T;cN++){cO.push(a9.format(cQ.tplRow,cQ.getId("item"+cN),cR[cN].content,cQ.getCallRef()+"._itemOver(event, "+cN+")",cQ.getCallRef()+"._itemOut(event, "+cN+")",cQ.getCallRef()+"._itemDown(event, "+cN+")",cQ.getCallRef()+"._itemClick(event, "+cN+")",(typeof cR[cN]["disable"]=="undefined"||cR[cN]["disable"]==false)?"":cQ.getClass("disable")))}cP+=a9.format(cQ.tplBody,cO.join(""));cP+=cM("append");return cP},_itemOver:function(cN,T){var cM=this;a9.event.stop(cN||window.event);cM._isEnable(T)&&cM.highLight(T);cM.dispatchEvent("onmouseoveritem",{index:T,data:cM.getDataByIndex(T)})},_itemOut:function(cN,T){var cM=this;a9.event.stop(cN||window.event);if(!cM.holdHighLight){cM._isEnable(T)&&cM.clearHighLight()}cM.dispatchEvent("onmouseoutitem",{index:T,data:cM.getDataByIndex(T)})},_itemDown:function(cN,T){var cM=this;a9.event.stop(cN||window.event);cM.dispatchEvent("onmousedownitem",{index:T,data:cM.getDataByIndex(T)})},_itemClick:function(cN,T){var cM=this;a9.event.stop(cN||window.event);cM.dispatchEvent("onitemclick",{index:T,data:cM.getDataByIndex(T)});cM._isEnable(T)&&cM.confirm(T,"mouse")},_isEnable:function(T){var cM=this;return a9.array.contains(cM.enableIndex,T)},_getDocumentMousedownHandler:function(){var T=this;return function(cO){cO=cO||window.event;var cM=cO.target||cO.srcElement,cN=a9.ui.get(cM);if(cM==T.getTarget()||(cN&&cN.uiType==T.uiType)){return}T.hide()}},_getWindowBlurHandler:function(){var T=this;return function(){T.hide()}},dispose:function(){var T=this;T.dispatchEvent("dispose");a9.dom.remove(T.mainId);a9.lang.Class.prototype.dispose.call(this)}});a9.ui.behavior=a9.ui.behavior||{};a9.dom.children=function(cM){cM=a9.dom.g(cM);for(var T=[],cN=cM.firstChild;cN;cN=cN.nextSibling){if(cN.nodeType==1){T.push(cN)}}return T};a9.dom.insertBefore=function(cO,cN){var cM,T;cM=a9.dom._g;cO=cM(cO);cN=cM(cN);T=cN.parentNode;if(T){T.insertBefore(cO,cN)}return cO};a9.dom.setStyle=function(cN,cM,cO){var cP=a9.dom,T;cN=cP.g(cN);cM=a9.string.toCamelCase(cM);if(T=cP._styleFilter){cO=T.filter(cM,cO,"set")}T=cP._styleFixer[cM];(T&&T.set)?T.set(cN,cO):(cN.style[T||cM]=cO);return cN};a9.setStyle=a9.dom.setStyle;a9.dom.setStyles=function(cM,cN){cM=a9.dom.g(cM);for(var T in cN){a9.dom.setStyle(cM,T,cN[T])}return cM};a9.setStyles=a9.dom.setStyles;a9.dom._styleFilter[a9.dom._styleFilter.length]={set:function(T,cM){if(cM.constructor==Number&&!/zIndex|fontWeight|opacity|zoom|lineHeight/i.test(T)){cM=cM+"px"}return cM}};a9.dom.setBorderBoxSize=function(cN,cM){var T={};cM.width&&(T.width=parseFloat(cM.width));cM.height&&(T.height=parseFloat(cM.height));function cO(cQ,cP){return parseFloat(a9.getStyle(cQ,cP))||0}if(a9.browser.isStrict){if(cM.width){T.width=parseFloat(cM.width)-cO(cN,"paddingLeft")-cO(cN,"paddingRight")-cO(cN,"borderLeftWidth")-cO(cN,"borderRightWidth");T.width<0&&(T.width=0)}if(cM.height){T.height=parseFloat(cM.height)-cO(cN,"paddingTop")-cO(cN,"paddingBottom")-cO(cN,"borderTopWidth")-cO(cN,"borderBottomWidth");T.height<0&&(T.height=0)}}return a9.dom.setStyles(cN,T)};(function(){var T=a9.ui.behavior.coverable=function(){};T.Coverable_isShowing=false;T.Coverable_iframe;T.Coverable_container;T.Coverable_iframeContainer;T.Coverable_show=function(){var cS=this;if(cS.Coverable_iframe){cS.Coverable_update();a9.setStyle(cS.Coverable_iframe,"display","block");return}var cQ=cS.coverableOptions||{},cN=cS.Coverable_container=cQ.container||cS.getMain(),cP=cQ.opacity||"0",cO=cQ.color||"",cR=cS.Coverable_iframe=document.createElement("iframe"),cM=cS.Coverable_iframeContainer=document.createElement("div");a9.dom.children(cN).length>0?a9.dom.insertBefore(cM,cN.firstChild):cN.appendChild(cM);a9.setStyles(cM,{position:"absolute",top:"0px",left:"0px"});a9.dom.setBorderBoxSize(cM,{width:cN.offsetWidth,height:cN.offsetHeight});a9.dom.setBorderBoxSize(cR,{width:cM.offsetWidth});a9.dom.setStyles(cR,{zIndex:-1,display:"block",border:0,backgroundColor:cO,filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity="+cP+")"});cM.appendChild(cR);cR.src="javascript:void(0)";cR.frameBorder="0";cR.scrolling="no";cR.height="97%";cS.Coverable_isShowing=true};T.Coverable_hide=function(){var cN=this,cM=cN.Coverable_iframe;if(!cN.Coverable_isShowing){return}a9.setStyle(cM,"display","none");cN.Coverable_isShowing=false};T.Coverable_update=function(cO){var cQ=this,cO=cO||{},cN=cQ.Coverable_container,cM=cQ.Coverable_iframeContainer,cP=cQ.Coverable_iframe;a9.dom.setBorderBoxSize(cM,{width:cN.offsetWidth,height:cN.offsetHeight});a9.dom.setBorderBoxSize(cP,a9.extend({width:a9.getStyle(cM,"width")},cO))}})();a9.extend(a9.ui.Suggestion.prototype,{coverable:true,coverableOptions:{}});a9.ui.Suggestion.register(function(T){if(T.coverable){T.addEventListener("onshow",function(){T.Coverable_show()});T.addEventListener("onhide",function(){T.Coverable_hide()})}});a9.ui.Suggestion.extend({setData:function(cO,cN,cM){var T=this;T.dataCache[cO]=cN;if(!cM){T.show(cO,T.dataCache[cO])}}});a9.ui.Suggestion.register(function(T){T.dataCache={},T.addEventListener("onneeddata",function(cN,cO){var cM=T.dataCache;if(typeof cM[cO]=="undefined"){T.getData(cO)}else{T.show(cO,cM[cO])}})});a9.dom.setOuterWidth=a9.dom.setBorderBoxWidth=function(T,cM){return a9.dom.setBorderBoxSize(T,{width:cM})};a9.dom.getWindow=function(T){T=a9.dom.g(T);var cM=a9.dom.getDocument(T);return cM.parentWindow||cM.defaultView||null};a9.dom.setPosition=function(cM,T){return a9.dom.setStyles(cM,{left:T.left-(parseFloat(a9.dom.getStyle(cM,"margin-left"))||0),top:T.top-(parseFloat(a9.dom.getStyle(cM,"margin-top"))||0)})};a9.page=a9.page||{};a9.page.getViewWidth=function(){var cM=document,T=cM.compatMode=="BackCompat"?cM.body:cM.documentElement;return T.clientWidth};a9.page.getViewHeight=function(){var cM=document,T=cM.compatMode=="BackCompat"?cM.body:cM.documentElement;return T.clientHeight};a9.page.getScrollTop=function(){var T=document;return window.pageYOffset||T.documentElement.scrollTop||T.body.scrollTop};a9.page.getScrollLeft=function(){var T=document;return window.pageXOffset||T.documentElement.scrollLeft||T.body.scrollLeft};a9.fn=a9.fn||{};a9.fn.bind=function(cM,T){var cN=arguments.length>2?[].slice.call(arguments,2):null;return function(){var cP=a9.lang.isString(cM)?T[cM]:cM,cO=(cN)?cN.concat([].slice.call(arguments,0)):arguments;return cP.apply(T||cP,cO)}};(function(){var cM=a9.ui.behavior.posable=function(){};cM.setPosition=function(cR,cP,cO){cP=a9.g(cP)||this.getMain();cO=cO||{};var cQ=this,cN=[cP,cR,cO];cQ.__execPosFn(cP,"_positionByCoordinate",cO.once,cN)};cM._positionByCoordinate=function(cN,c2,c3,cP){c2=c2||[0,0];c3=c3||{};var cZ=this,c0={},cX=a9.page.getViewHeight(),c1=a9.page.getViewWidth(),cT=a9.page.getScrollLeft(),cR=a9.page.getScrollTop(),cQ=cN.offsetWidth,cS=cN.offsetHeight,cO=cN.offsetParent,cY=(!cO||cO==document.body)?{left:0,top:0}:a9.dom.getPosition(cO);c3.position=(typeof c3.position!=="undefined")?c3.position.toLowerCase():"bottomright";c2=T(c2||[0,0]);c3.offset=T(c3.offset||[0,0]);c2.x+=(c3.position.indexOf("right")>=0?(c2.width||0):0);c2.y+=(c3.position.indexOf("bottom")>=0?(c2.height||0):0);c0.left=c2.x+c3.offset.x-cY.left;c0.top=c2.y+c3.offset.y-cY.top;switch(c3.insideScreen){case"surround":c0.left+=c0.left<cT?cQ+(c2.width||0):((c0.left+cQ)>(cT+c1)?-cQ-(c2.width||0):0);c0.top+=c0.top<cR?cS+(c2.height||0):((c0.top+cS)>(cR+cX)?-cS-(c2.height||0):0);break;case"fix":c0.left=Math.max(0-parseFloat(a9.dom.getStyle(cN,"marginLeft"))||0,Math.min(c0.left,a9.page.getViewWidth()-cQ-cY.left));c0.top=Math.max(0-parseFloat(a9.dom.getStyle(cN,"marginTop"))||0,Math.min(c0.top,a9.page.getViewHeight()-cS-cY.top));break;case"verge":var cV={width:(c3.position.indexOf("right")>-1?c2.width:0),height:(c3.position.indexOf("bottom")>-1?c2.height:0)},cU={width:(c3.position.indexOf("bottom")>-1?c2.width:0),height:(c3.position.indexOf("right")>-1?c2.height:0)};c0.left-=(c3.position.indexOf("right")>=0?(c2.width||0):0);c0.top-=(c3.position.indexOf("bottom")>=0?(c2.height||0):0);c0.left+=c0.left+cV.width+cQ-cT>c1-cY.left?cU.width-cQ:cV.width;c0.top+=c0.top+cV.height+cS-cR>cX-cY.top?cU.height-cS:cV.height;break}a9.dom.setPosition(cN,c0);if(!cP&&(cX!=a9.page.getViewHeight()||c1!=a9.page.getViewWidth())){cZ._positionByCoordinate(cN,c2,{},true)}cP||cZ.dispatchEvent("onpositionupdate")};cM.__execPosFn=function(cO,cR,cP,cN){var cQ=this;if(typeof cP=="undefined"||!cP){a9.event.on(a9.dom.getWindow(cO),"resize",a9.fn.bind.apply(cQ,[cR,cQ].concat([].slice.call(cN))))}cQ[cR].apply(cQ,cN)};function T(cN){cN.x=cN[0]||cN.x||cN.left||0;cN.y=cN[1]||cN.y||cN.top||0;return cN}})();a9.ui.Suggestion.extend({posable:true,fixWidth:true,getWindowResizeHandler:function(){var T=this;return function(){T.adjustPosition(true)}},adjustPosition:function(cM){var cO=this,cP=cO.getTarget(),cN,T=cO.getMain(),cQ;if(!cO._isShowing()&&cM){return}cN=a9.dom.getPosition(cP),cQ={top:(cN.top+cP.offsetHeight-1),left:cN.left,width:cP.offsetWidth};cQ=typeof cO.view=="function"?cO.view(cQ):cQ;cO.setPosition([cQ.left,cQ.top],null,{once:true});a9.dom.setOuterWidth(T,cQ.width)}});a9.ui.Suggestion.register(function(T){T.windowResizeHandler=T.getWindowResizeHandler();T.addEventListener("onload",function(){T.adjustPosition();if(T.fixWidth){T.fixWidthTimer=setInterval(function(){var cM=T.getMain(),cN=T.getTarget();if(cM.offsetWidth!=0&&cN&&cN.offsetWidth!=cM.offsetWidth){T.adjustPosition();cM.style.display="block"}},100)}T.on(window,"resize",T.windowResizeHandler)});T.addEventListener("onshow",function(){T.adjustPosition()});T.addEventListener("ondispose",function(){clearInterval(T.fixWidthTimer)})});a9.ui.Suggestion.register(function(cP){var cS,cN="",cR,cO,cM=false,cQ=false;function T(){setTimeout(function(){cR=cP.getTarget().value},20)}cP.addEventListener("onload",function(){cS=this.getTarget();T();cP.on(window,"onload",T);cP.targetKeydownHandler=cP.getTargetKeydownHandler();cP.on(cS,"keydown",cP.targetKeydownHandler);cS.setAttribute("autocomplete","off");cP.circleTimer=setInterval(function(){if(cQ){return}if(a9.g(cS)==null){cP.dispose()}var cT=cS.value;if(cT==cN&&cT!=""&&cT!=cR&&cT!=cO){if(cP.requestTimer==0){cP.requestTimer=setTimeout(function(){cP.dispatchEvent("onneeddata",cT)},100)}}else{clearTimeout(cP.requestTimer);cP.requestTimer=0;if(cT==""&&cN!=""){cO="";cP.hide()}cN=cT;if(cT!=cO){cP.defaultIptValue=cT}if(cR!=cS.value){cR=""}}},10);cP.on(cS,"beforedeactivate",cP.beforedeactivateHandler)});cP.addEventListener("onitemclick",function(){cQ=false;cP.defaultIptValue=cN=cP.getTargetValue()});cP.addEventListener("onpick",function(cT){if(cM){cS.blur()}cS.value=cO=cT.data.item.value;if(cM){cS.focus()}});cP.addEventListener("onmousedownitem",function(cT){cM=true;cQ=true;setTimeout(function(){cQ=false;cM=false},500)});cP.addEventListener("ondispose",function(){clearInterval(cP.circleTimer)})});a9.ui.Suggestion.extend({beforedeactivateHandler:function(){return function(){if(mousedownView){window.event.cancelBubble=true;window.event.returnValue=false}}},getTargetKeydownHandler:function(){var cM=this;function T(cN){if(!cM._isShowing()){cM.dispatchEvent("onneeddata",cM.getTargetValue());return}var cP=cM.enableIndex,cO=cM.currentIndex;if(cP.length==0){return}if(cN){switch(cO){case -1:cO=cP.length-1;cM.pick(cP[cO]);cM.highLight(cP[cO]);break;case 0:cO=-1;cM.pick(cM.defaultIptValue);cM.clearHighLight();break;default:cO--;cM.pick(cP[cO]);cM.highLight(cP[cO]);break}}else{switch(cO){case -1:cO=0;cM.pick(cP[cO]);cM.highLight(cP[cO]);break;case cP.length-1:cO=-1;cM.pick(cM.defaultIptValue);cM.clearHighLight();break;default:cO++;cM.pick(cP[cO]);cM.highLight(cP[cO]);break}}cM.currentIndex=cO}return function(cP){var cN=false,cO;cP=cP||window.event;switch(cP.keyCode){case 9:case 27:cM.hide();break;case 13:a9.event.stop(cP);cM.confirm(cM.currentIndex==-1?cM.getTarget().value:cM.enableIndex[cM.currentIndex],"keyboard");break;case 38:cN=true;case 40:a9.event.stop(cP);T(cN);break;default:cM.currentIndex=-1}}},defaultIptValue:""});b3.undope=true;bz.IS_INCLUDE_STYLE=false;bz.STYLE_FILE_PATH=x+"res/12/bmap_autocomplete.css";bz.TYPES_COLLECTION={ALL:"0",CITY:"1"};a9.extend(bz.prototype,{_asyncSearch:function(){this._initialize()},_initialize:function(){this._exIndex=-1;this._json=null;this._typeIds=[];this._cityId=0;this._results=this._getAutocompleteResult();if(!!this._options.input){this._getStyles();this._renderSuggestion();this.setInputValue(this._inputValue)}var T=null;if(!!this._word){T={};T.method="search";T.arguments=[this._word]}this._getTypesId();this._getCityId(T)},_renderSuggestion:function(){var cM=this;var T=new a9.ui.Suggestion({getData:function(cN){cM._sendAutocompleteRequest(cN)},onhide:function(){cM._exIndex=-1;if(cM._suggestion.getTargetValue()===""){cM._word="";cM._results=cM._getAutocompleteResult()}},onhighlight:function(cN){if(!cM._json){return}var cP={},cO={};cO={index:cN.data.index,value:cM._json.items[cN.data.index].value};cP={index:cM._exIndex,value:cM._exIndex>=0?cM._json.items[cM._exIndex].value:{}};var cQ=new bh("onhighlight");cQ.fromitem=cP;cQ.toitem=cO;cM.dispatchEvent(cQ);cM._exIndex=cN.data.index},onbeforepick:function(cN){if(!cM._json){return}if(typeof(cN.data.index)==="number"){var cO=cM._json.items[cN.data.index].value;cN.data.item.content=cN.data.item.value=cO.province+cO.city+cO.district+cO.street+cO.business}},onconfirm:function(cN){if(!cM._json){return}_addStat(5012);var cO={};if(typeof(cN.data.index)==="number"){cO={index:cN.data.index,value:cM._json.items[cN.data.index].value};var cP=new bh("onconfirm");cP.item=cO;cM.dispatchEvent(cP)}}});T.render(a9.g(this._options.input));this._suggestion=T},show:function(){if(this._suggestion){this._suggestion.getMain().style.display="block"}},hide:function(){this._suggestion&&this._suggestion.hide();this._exIndex=-1},dispose:function(){this._suggestion&&this._suggestion.dispose();a9.lang.Class.prototype.dispose.call(this)},setTypes:function(T){this._options.types=T||[];this._getTypesId()},setLocation:function(T){this._loc.src=T;this._getCityId()},search:function(T){this._sendAutocompleteRequest(T)},setInputValue:function(T){if(this._suggestion){this._suggestion.pick(T)}},_sendAutocompleteRequest:function(cO){var cN=this,T=(Math.random()*100000).toFixed(0);BMap._rd["_cbk"+T]=function(cP){cN._getAutocompleteBack(cP);delete BMap._rd["_cbk"+T]};var cM="http://map.baidu.com/su?wd="+encodeURIComponent(cO)+"&callback=BMap._rd._cbk"+T+"&cid="+cN._cityId+"&type="+cN._typeIds+"&t="+new Date().getTime();cN._word=cO;cN._exIndex=-1;cN._results=this._getAutocompleteResult();_addStat(5010,{tp:cN._typeIds,wd:encodeURIComponent(cO)});cy.request(cM)},_getAutocompleteBack:function(T){if(T&&T.q){this._word=T.q}var cM=this._formatDataForTangram(T);this._showResultList(cM);this._results=this._getAutocompleteResult(this._json);this._options.onSearchComplete(this._results)},_formatDataForTangram:function(cP){var cQ=[],cM=cP.s,T={};T.keyword=cP.q||"";T.count=cP.s.length||0;T.status=cP.e<0?BMAP_STATUS_SERVICE_UNAVAILABLE:BMAP_STATUS_SUCCESS;T.items=[];for(var cO=0,cR=cM.length;cO<cR;cO++){var cN=this._getItemValue(cM[cO],this._typeIds);T.items.push(cN.value);cQ.push(cN.html)}this._json=T;return{data:cQ,word:cP.q}},_showResultList:function(T){if(!this._suggestion){return}var cM=this._suggestion;cM.show(T.word,T.data);if(T.data.length<1){cM.hide()}},_getItemValue:function(cM,T){switch(T.toString()){case"1":return this._getItemValueForCity(cM);default:return this._getItemValueForPoi(cM)}},_getItemValueForPoi:function(cV){var cU=cV.split("$"),cO=this._word,T=new RegExp(cO,"g"),cN="<b>"+cO+"</b>",cT={province:"",city:cU[0],district:cU[1],street:cU[2],streetNumber:"",business:cU[3]},cQ="",cM=3;for(var cS=cM;cS>=0;cS--){cQ=cU[cS]+cQ;if(cQ.indexOf(cO)>-1){var cR=cS-1,cP="";while(cR>-1){cP=cU[cR]+cP;cR--}cQ=cQ.replace(T,cN);if(!!cP){cQ+=\'&nbsp;<span class="tangram-suggestion-grey">\'+cP+"</span>"}break}else{continue}}if(!cP){for(var cS=cM;cS>=0;cS--){cP+=cU[cS]}}return{value:{value:cT},html:cQ}},_getItemValueForCity:function(cR){var cM=cR.split("$"),cP=this._word,T=new RegExp(cP,"g"),cN="<b>"+cP+"</b>",cO={province:cM[0],city:cM[1],district:"",street:"",streetNumber:"",business:""},cQ=(cM[0]+cM[1]).replace(T,cN);return{value:{value:cO},html:cQ}},_getTypesId:function(){var cM=this._options.types,cN=[];if(a9.isString(cM)){cN.push(bz.TYPES_COLLECTION[cM.toUpperCase()])}else{if(a9.lang.isArray(cM)){for(var T=0,cO=cM.length;T<cO;T++){cN.push(bz.TYPES_COLLECTION[cM[T].toUpperCase()])}}}this._typeIds=cN.length>0?cN.join(","):"0"},_getCityId:function(cM){var T=this;T._getIdByLoc(T._loc,function(cN){T._cityId=cN;if(!!cM){T[cM.method].apply(T,cM.arguments)}})},_getStyles:function(){if(!bz.IS_INCLUDE_STYLE){var cN=document,cM=cN.createElement("link");cM.setAttribute("rel","stylesheet");cM.setAttribute("type","text/css");cM.setAttribute("href",bz.STYLE_FILE_PATH);var T=cN.getElementsByTagName("head");if(T.length){T[0].appendChild(cM)}else{cN.documentElement.appendChild(cM)}bz.IS_INCLUDE_STYLE=true}},_getAutocompleteResult:function(T){if(!T){return new ag({keyword:this._word,total:0,pois:[]})}var cN=[];for(var cM=0,cO=T.items.length;cM<cO;cM++){cN.push(T.items[cM].value)}return new ag({keyword:T.keyword,total:T.count,pois:cN})}});function ag(T){this.keyword=T.keyword||"";this._numPois=T.total||0;this._pois=T.pois&&T.pois.slice(0)||[]}a9.extend(ag.prototype,{getPoi:function(T){if(this._pois[T]){return this._pois[T]}},getNumPois:function(){return this._numPois},toString:function(){return"AutocompleteResult"}});');
﻿_jsload&&_jsload('hotspot', 'BMap.register(function(cM){cM.temp.spotOverLabel=new ah("",{offset:new aI(15,-3),styles:{border:"1px solid #aaa",background:"#fffec2",whiteSpace:"nowrap",font:"12px "+cd.fontFamily,mozBoxShadow:"1px 2px 6px #666",webkitBoxShadow:"1px 2px 6px #666",boxShadow:"1px 2px 6px #666",padding:"2px 4px"}});cM.addEventListener("mousemove",function(cT){if(cT.overlay&&!(cT.overlay instanceof cG)||cT.infoWindow){return}var cW=this.temp;var cN=cW.curSpots.slice(0);cW.curSpots=[];if(this._hotspots){for(var cO in this._hotspots){var cU=this._hotspots[cO];if(cU._minZoom>this.getZoom()||cU._maxZoom<this.getZoom()){continue}var cP=this.pointToPixel(cU.getPosition());if(cP.x<this.width&&cP.y<this.height){if(cT.offsetX<cP.x+cU._offsets[1]&&cT.offsetX>cP.x-cU._offsets[3]&&cT.offsetY>cP.y-cU._offsets[0]&&cT.offsetY<cP.y+cU._offsets[2]){cW.curSpots.push(cU)}}}}var cV=cW.curSpots.slice(0);for(var cR=0;cR<cN.length;cR++){for(var cQ=0;cQ<cV.length;cQ++){if(cN[cR]===cV[cQ]){cN.splice(cR,1);cR--;cV.splice(cQ,1);cQ--}}}if(cN.length>0){var cS=new bh("onhotspotout");cS.spots=cN.slice(0);this.dispatchEvent(cS)}if(cW.curSpots.length==0){if(this.platform.style.cursor!=this.config.defaultCursor){this.platform.style.cursor=this.config.defaultCursor}if(cW.spotOverTimer){clearTimeout(cW.spotOverTimer);cW.spotOverTimer=null}cW.spotOutTimer=setTimeout(function(){cW.spotOverLabel.hide()},400)}else{if(cV.length>0){this.platform.style.cursor="pointer";var cS=new bh("onhotspotover");cS.spots=cV.slice(0);this.dispatchEvent(cS);if(cW.spotOverTimer){clearTimeout(cW.spotOverTimer);cW.spotOverTimer=null}if(cW.spotOutTimer){clearTimeout(cW.spotOutTimer);cW.spotOutTimer=null}if(cS.spots[0].getText()){cW.spotOverTimer=setTimeout(function(){cW.spotOverLabel.setContent(cS.spots[0].getText());cW.spotOverLabel.setPosition(cT.point);cW.spotOverLabel.show();cM.addOverlay(cW.spotOverLabel)},400)}}}});cM.addEventListener("clickex",function(cP){var cN=this.temp;if(cP.overlay){return}if(cN.curSpots.length>0){var cO=new bh("onhotspotclick");cO.spots=cN.curSpots.slice(0);cO.spots.sort(function(cR,cQ){return cR.getPosition().lat-cQ.getPosition().lat});this.dispatchEvent(cO)}});function T(){if(cM.temp.dragged&&cM.temp.curSpots.length>0){cM.platform.style.cursor="pointer";cM.temp.dragged=false}else{cM.temp.curSpots=[];cM.platform.style.cursor=cM.config.defaultCursor}}cM.addEventListener("load",T);cM.addEventListener("moveend",T);cM.addEventListener("zoomend",T);cM.addEventListener("dragend",function(){this.temp.dragged=true})});');
﻿_jsload&&_jsload('buslinesearch', 'a9.extend(bn.prototype,{_asyncSearch:function(){for(var cM=0,T=this._queryList.length;cM<T;cM++){var cN=this._queryList[cM];this[cN.method].apply(this,cN.arguments)}delete this._queryList},_getMoreUrl:function(cO,cN,T){cO=bb.convertLL2MC(cO);var cM=cJ+"?c="+cO.lng+","+cO.lat+"&i="+cN+","+encodeURIComponent(T)+"&s="+encodeURIComponent("tpl:LinesQuery");return cM},getBusList:function(T){var cM=this;this._getIdByLoc(this._loc,function(cO){if(!cO){this._busListResult=new K({keyword:T,city:"",moreUrl:"",_cityCode:""});cM._setStatus(BMAP_STATUS_INVALID_REQUEST);cM._triggerCbk(w.CBK_BUSLIST_COMPLETE,this._busListResult);return}var cN={qt:cM.QUERY_TYPE_BUSLIST,c:cO,wd:T};bc.request(function(cQ,cP){cM._busListDataCbk(cQ,cP)},cN,{keyword:T})})},_busListDataCbk:function(cO,T){this.clearResults();var cQ=cO.result;if(!cO.content||cQ.error!=0||cQ.type!=this.RETURN_TYPE_BUSLIST){this._busListResult=new K({keyword:T.keyword,city:cO.current_city.name,moreUrl:"",_cityCode:cO.current_city.code});this._setStatus(BMAP_STATUS_SERVICE_UNAVAILABLE);this._triggerCbk(w.CBK_BUSLIST_COMPLETE,this._busListResult);return}var cS=cO.content,cM=[];for(var cN=0,cP=cS.length;cN<cP;cN++){var cR={name:cS[cN].name,_uid:cS[cN].uid,_cityCode:cO.current_city.code,_index:cN,_keyword:T.keyword,_poiType:cS[cN].poiType||2};cM.push(cR)}this._busListResult=new K({keyword:T.keyword,city:cO.current_city.name,moreUrl:this._getMoreUrl(U.parseGeo(cO.current_city.geo,true).point,cO.current_city.code,T.keyword),listItems:cM,_cityCode:cO.current_city.code});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_BUSLIST_COMPLETE,this._busListResult);this._renderBusListPanel();this._jumpCity(cO.current_city.geo,cO.current_city.level,cO.current_city.code)},_renderBusListPanel:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._busListResult&&this._busListResult.getNumBusList()>0){var T=ab("div",{style:"font:12px "+cd.fontFamily+";background:#fff"});T.id="divResult"+this.guid;var cO=this._busListResult.getNumBusList(),cP=[];for(var cN=0;cN<cO;cN++){var cQ=this._busListResult.getBusListItem(cN).name;cP.push(\'<dl style="margin:3px 3px"><dt><span style="cursor:pointer" onclick=Instance(\\\'\'+this.guid+"\')._selectBusListItem("+cN+")><img id=imgBLIcon"+cN+" src="+bn._iconOpen+\' style="border:none" /></span>&nbsp;&nbsp;<a style="color:blue" href="javascript:void(0)" onclick=Instance(\\\'\'+this.guid+"\')._selectBusListItem("+cN+")>"+cQ+"</a></dt><dd id=ddBLInfo"+cN+\' style="display:none;margin:2px 0px"></dd></dl>\')}var cM="";if(this._busListResult.moreResultsUrl){cM+="<div style=\'color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'>";cM+="<a style=\'color:#7777cc\' href=\'"+this._busListResult.moreResultsUrl+"\' target=\'_blank\'>\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b&#187;</a>";cM+="&nbsp;</div>"}T.innerHTML=cP.join("")+cM;this._opts.renderOptions.panel.appendChild(T);this._triggerCbk(w.CBK_BUSLISTHTML_SET,T)}},_jumpCity:function(cO,cP,cM){var cN=this._opts.renderOptions.map;if(cN){var T=U.parseGeo(cO,true).point;if(this._preCityCode){if(this._preCityCode!=cM){cN.centerAndZoom(T,cP);this._preCityCode=cM}}else{cN.centerAndZoom(T,cP);this._preCityCode=cM}}},_switchDDContainer:function(cN){var cQ=this;if(this._busListResult){for(var cO=0,cM=this._busListResult.getNumBusList();cO<cM;cO++){var T=a9.G("ddBLInfo"+cO);var cP=a9.G("imgBLIcon"+cO);if(cO==cN){if(T.style.display=="none"){T.style.display="block";cP.src=bn._iconClose}else{T.style.display="none";cP.src=bn._iconOpen}}else{T.style.display="none";cP.src=bn._iconOpen}}}},_selectBusListItem:function(cO,cN){if(!cN){var T=a9.G("ddBLInfo"+cO);var cM=a9.G("imgBLIcon"+cO);if(T.style.display=="block"){T.style.display="none";cM.src=bn._iconOpen;return}}if(this._busListResult&&this._busListResult[cO]&&this._busListResult[cO].getNumBusStations()>0){this._busLine=this._busListResult[cO];this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_BUSLINE_COMPLETE,this._busLine);this._renderBusLinePanel(cO);this._renderBusLineMap(cO);return}var cP=this;var cR=this._busListResult.getBusListItem(cO);var cQ={qt:cP.QUERY_TYPE_BUSLINE,c:cR._cityCode,uid:cR._uid};bc.request(function(cT,cS){cP._busLineDataCbk(cT,cS,cO)},cQ,{name:cR.name,_poiType:cR._poiType})},clearResults:function(){delete this._busListResult;delete this._busLine;delete this._stops;delete this._preA;this._clearOverlays();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},getBusLine:function(T){if(T&&typeof T=="object"&&T._uid&&T._uid!=""&&(typeof T._cityCode!="undefined")&&T._cityCode.toString()!=""&&(typeof T._index!="undefined")&&T._index.toString()!=""&&(typeof T._keyword!="undefined")&&T._keyword.toString()!=""){if(this._busListResult&&this._busListResult.getNumBusList()>0&&T._cityCode==this._busListResult._cityCode&&T._keyword==this._busListResult.keyword){this._selectBusListItem(T._index,true)}}},_busLineDataCbk:function(cZ,cN,cU){var cM=cZ.result;if(!cZ.content||!cZ.content[0]||cM.error!=0||cM.type!=this.RETURN_TYPE_BUSLINE){this._busLine=new A({name:cN.name});this._setStatus(BMAP_STATUS_SERVICE_UNAVAILABLE);this._triggerCbk(w.CBK_BUSLINE_COMPLETE,this._busLine);return}var cW=cZ.content[0];var cX="",cY="",cS="",cR={},cV=[];cX=cW.startTime;cY=cW.endTime;cS=cW.company;if(cW.geo){var cO=U.parseGeo(cW.geo,true);cR=new f(cO.points)}if(cW.stations){for(var cP=0,cT=cW.stations.length;cP<cT;cP++){if(cW.stations[cP].geo){var T=U.parseGeo(cW.stations[cP].geo,true);var cQ={name:cW.stations[cP].name,position:T.point,_uid:cW.stations[cP].uid};cV.push(cQ)}}}this._busLine=new A({name:cN.name,startTime:cX,endTime:cY,company:cS,polyline:cR,stations:cV,_poiType:cN._poiType});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_BUSLINE_COMPLETE,this._busLine);this._busListResult[cU]=this._busLine;this._renderBusLinePanel(cU);this._renderBusLineMap(cU)},_renderBusLinePanel:function(cP){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._busLine&&this._busLine.getNumBusStations()>0){this._switchDDContainer(cP);var cN=a9.G("ddBLInfo"+cP);if(cN){var cR=[];cR.push(\'<table style="width:100%;background:#CDCDCD;font:12px \'+cd.fontFamily+\'" cellspacing="1" cellpadding="1" ><tbody>\');cR.push(\'<tr><td style="width:95px;line-height:22px;padding:0px 8px;text-align:left;vertical-align:top;background:#F4F4F4" >\u9996\u672b\u8f66\u65f6\u95f4</th><td  style="background:#FFFFFF;line-height:22px;padding:0px 8px" >\'+this._busLine.startTime+"-"+this._busLine.endTime+"</td></tr>");cR.push(\'<tr><td style="width:95px;line-height:22px;padding:0px 8px;text-align:left;vertical-align:top;background:#F4F4F4" >\u6240\u5c5e\u516c\u53f8</th><td  style="background:#FFFFFF;line-height:22px;padding:0px 8px" >\'+this._busLine.company+"</td></tr>");cR.push("</tbody></table>");if(this._busLine._poiType==4){cR.push(\'<p style="margin:2px 0px;font:12px \'+cd.fontFamily+\';">\u6cbf\u7ebf\u5730\u94c1\u7ad9:</p>\')}else{cR.push(\'<p style="margin:2px 0px;font:12px \'+cd.fontFamily+\';">\u6cbf\u7ebf\u516c\u4ea4\u7ad9\u70b9:</p>\')}cR.push(\'<table style="width:100%;font:12px \'+cd.fontFamily+\';" ><tbody>\');for(var cQ=0,T=this._busLine.getNumBusStations();cQ<T;cQ++){var cO=cQ+1;cR.push(\'<tr><td style="width:20px">\'+cO+"</th><td><a id=aStop_"+cP+"_"+cQ+\' style="color:blue" href="javascript:void(0)" onclick=Instance(\\\'\'+this.guid+"\')._selectBusStop("+cP+","+cQ+")>"+this._busLine.getBusStation(cQ).name+"</a></td></tr>")}cR.push("</tbody></table>");cN.innerHTML=cR.join("")}var cM=a9.G("divResult"+this.guid);this._triggerCbk(w.CBK_BUSLINEHTML_SET,cM)}},_renderBusLineMap:function(cN){if(this._opts.renderOptions.map&&this._busLine&&this._busLine.getNumBusStations()>0){this._clearOverlays();ao.addRoute(this._opts.renderOptions.map,this._busLine.getPath());var cR=this._busLine.getPolyline();this._triggerCbk(w.CBK_POLYLINES_SET,cR);this._stops=[];for(var cP=0,T=this._busLine.getNumBusStations();cP<T;cP++){var cQ=this._busLine.getBusStation(cP).position;var cM=this._busLine.getBusStation(cP).name;var cO=ao.addStationPoi(this._opts.renderOptions.map,cQ,cM);(function(cU,cS,cT){cU.addEventListener("click",function(){var cV=new bQ(cS);cV.addEventListener("open",function(){var cW=a9.G("aStop_"+cN+"_"+cT);if(cW){cW.style.backgroundColor="#cccccc"}});cV.addEventListener("close",function(){var cW=a9.G("aStop_"+cN+"_"+cT);if(cW){cW.style.backgroundColor="#ffffff"}});cU.openInfoWindow(cV)})})(cO,cM,cP);cO._stName=cM;this._stops.push(cO)}this._triggerCbk(w.CBK_MARKERS_SET,this._stops);if(this._opts.renderOptions.autoViewport){this._opts.renderOptions.map.setViewport(cR.getPath(),{margins:[5,5,5,5]})}}},_selectBusStop:function(cN,cM){if(this._opts.renderOptions.map&&this._stops&&this._stops.length>0){var cO=this._stops[cM];if(cO._stName){var cP=new bQ(cO._stName);cP.addEventListener("open",function(){var cQ=a9.G("aStop_"+cN+"_"+cM);if(cQ){cQ.style.backgroundColor="#cccccc"}});cP.addEventListener("close",function(){var cQ=a9.G("aStop_"+cN+"_"+cM);if(cQ){cQ.style.backgroundColor="#ffffff"}});cO.openInfoWindow(cP)}}else{if(this.preA){this.preA.style.backgroundColor="#ffffff"}var T=a9.G("aStop_"+cN+"_"+cM);if(T){T.style.backgroundColor="#cccccc"}this.preA=T}},_clearOverlays:function(){if(this._opts.renderOptions.map){this._opts.renderOptions.map.clearOverlays()}},_setStatus:function(T){if(typeof T=="number"){this._status=T}else{delete this._status}}});function K(T){this.keyword=T.keyword||"";this.city=T.city;this.moreResultsUrl=T.moreUrl;this._listItems=T.listItems&&T.listItems.slice(0)||[];this._cityCode=T._cityCode}a9.extend(K.prototype,{getBusListItem:function(T){if(this._listItems[T]){return this._listItems[T]}},getNumBusList:function(){return this._listItems.length}});function A(T){this.name=T.name||"";this.startTime=T.startTime||"";this.endTime=T.endTime||"";this.company=T.company||"";this._polyline=T.polyline||{};this._stations=T.stations&&T.stations.slice(0)||[];this._poiType=T._poiType||2}a9.extend(A.prototype,{getBusStation:function(T){if(this._stations[T]){return this._stations[T]}},getNumBusStations:function(){return this._stations.length},getPolyline:function(){return this._polyline},getPath:function(){if(this._polyline.getPath()){return this._polyline.getPath()}}});');
